!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/__assets/",n(n.s=403)}({100:function(t,e,n){"use strict";var s;!function(i){function r(t,e,n){var s,i,r,o,p,m,g,w,E,O=0,T=[],y=0,C=!1,S=[],I=[],k=!1;if(s=(n=n||{}).encoding||"UTF8",(E=n.numRounds||1)!==parseInt(E,10)||1>E)throw Error("numRounds must a integer >= 1");if("SHA-1"!==t)throw Error("Chosen SHA variant is not supported");p=512,m=b,g=A,o=160,w=function(t){return t.slice()},r=f(e,s),i=v(t),this.setHMACKey=function(e,n,r){var a;if(!0===C)throw Error("HMAC key already set");if(!0===k)throw Error("Cannot set HMAC key after calling update");for(e=(n=f(n,s=(r||{}).encoding||"UTF8")(e)).binLen,n=n.value,r=(a=p>>>3)/4-1,a<e/8&&(n=g(n,e,0,v(t),o));n.length<=r;)n.push(0);for(e=0;e<=r;e+=1)S[e]=909522486^n[e],I[e]=1549556828^n[e];i=m(S,i),O=p,C=!0},this.update=function(t){var e,n,s,o=0,a=p>>>5;for(t=(e=r(t,T,y)).binLen,n=e.value,e=t>>>5,s=0;s<e;s+=a)o+p<=t&&(i=m(n.slice(s,s+a),i),o+=p);O+=o,T=n.slice(o>>>5),y=t%p,k=!0},this.getHash=function(e,n){var s,r,f,p;if(!0===C)throw Error("Cannot call getHash after setting HMAC key");switch(f=d(n),e){case"HEX":s=function(t){return a(t,o,f)};break;case"B64":s=function(t){return u(t,o,f)};break;case"BYTES":s=function(t){return c(t,o)};break;case"ARRAYBUFFER":try{r=new ArrayBuffer(0)}catch(t){throw Error("ARRAYBUFFER not supported by this environment")}s=function(t){return h(t,o)};break;case"UINT8ARRAY":try{r=new Uint8Array(0)}catch(t){throw Error("UINT8ARRAY not supported by this environment")}s=function(t){return l(t,o)};break;default:throw Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}for(p=g(T.slice(),y,O,w(i),o),r=1;r<E;r+=1)p=g(p,o,0,v(t),o);return s(p)},this.getHMAC=function(e,n){var s,r,f,b;if(!1===C)throw Error("Cannot call getHMAC without first setting HMAC key");switch(f=d(n),e){case"HEX":s=function(t){return a(t,o,f)};break;case"B64":s=function(t){return u(t,o,f)};break;case"BYTES":s=function(t){return c(t,o)};break;case"ARRAYBUFFER":try{s=new ArrayBuffer(0)}catch(t){throw Error("ARRAYBUFFER not supported by this environment")}s=function(t){return h(t,o)};break;case"UINT8ARRAY":try{s=new Uint8Array(0)}catch(t){throw Error("UINT8ARRAY not supported by this environment")}s=function(t){return l(t,o)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}return r=g(T.slice(),y,O,w(i),o),b=m(I,v(t)),s(b=g(r,o,p,b,o))}}function o(t,e,n){var s,i,r,o;for(e=e||[0],i=(n=n||0)>>>3,s=0;s<t.length;s+=1)r=(o=s+i)>>>2,e.length<=r&&e.push(0),e[r]|=t[s]<<8*(3+o%4*-1);return{value:e,binLen:8*t.length+n}}function a(t,e,n){var s,i,r="";for(e/=8,s=0;s<e;s+=1)i=t[s>>>2]>>>8*(3+s%4*-1),r+="0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i);return n.outputUpper?r.toUpperCase():r}function u(t,e,n){var s,i,r,o="",a=e/8;for(s=0;s<a;s+=3)for(i=s+1<a?t[s+1>>>2]:0,r=s+2<a?t[s+2>>>2]:0,r=(t[s>>>2]>>>8*(3+s%4*-1)&255)<<16|(i>>>8*(3+(s+1)%4*-1)&255)<<8|r>>>8*(3+(s+2)%4*-1)&255,i=0;4>i;i+=1)o+=8*s+6*i<=e?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>6*(3-i)&63):n.b64Pad;return o}function c(t,e){var n,s,i="",r=e/8;for(n=0;n<r;n+=1)s=t[n>>>2]>>>8*(3+n%4*-1)&255,i+=String.fromCharCode(s);return i}function h(t,e){var n,s,i=e/8,r=new ArrayBuffer(i);for(s=new Uint8Array(r),n=0;n<i;n+=1)s[n]=t[n>>>2]>>>8*(3+n%4*-1)&255;return r}function l(t,e){var n,s=e/8,i=new Uint8Array(s);for(n=0;n<s;n+=1)i[n]=t[n>>>2]>>>8*(3+n%4*-1)&255;return i}function d(t){var e={outputUpper:!1,b64Pad:"=",shakeLen:-1};if(t=t||{},e.outputUpper=t.outputUpper||!1,!0===t.hasOwnProperty("b64Pad")&&(e.b64Pad=t.b64Pad),"boolean"!=typeof e.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!=typeof e.b64Pad)throw Error("Invalid b64Pad formatting option");return e}function f(t,e){var n;switch(e){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(t){case"HEX":n=function(t,e,n){var s,i,r,o,a,u=t.length;if(0!=u%2)throw Error("String of HEX type must be in byte increments");for(e=e||[0],a=(n=n||0)>>>3,s=0;s<u;s+=2){if(i=parseInt(t.substr(s,2),16),isNaN(i))throw Error("String of HEX type contains invalid characters");for(r=(o=(s>>>1)+a)>>>2;e.length<=r;)e.push(0);e[r]|=i<<8*(3+o%4*-1)}return{value:e,binLen:4*u+n}};break;case"TEXT":n=function(t,n,s){var i,r,o,a,u,c,h,l,d=0;if(n=n||[0],u=(s=s||0)>>>3,"UTF8"===e)for(l=3,o=0;o<t.length;o+=1)for(r=[],128>(i=t.charCodeAt(o))?r.push(i):2048>i?(r.push(192|i>>>6),r.push(128|63&i)):55296>i||57344<=i?r.push(224|i>>>12,128|i>>>6&63,128|63&i):(o+=1,i=65536+((1023&i)<<10|1023&t.charCodeAt(o)),r.push(240|i>>>18,128|i>>>12&63,128|i>>>6&63,128|63&i)),a=0;a<r.length;a+=1){for(c=(h=d+u)>>>2;n.length<=c;)n.push(0);n[c]|=r[a]<<8*(l+h%4*-1),d+=1}else if("UTF16BE"===e||"UTF16LE"===e)for(l=2,r="UTF16LE"===e||"UTF16LE"!==e&&!1,o=0;o<t.length;o+=1){for(i=t.charCodeAt(o),!0===r&&(i=(a=255&i)<<8|i>>>8),c=(h=d+u)>>>2;n.length<=c;)n.push(0);n[c]|=i<<8*(l+h%4*-1),d+=2}return{value:n,binLen:8*d+s}};break;case"B64":n=function(t,e,n){var s,i,r,o,a,u,c,h=0;if(-1===t.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");if(i=t.indexOf("="),t=t.replace(/\=/g,""),-1!==i&&i<t.length)throw Error("Invalid '=' found in base-64 string");for(e=e||[0],u=(n=n||0)>>>3,i=0;i<t.length;i+=4){for(a=t.substr(i,4),r=o=0;r<a.length;r+=1)o|=(s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(r)))<<18-6*r;for(r=0;r<a.length-1;r+=1){for(s=(c=h+u)>>>2;e.length<=s;)e.push(0);e[s]|=(o>>>16-8*r&255)<<8*(3+c%4*-1),h+=1}}return{value:e,binLen:8*h+n}};break;case"BYTES":n=function(t,e,n){var s,i,r,o,a;for(e=e||[0],r=(n=n||0)>>>3,i=0;i<t.length;i+=1)s=t.charCodeAt(i),o=(a=i+r)>>>2,e.length<=o&&e.push(0),e[o]|=s<<8*(3+a%4*-1);return{value:e,binLen:8*t.length+n}};break;case"ARRAYBUFFER":try{n=new ArrayBuffer(0)}catch(t){throw Error("ARRAYBUFFER not supported by this environment")}n=function(t,e,n){return o(new Uint8Array(t),e,n)};break;case"UINT8ARRAY":try{n=new Uint8Array(0)}catch(t){throw Error("UINT8ARRAY not supported by this environment")}n=function(t,e,n){return o(t,e,n)};break;default:throw Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}return n}function p(t,e){return t<<e|t>>>32-e}function m(t,e){var n=(65535&t)+(65535&e);return((t>>>16)+(e>>>16)+(n>>>16)&65535)<<16|65535&n}function g(t,e,n,s,i){var r=(65535&t)+(65535&e)+(65535&n)+(65535&s)+(65535&i);return((t>>>16)+(e>>>16)+(n>>>16)+(s>>>16)+(i>>>16)+(r>>>16)&65535)<<16|65535&r}function v(t){if("SHA-1"!==t)throw Error("No SHA variants supported");return[1732584193,4023233417,2562383102,271733878,3285377520]}function b(t,e){var n,s,i,r,o,a,u,c=[];for(n=e[0],s=e[1],i=e[2],r=e[3],o=e[4],u=0;80>u;u+=1)c[u]=16>u?t[u]:p(c[u-3]^c[u-8]^c[u-14]^c[u-16],1),a=20>u?g(p(n,5),s&i^~s&r,o,1518500249,c[u]):40>u?g(p(n,5),s^i^r,o,1859775393,c[u]):60>u?g(p(n,5),s&i^s&r^i&r,o,2400959708,c[u]):g(p(n,5),s^i^r,o,3395469782,c[u]),o=r,r=i,i=p(s,30),s=n,n=a;return e[0]=m(n,e[0]),e[1]=m(s,e[1]),e[2]=m(i,e[2]),e[3]=m(r,e[3]),e[4]=m(o,e[4]),e}function A(t,e,n,s){var i;for(i=15+(e+65>>>9<<4);t.length<=i;)t.push(0);for(t[e>>>5]|=128<<24-e%32,e+=n,t[i]=4294967295&e,t[i-1]=e/4294967296|0,e=t.length,i=0;i<e;i+=16)s=b(t.slice(i,i+16),s);return s}void 0===(s=function(){return r}.call(e,n,e,t))||(t.exports=s)}()},101:function(t,e,n){"use strict";function s(t){return String.fromCharCode(parseInt(t.slice(1),16))}function i(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}Object.defineProperty(e,"__esModule",{value:!0}),e.encode=function(t){return btoa(encodeURIComponent(t).replace(/%[0-9A-F]{2}/g,s))},e.decode=function(t){return decodeURIComponent(Array.from(atob(t),i).join(""))}},117:function(t,e,n){"use strict";function s(){const t=document.documentElement,e=document.body;return{width:t.clientWidth||e.clientWidth,height:window.innerHeight}}n.d(e,"a",(function(){return s}))},12:function(t,e,n){"use strict";function s(t){return t<=0?Promise.resolve():new Promise((e=>setTimeout(e,t)))}async function i(t,e,n){const i=Symbol("timed out"),r=s(e).then((()=>i)),o=await Promise.race([t,r]);return o===i?n():o}function r(t,e){return t*(1-e+2*Math.random()*e)}n.d(e,"c",(function(){return s})),n.d(e,"f",(function(){return i})),n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return a})),n.d(e,"b",(function(){return u})),n.d(e,"a",(function(){return c}));const o=()=>!0;async function a(t,e,{initialDelay:n,maxDelay:i,log:u,shouldRetry:c=o}){return e().catch((async o=>{if(u&&u(`[TalkJS] Retries left: ${t}. Error: ${JSON.stringify(o)}.`),0===t)throw o;if(!await c(o))throw o;const h=1e3*n*1.2,l=r(i?Math.min(1e3*i,h):h,.05);return s(l).then((()=>a(t-1,e,{initialDelay:l/1e3,maxDelay:i,log:u,shouldRetry:c})))}))}function u(){const t={},e=new Promise((function(e,n){t.resolve=e,t.reject=n}));return t.promise=e,t}class c{get running(){return void 0!==this.timerId}constructor(t,e){this.intervalMs=t,this.callback=e,this.timerId=void 0}start(){this.running||this.trigger()}stop(){this.running&&(clearTimeout(this.timerId),this.timerId=void 0)}async trigger(){this.timerId=setTimeout((async()=>{this.running&&(await this.callback(),this.running&&this.trigger())}),this.intervalMs)}}},14:function(t,e,n){"use strict";n.d(e,"d",(function(){return s})),n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"e",(function(){return a}));function s(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]])}return n}function i(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{u(s.next(t))}catch(t){r(t)}}function a(t){try{u(s.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((s=s.apply(t,e||[])).next())}))}function r(t,e){var n,s,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(i=2&r[0]?s.return:r[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,s=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],s=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}Object.create;function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var s,i,r=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(t){i={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return o}function a(t,e,n){if(n||2===arguments.length)for(var s,i=0,r=e.length;i<r;i++)!s&&i in e||(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}Object.create},18:function(t,e,n){"use strict";n.d(e,"g",(function(){return o})),n.d(e,"h",(function(){return a})),n.d(e,"d",(function(){return u})),n.d(e,"e",(function(){return c})),n.d(e,"f",(function(){return h})),n.d(e,"c",(function(){return l})),n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return i}));var s,i,r=n(8);function o(t,e){return e.filter((e=>!0===t.participants[e.id].canRead)).map((t=>h(t)))}function a(t,e){return 1===e.length?[t]:e.filter((e=>e.id!==t.id))}function u(t,e){const n=r.b(t.participants,(t=>t.canRead)),s=r.h(n,(([t,n])=>{const s=l(n);return[e[t],{access:s}]}));return{custom:t.custom,id:t.externalId,photoUrl:t.photoUrl,subject:t.subject,topicId:t.topicId,welcomeMessages:t.welcomeMessages,participants:s}}function c(t,e,n,s,i){var r;return{id:t.externalId,type:d(t),conversation:u(e,i),senderId:null!==(r=null==n?void 0:n.id)&&void 0!==r?r:null,sender:n,isByMe:!!n&&n.id===s,body:t.text,location:t.location,attachment:t.attachment,timestamp:t.createdAt,read:t.senderId===s||!!t.received[s],custom:t.custom,origin:t.origin}}function h(t){if(null===t)return null;const e={id:t.externalId,name:t.name,custom:t.custom,locale:t.locale,photoUrl:t.photoUrl,role:t.configuration,welcomeMessage:t.welcomeMessage};return Object.assign(Object.assign({},e),{availabilityText:t.availabilityText,configuration:e.role,email:"<suppressed>",phone:"<suppressed>"})}function l({canWrite:t,canRead:e}){return t?"ReadWrite":e?"Read":"None"}function d(t){return t.attachment?"media":t.location?"location":"text"}!function(t){t[t.Inbox=0]="Inbox",t[t.Chatbox=1]="Chatbox",t[t.Popup=2]="Popup"}(s||(s={})),function(t){t[t.Widget=0]="Widget",t[t.Popover=1]="Popover"}(i||(i={}))},19:function(t,e,n){"use strict";let s;s=window.initialData?window.initialData.KEYS:{};e.a=((t={})=>({MAX_INITIAL_MESSAGES:60,MAX_INITIALLY_VISIBLE_MESSAGES:30,LOAD_MORE_MESSAGES_STEP:30,LOAD_MORE_CHATS_STEP:50,ALL_MESSAGES:600,INITIAL_CHATS_LOADED:50,INITIALLY_VISIBLE_CHATS_IN_HUB:15,INITIALLY_VISIBLE_CHATS_SEARCH_RESULTS:3,LOAD_MORE_CHATS_SEARCH_RESULTS_STEP:50,INITIALLY_VISIBLE_MESSAGES_SEARCH_RESULTS:3,LOAD_MORE_MESSAGES_SEARCH_RESULTS_STEP:50,GOOGLE_MAPS_API_KEY:t.GOOGLE_MAPS_API_KEY,IFRAMELY_API_KEY:t.IFRAMELY_API_KEY,FIREBASE:t.FIREBASE}))(s)},20:function(t,e,n){"use strict";n.d(e,"n",(function(){return i})),n.d(e,"e",(function(){return r})),n.d(e,"m",(function(){return o})),n.d(e,"f",(function(){return a})),n.d(e,"h",(function(){return u})),n.d(e,"l",(function(){return c})),n.d(e,"i",(function(){return h})),n.d(e,"d",(function(){return l})),n.d(e,"a",(function(){return d})),n.d(e,"g",(function(){return f}));var s=n(34);function i(){const t=window.crypto,e=t?()=>t.getRandomValues(new Uint8Array(1))[0]:()=>Math.floor(255*Math.random());return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^e()&15>>t/4).toString(16)))}function r(t){const e=document.createElement("a");return e.href=t,e.href||t}function o(t,e){document.cookie=`${t}=${e};path=/`}function a(t){const e=u(t);document.cookie=`${t}=${e};expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/`}function u(t){let e;try{e=document.cookie}catch(t){return}const n=e.split("; ").map((t=>t.split("="))).map((([t,e])=>({name:t,value:e})));for(let e of n)if(e.name===t)return e.value}function c(t,e){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function h(){return!!window.cordova}n.d(e,"b",(function(){return s.a})),n.d(e,"c",(function(){return s.b})),n.d(e,"j",(function(){return s.f})),n.d(e,"k",(function(){return s.g}));class l{constructor(t,e){this.u=!1,this.A=0;const n=this;this.callback=function(){if(n.A++,n.A>1)throw new Error(`[TalkJS] Cannot call ${t} more than once`);if(n.u)throw new Error(`[TalkJS] Cannot call ${t} asynchronously`);return e.apply(null,arguments)}}expire(){this.u=!0}}class d{constructor(t){this.id=t,this.isLeader=!1,this.O=new Promise((t=>{this.T=t})),"locks"in navigator?navigator.locks.request(this.id,(()=>(this.isLeader=!0,this.O))):this.isLeader=!0}relinquish(){this.T(),this.isLeader=!1}}function f(t){const e={};return"width"in t&&(e.width=t.width),"height"in t&&(e.height=t.height),"duration"in t&&(e.duration=t.duration),e.width||e.height||e.duration?e:void 0}},24:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s extends Error{constructor(t,e){const n=function(t){if("string"==typeof t)return t;if(Array.isArray(t))return t.join("\n");try{return JSON.stringify(t)}catch(e){return String(t)}}(t);super(n),this.userMessage=null!=e?e:n,Object.setPrototypeOf&&Object.setPrototypeOf(this,new.target.prototype)}}},26:function(t,e,n){"use strict";n.d(e,"a",(function(){return _t})),n.d(e,"b",(function(){return Dt}));var s=n(60),i=n(6);const r=(t,e,n)=>Object(s.b)(t,(t=>{if("string"==typeof t)return e(t,n);switch(t.type){case"bold":case"italic":case"strikethrough":case"blockquote":case"bulletlist":case"bulletList":case"bulletpoint":case"bulletPoint":return[{type:t.type,children:r(t.children,e,t.type)}];case"link":return[{type:t.type,url:t.url,children:r(t.children,e,t.type)}];case"actionlink":case"actionLink":case"actionbutton":case"actionButton":return[{type:t.type,action:t.action,params:t.params,children:r(t.children,e,t.type)}];case"mention":return[t];case"autolink":case"autoLink":case"codeblock":case"codeBlock":case"codespan":case"codeSpan":case"suppressed":case"emoji":case"customemoji":case"customEmoji":return[t]}}));function o(t,e){return n=>{const s=n;let r=0;const o=[];for(const a of Object(i.a)(n,t)){a.index-r>0&&o.push(s.substring(r,a.index));const t=e(a);Array.isArray(t)?o.push(...t):o.push(t),r=a.index+a[0].length}return r<n.length&&o.push(n.substring(r)),o}}var a,u="’'()[]{}<>:,‒–—―…!.«»-‐?‘’“”;/⁄␠·&@*\\•^¤¢$€£¥₩₪†‡°¡¿¬#№%‰‱¶′§~¨_|¦⁂☞∴‽※".replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");!function(t){t[t.italic=1]="italic",t[t.strikethrough=2]="strikethrough",t[t.bold=4]="bold"}(a||(a={}));const c=[0,1,2,3,4,5,6].map((t=>{const e=[];return 0==(t&a.italic)&&e.push(/_([^\s_].*?[^\s_])_|_([^\s_])_/),0==(t&a.strikethrough)&&e.push(/~([^\s~].*?[^\s~])~|~([^\s~])~/),0==(t&a.bold)&&e.push(/\*([^\s*].*?[^\s*])\*|\*([^\s*])\*/),new RegExp(e.map((t=>t.source)).join("|"),"g")})),h={_:a.italic,"*":a.bold,"~":a.strikethrough};function l(t){return d(t,0)}function d(t,e=0){const n=c[e],s=n?function(t){const e=o(f.getOrCompute(t,(()=>new RegExp(`(?:^|[\\s${u}])(?:${t.source})(?=[\\s${u}]|$)`,"g"))),(t=>{const e=t[0][1],n=t[1]||t[2]||t[3]||t[4]||t[5]||t[6];return[" ",{type:a[h[e]],children:[n]}]}));return t=>{const[n,...s]=e(" "+t);return n.length>1&&s.unshift(n.substring(1)),s}}(n):()=>[t];return r(s(t),((t,n)=>"bold"===n||"italic"===n||"strikethrough"===n?d(t,e|a[n]):[t]))}const f=Object(i.f)();function p(t,e){if(Array.prototype.indexOf)return t.indexOf(e);for(var n=0,s=t.length;n<s;n++)if(t[n]===e)return n;return-1}function m(t,e){for(var n=t.length-1;n>=0;n--)!0===e(t[n])&&t.splice(n,1)}function g(t){throw new Error("Unhandled case for value: '"+t+"'")}var v=function(){function t(t){void 0===t&&(t={}),this.tagName="",this.attrs={},this.innerHTML="",this.whitespaceRegex=/\s+/,this.tagName=t.tagName||"",this.attrs=t.attrs||{},this.innerHTML=t.innerHtml||t.innerHTML||""}return t.prototype.setTagName=function(t){return this.tagName=t,this},t.prototype.getTagName=function(){return this.tagName||""},t.prototype.setAttr=function(t,e){return this.getAttrs()[t]=e,this},t.prototype.getAttr=function(t){return this.getAttrs()[t]},t.prototype.setAttrs=function(t){return Object.assign(this.getAttrs(),t),this},t.prototype.getAttrs=function(){return this.attrs||(this.attrs={})},t.prototype.setClass=function(t){return this.setAttr("class",t)},t.prototype.addClass=function(t){for(var e,n=this.getClass(),s=this.whitespaceRegex,i=n?n.split(s):[],r=t.split(s);e=r.shift();)-1===p(i,e)&&i.push(e);return this.getAttrs().class=i.join(" "),this},t.prototype.removeClass=function(t){for(var e,n=this.getClass(),s=this.whitespaceRegex,i=n?n.split(s):[],r=t.split(s);i.length&&(e=r.shift());){var o=p(i,e);-1!==o&&i.splice(o,1)}return this.getAttrs().class=i.join(" "),this},t.prototype.getClass=function(){return this.getAttrs().class||""},t.prototype.hasClass=function(t){return-1!==(" "+this.getClass()+" ").indexOf(" "+t+" ")},t.prototype.setInnerHTML=function(t){return this.innerHTML=t,this},t.prototype.setInnerHtml=function(t){return this.setInnerHTML(t)},t.prototype.getInnerHTML=function(){return this.innerHTML||""},t.prototype.getInnerHtml=function(){return this.getInnerHTML()},t.prototype.toAnchorString=function(){var t=this.getTagName(),e=this.buildAttrsStr();return["<",t,e=e?" "+e:"",">",this.getInnerHtml(),"</",t,">"].join("")},t.prototype.buildAttrsStr=function(){if(!this.attrs)return"";var t=this.getAttrs(),e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n+'="'+t[n]+'"');return e.join(" ")},t}();var b=function(){function t(t){void 0===t&&(t={}),this.newWindow=!1,this.truncate={},this.className="",this.newWindow=t.newWindow||!1,this.truncate=t.truncate||{},this.className=t.className||""}return t.prototype.build=function(t){return new v({tagName:"a",attrs:this.createAttrs(t),innerHtml:this.processAnchorText(t.getAnchorText())})},t.prototype.createAttrs=function(t){var e={href:t.getAnchorHref()},n=this.createCssClass(t);return n&&(e.class=n),this.newWindow&&(e.target="_blank",e.rel="noopener noreferrer"),this.truncate&&this.truncate.length&&this.truncate.length<t.getAnchorText().length&&(e.title=t.getAnchorHref()),e},t.prototype.createCssClass=function(t){var e=this.className;if(e){for(var n=[e],s=t.getCssClassSuffixes(),i=0,r=s.length;i<r;i++)n.push(e+"-"+s[i]);return n.join(" ")}return""},t.prototype.processAnchorText=function(t){return t=this.doTruncate(t)},t.prototype.doTruncate=function(t){var e=this.truncate;if(!e||!e.length)return t;var n=e.length,s=e.location;return"smart"===s?function(t,e,n){var s,i;null==n?(n="&hellip;",i=3,s=8):(i=n.length,s=n.length);var r=function(t){var e="";return t.scheme&&t.host&&(e+=t.scheme+"://"),t.host&&(e+=t.host),t.path&&(e+="/"+t.path),t.query&&(e+="?"+t.query),t.fragment&&(e+="#"+t.fragment),e},o=function(t,e){var s=e/2,i=Math.ceil(s),r=-1*Math.floor(s),o="";return r<0&&(o=t.substr(r)),t.substr(0,i)+n+o};if(t.length<=e)return t;var a=e-i,u=function(t){var e={},n=t,s=n.match(/^([a-z]+):\/\//i);return s&&(e.scheme=s[1],n=n.substr(s[0].length)),(s=n.match(/^(.*?)(?=(\?|#|\/|$))/i))&&(e.host=s[1],n=n.substr(s[0].length)),(s=n.match(/^\/(.*?)(?=(\?|#|$))/i))&&(e.path=s[1],n=n.substr(s[0].length)),(s=n.match(/^\?(.*?)(?=(#|$))/i))&&(e.query=s[1],n=n.substr(s[0].length)),(s=n.match(/^#(.*?)$/i))&&(e.fragment=s[1]),e}(t);if(u.query){var c=u.query.match(/^(.*?)(?=(\?|\#))(.*?)$/i);c&&(u.query=u.query.substr(0,c[1].length),t=r(u))}if(t.length<=e)return t;if(u.host&&(u.host=u.host.replace(/^www\./,""),t=r(u)),t.length<=e)return t;var h="";if(u.host&&(h+=u.host),h.length>=a)return u.host.length==e?(u.host.substr(0,e-i)+n).substr(0,a+s):o(h,a).substr(0,a+s);var l="";if(u.path&&(l+="/"+u.path),u.query&&(l+="?"+u.query),l){if((h+l).length>=a)return(h+l).length==e?(h+l).substr(0,e):(h+o(l,a-h.length)).substr(0,a+s);h+=l}if(u.fragment){var d="#"+u.fragment;if((h+d).length>=a)return(h+d).length==e?(h+d).substr(0,e):(h+o(d,a-h.length)).substr(0,a+s);h+=d}if(u.scheme&&u.host){var f=u.scheme+"://";if((h+f).length<a)return(f+h).substr(0,e)}if(h.length<=e)return h;var p="";return a>0&&(p=h.substr(-1*Math.floor(a/2))),(h.substr(0,Math.ceil(a/2))+n+p).substr(0,a+s)}(t,n):"middle"===s?function(t,e,n){if(t.length<=e)return t;var s,i;null==n?(n="&hellip;",s=8,i=3):(s=n.length,i=n.length);var r=e-i,o="";return r>0&&(o=t.substr(-1*Math.floor(r/2))),(t.substr(0,Math.ceil(r/2))+n+o).substr(0,r+s)}(t,n):function(t,e,n){return function(t,e,n){var s;return t.length>e&&(null==n?(n="&hellip;",s=3):s=n.length,t=t.substring(0,e-s)+n),t}(t,e,n)}(t,n)},t}(),A=function(){function t(t){this.__jsduckDummyDocProp=null,this.matchedText="",this.offset=0,this.tagBuilder=t.tagBuilder,this.matchedText=t.matchedText,this.offset=t.offset}return t.prototype.getMatchedText=function(){return this.matchedText},t.prototype.setOffset=function(t){this.offset=t},t.prototype.getOffset=function(){return this.offset},t.prototype.getCssClassSuffixes=function(){return[this.getType()]},t.prototype.buildTag=function(){return this.tagBuilder.build(this)},t}(),w=function(t,e){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function E(t,e){function n(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var O=function(){return(O=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};var T,y=function(t){function e(e){var n=t.call(this,e)||this;return n.email="",n.email=e.email,n}return E(e,t),e.prototype.getType=function(){return"email"},e.prototype.getEmail=function(){return this.email},e.prototype.getAnchorHref=function(){return"mailto:"+this.email},e.prototype.getAnchorText=function(){return this.email},e}(A),C=function(t){function e(e){var n=t.call(this,e)||this;return n.serviceName="",n.hashtag="",n.serviceName=e.serviceName,n.hashtag=e.hashtag,n}return E(e,t),e.prototype.getType=function(){return"hashtag"},e.prototype.getServiceName=function(){return this.serviceName},e.prototype.getHashtag=function(){return this.hashtag},e.prototype.getAnchorHref=function(){var t=this.serviceName,e=this.hashtag;switch(t){case"twitter":return"https://twitter.com/hashtag/"+e;case"facebook":return"https://www.facebook.com/hashtag/"+e;case"instagram":return"https://instagram.com/explore/tags/"+e;default:throw new Error("Unknown service name to point hashtag to: "+t)}},e.prototype.getAnchorText=function(){return"#"+this.hashtag},e}(A),S=function(t){function e(e){var n=t.call(this,e)||this;return n.serviceName="twitter",n.mention="",n.mention=e.mention,n.serviceName=e.serviceName,n}return E(e,t),e.prototype.getType=function(){return"mention"},e.prototype.getMention=function(){return this.mention},e.prototype.getServiceName=function(){return this.serviceName},e.prototype.getAnchorHref=function(){switch(this.serviceName){case"twitter":return"https://twitter.com/"+this.mention;case"instagram":return"https://instagram.com/"+this.mention;case"soundcloud":return"https://soundcloud.com/"+this.mention;default:throw new Error("Unknown service name to point mention to: "+this.serviceName)}},e.prototype.getAnchorText=function(){return"@"+this.mention},e.prototype.getCssClassSuffixes=function(){var e=t.prototype.getCssClassSuffixes.call(this),n=this.getServiceName();return n&&e.push(n),e},e}(A),I=function(t){function e(e){var n=t.call(this,e)||this;return n.number="",n.plusSign=!1,n.number=e.number,n.plusSign=e.plusSign,n}return E(e,t),e.prototype.getType=function(){return"phone"},e.prototype.getPhoneNumber=function(){return this.number},e.prototype.getNumber=function(){return this.getPhoneNumber()},e.prototype.getAnchorHref=function(){return"tel:"+(this.plusSign?"+":"")+this.number},e.prototype.getAnchorText=function(){return this.matchedText},e}(A),k=function(t){function e(e){var n=t.call(this,e)||this;return n.url="",n.urlMatchType="scheme",n.protocolUrlMatch=!1,n.protocolRelativeMatch=!1,n.stripPrefix={scheme:!0,www:!0},n.stripTrailingSlash=!0,n.decodePercentEncoding=!0,n.schemePrefixRegex=/^(https?:\/\/)?/i,n.wwwPrefixRegex=/^(https?:\/\/)?(www\.)?/i,n.protocolRelativeRegex=/^\/\//,n.protocolPrepended=!1,n.urlMatchType=e.urlMatchType,n.url=e.url,n.protocolUrlMatch=e.protocolUrlMatch,n.protocolRelativeMatch=e.protocolRelativeMatch,n.stripPrefix=e.stripPrefix,n.stripTrailingSlash=e.stripTrailingSlash,n.decodePercentEncoding=e.decodePercentEncoding,n}return E(e,t),e.prototype.getType=function(){return"url"},e.prototype.getUrlMatchType=function(){return this.urlMatchType},e.prototype.getUrl=function(){var t=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(t=this.url="http://"+t,this.protocolPrepended=!0),t},e.prototype.getAnchorHref=function(){return this.getUrl().replace(/&amp;/g,"&")},e.prototype.getAnchorText=function(){var t=this.getMatchedText();return this.protocolRelativeMatch&&(t=this.stripProtocolRelativePrefix(t)),this.stripPrefix.scheme&&(t=this.stripSchemePrefix(t)),this.stripPrefix.www&&(t=this.stripWwwPrefix(t)),this.stripTrailingSlash&&(t=this.removeTrailingSlash(t)),this.decodePercentEncoding&&(t=this.removePercentEncoding(t)),t},e.prototype.stripSchemePrefix=function(t){return t.replace(this.schemePrefixRegex,"")},e.prototype.stripWwwPrefix=function(t){return t.replace(this.wwwPrefixRegex,"$1")},e.prototype.stripProtocolRelativePrefix=function(t){return t.replace(this.protocolRelativeRegex,"")},e.prototype.removeTrailingSlash=function(t){return"/"===t.charAt(t.length-1)&&(t=t.slice(0,-1)),t},e.prototype.removePercentEncoding=function(t){var e=t.replace(/%22/gi,"&quot;").replace(/%26/gi,"&amp;").replace(/%27/gi,"&#39;").replace(/%3C/gi,"&lt;").replace(/%3E/gi,"&gt;");try{return decodeURIComponent(e)}catch(t){return e}},e}(A),_=function(t){this.__jsduckDummyDocProp=null,this.tagBuilder=t.tagBuilder},D=/[A-Za-z]/,N=/[\d]/,F=/[\D]/,x=/\s/,P=/['"]/,j=/[\x00-\x1F\x7F]/,B=/A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC/.source,R=B+/\u2700-\u27bf\udde6-\uddff\ud800-\udbff\udc00-\udfff\ufe0e\ufe0f\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0\ud83c\udffb-\udfff\u200d\u3299\u3297\u303d\u3030\u24c2\ud83c\udd70-\udd71\udd7e-\udd7f\udd8e\udd91-\udd9a\udde6-\uddff\ude01-\ude02\ude1a\ude2f\ude32-\ude3a\ude50-\ude51\u203c\u2049\u25aa-\u25ab\u25b6\u25c0\u25fb-\u25fe\u00a9\u00ae\u2122\u2139\udc04\u2600-\u26FF\u2b05\u2b06\u2b07\u2b1b\u2b1c\u2b50\u2b55\u231a\u231b\u2328\u23cf\u23e9-\u23f3\u23f8-\u23fa\udccf\u2935\u2934\u2190-\u21ff/.source+/\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D4-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F/.source,M=/0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19/.source,$=R+M,U=R+M,L="(?:["+M+"]{1,3}\\.){3}["+M+"]{1,3}",G="["+U+"](?:["+U+"\\-]{0,61}["+U+"])?",K=function(t){return"(?=("+G+"))\\"+t},J=function(t){return"(?:"+K(t)+"(?:\\."+K(t+1)+"){0,126}|"+L+")"},z=(new RegExp("["+U+".\\-]*["+U+"\\-]"),new RegExp("["+U+"]")),H=/(?:xn--vermgensberatung-pwb|xn--vermgensberater-ctb|xn--clchc0ea0b2g2a9gcd|xn--w4r85el8fhu5dnra|northwesternmutual|travelersinsurance|vermögensberatung|xn--3oq18vl8pn36a|xn--5su34j936bgsg|xn--bck1b9a5dre4c|xn--mgbai9azgqp6j|xn--mgberp4a5d4ar|xn--xkc2dl3a5ee0h|vermögensberater|xn--fzys8d69uvgm|xn--mgba7c0bbn0a|xn--xkc2al3hye2a|americanexpress|kerryproperties|sandvikcoromant|xn--i1b6b1a6a2e|xn--kcrx77d1x4a|xn--lgbbat1ad8j|xn--mgba3a4f16a|xn--mgbaakc7dvf|xn--mgbc0a9azcg|xn--nqv7fs00ema|afamilycompany|americanfamily|bananarepublic|cancerresearch|cookingchannel|kerrylogistics|weatherchannel|xn--54b7fta0cc|xn--6qq986b3xl|xn--80aqecdr1a|xn--b4w605ferd|xn--fiq228c5hs|xn--h2breg3eve|xn--jlq61u9w7b|xn--mgba3a3ejt|xn--mgbaam7a8h|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a71e|xn--mgbca7dzdo|xn--mgbi4ecexp|xn--mgbx4cd0ab|xn--rvc1e0am3e|international|lifeinsurance|spreadbetting|travelchannel|wolterskluwer|xn--eckvdtc9d|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--h2brj9c8c|xn--tiq49xqyj|xn--yfro4i67o|xn--ygbi2ammx|construction|lplfinancial|scholarships|versicherung|xn--3e0b707e|xn--45br5cyl|xn--80adxhks|xn--80asehdb|xn--8y0a063a|xn--gckr3f0f|xn--mgb9awbf|xn--mgbab2bd|xn--mgbgu82a|xn--mgbpl2fh|xn--mgbt3dhd|xn--mk1bu44c|xn--ngbc5azd|xn--ngbe9e0a|xn--ogbpf8fl|xn--qcka1pmc|accountants|barclaycard|blackfriday|blockbuster|bridgestone|calvinklein|contractors|creditunion|engineering|enterprises|foodnetwork|investments|kerryhotels|lamborghini|motorcycles|olayangroup|photography|playstation|productions|progressive|redumbrella|rightathome|williamhill|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--3bst00m|xn--3ds443g|xn--3hcrj9c|xn--42c2d9a|xn--45brj9c|xn--55qw42g|xn--6frz82g|xn--80ao21a|xn--9krt00a|xn--cck2b3b|xn--czr694b|xn--d1acj3b|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fjq720a|xn--flw351e|xn--g2xx48c|xn--gecrj9c|xn--gk3at1e|xn--h2brj9c|xn--hxt814e|xn--imr513n|xn--j6w193g|xn--jvr189m|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--mgbbh1a|xn--mgbtx2b|xn--mix891f|xn--nyqy26a|xn--otu796d|xn--pbt977c|xn--pgbs0dh|xn--q9jyb4c|xn--rhqv96g|xn--rovu88b|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--vuq861b|xn--w4rs40l|xn--xhq521b|xn--zfr164b|சிங்கப்பூர்|accountant|apartments|associates|basketball|bnpparibas|boehringer|capitalone|consulting|creditcard|cuisinella|eurovision|extraspace|foundation|healthcare|immobilien|industries|management|mitsubishi|nationwide|newholland|nextdirect|onyourside|properties|protection|prudential|realestate|republican|restaurant|schaeffler|swiftcover|tatamotors|technology|telefonica|university|vistaprint|vlaanderen|volkswagen|xn--30rr7y|xn--3pxu8k|xn--45q11c|xn--4gbrim|xn--55qx5d|xn--5tzm5g|xn--80aswg|xn--90a3ac|xn--9dbq2a|xn--9et52u|xn--c2br7g|xn--cg4bki|xn--czrs0t|xn--czru2d|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--io0a7i|xn--kput3i|xn--mxtq1m|xn--o3cw4h|xn--pssy2u|xn--unup4y|xn--wgbh1c|xn--wgbl6a|xn--y9a3aq|accenture|alfaromeo|allfinanz|amsterdam|analytics|aquarelle|barcelona|bloomberg|christmas|community|directory|education|equipment|fairwinds|financial|firestone|fresenius|frontdoor|fujixerox|furniture|goldpoint|hisamitsu|homedepot|homegoods|homesense|honeywell|institute|insurance|kuokgroup|ladbrokes|lancaster|landrover|lifestyle|marketing|marshalls|melbourne|microsoft|panasonic|passagens|pramerica|richardli|scjohnson|shangrila|solutions|statebank|statefarm|stockholm|travelers|vacations|xn--90ais|xn--c1avg|xn--d1alf|xn--e1a4c|xn--fhbei|xn--j1aef|xn--j1amh|xn--l1acc|xn--ngbrx|xn--nqv7f|xn--p1acf|xn--tckwe|xn--vhquv|yodobashi|abudhabi|airforce|allstate|attorney|barclays|barefoot|bargains|baseball|boutique|bradesco|broadway|brussels|budapest|builders|business|capetown|catering|catholic|chrysler|cipriani|cityeats|cleaning|clinique|clothing|commbank|computer|delivery|deloitte|democrat|diamonds|discount|discover|download|engineer|ericsson|esurance|etisalat|everbank|exchange|feedback|fidelity|firmdale|football|frontier|goodyear|grainger|graphics|guardian|hdfcbank|helsinki|holdings|hospital|infiniti|ipiranga|istanbul|jpmorgan|lighting|lundbeck|marriott|maserati|mckinsey|memorial|merckmsd|mortgage|movistar|observer|partners|pharmacy|pictures|plumbing|property|redstone|reliance|saarland|samsclub|security|services|shopping|showtime|softbank|software|stcgroup|supplies|symantec|training|uconnect|vanguard|ventures|verisign|woodside|xn--90ae|xn--node|xn--p1ai|xn--qxam|yokohama|السعودية|abogado|academy|agakhan|alibaba|android|athleta|auction|audible|auspost|avianca|banamex|bauhaus|bentley|bestbuy|booking|brother|bugatti|capital|caravan|careers|cartier|channel|charity|chintai|citadel|clubmed|college|cologne|comcast|company|compare|contact|cooking|corsica|country|coupons|courses|cricket|cruises|dentist|digital|domains|exposed|express|farmers|fashion|ferrari|ferrero|finance|fishing|fitness|flights|florist|flowers|forsale|frogans|fujitsu|gallery|genting|godaddy|grocery|guitars|hamburg|hangout|hitachi|holiday|hosting|hoteles|hotmail|hyundai|iselect|ismaili|jewelry|juniper|kitchen|komatsu|lacaixa|lancome|lanxess|lasalle|latrobe|leclerc|liaison|limited|lincoln|markets|metlife|monster|netbank|netflix|network|neustar|okinawa|oldnavy|organic|origins|philips|pioneer|politie|realtor|recipes|rentals|reviews|rexroth|samsung|sandvik|schmidt|schwarz|science|shiksha|shriram|singles|staples|starhub|storage|support|surgery|systems|temasek|theater|theatre|tickets|tiffany|toshiba|trading|walmart|wanggou|watches|weather|website|wedding|whoswho|windows|winners|xfinity|yamaxun|youtube|zuerich|католик|اتصالات|الجزائر|العليان|پاکستان|كاثوليك|موبايلي|இந்தியா|abarth|abbott|abbvie|active|africa|agency|airbus|airtel|alipay|alsace|alstom|anquan|aramco|author|bayern|beauty|berlin|bharti|blanco|bostik|boston|broker|camera|career|caseih|casino|center|chanel|chrome|church|circle|claims|clinic|coffee|comsec|condos|coupon|credit|cruise|dating|datsun|dealer|degree|dental|design|direct|doctor|dunlop|dupont|durban|emerck|energy|estate|events|expert|family|flickr|futbol|gallup|garden|george|giving|global|google|gratis|health|hermes|hiphop|hockey|hotels|hughes|imamat|insure|intuit|jaguar|joburg|juegos|kaufen|kinder|kindle|kosher|lancia|latino|lawyer|lefrak|living|locker|london|luxury|madrid|maison|makeup|market|mattel|mobile|mobily|monash|mormon|moscow|museum|mutual|nagoya|natura|nissan|nissay|norton|nowruz|office|olayan|online|oracle|orange|otsuka|pfizer|photos|physio|piaget|pictet|quebec|racing|realty|reisen|repair|report|review|rocher|rogers|ryukyu|safety|sakura|sanofi|school|schule|search|secure|select|shouji|soccer|social|stream|studio|supply|suzuki|swatch|sydney|taipei|taobao|target|tattoo|tennis|tienda|tjmaxx|tkmaxx|toyota|travel|unicom|viajes|viking|villas|virgin|vision|voting|voyage|vuelos|walter|warman|webcam|xihuan|yachts|yandex|zappos|москва|онлайн|ابوظبي|ارامكو|الاردن|المغرب|امارات|فلسطين|مليسيا|भारतम्|இலங்கை|ファッション|actor|adult|aetna|amfam|amica|apple|archi|audio|autos|azure|baidu|beats|bible|bingo|black|boats|bosch|build|canon|cards|chase|cheap|cisco|citic|click|cloud|coach|codes|crown|cymru|dabur|dance|deals|delta|dodge|drive|dubai|earth|edeka|email|epost|epson|faith|fedex|final|forex|forum|gallo|games|gifts|gives|glade|glass|globo|gmail|green|gripe|group|gucci|guide|homes|honda|horse|house|hyatt|ikano|intel|irish|iveco|jetzt|koeln|kyoto|lamer|lease|legal|lexus|lilly|linde|lipsy|lixil|loans|locus|lotte|lotto|lupin|macys|mango|media|miami|money|mopar|movie|nadex|nexus|nikon|ninja|nokia|nowtv|omega|osaka|paris|parts|party|phone|photo|pizza|place|poker|praxi|press|prime|promo|quest|radio|rehab|reise|ricoh|rocks|rodeo|rugby|salon|sener|seven|sharp|shell|shoes|skype|sling|smart|smile|solar|space|sport|stada|store|study|style|sucks|swiss|tatar|tires|tirol|tmall|today|tokyo|tools|toray|total|tours|trade|trust|tunes|tushu|ubank|vegas|video|vodka|volvo|wales|watch|weber|weibo|works|world|xerox|yahoo|zippo|ایران|بازار|بھارت|سودان|سورية|همراه|भारोत|संगठन|বাংলা|భారత్|ഭാരതം|嘉里大酒店|aarp|able|adac|aero|aigo|akdn|ally|amex|arab|army|arpa|arte|asda|asia|audi|auto|baby|band|bank|bbva|beer|best|bike|bing|blog|blue|bofa|bond|book|buzz|cafe|call|camp|care|cars|casa|case|cash|cbre|cern|chat|citi|city|club|cool|coop|cyou|data|date|dclk|deal|dell|desi|diet|dish|docs|doha|duck|duns|dvag|erni|fage|fail|fans|farm|fast|fiat|fido|film|fire|fish|flir|food|ford|free|fund|game|gbiz|gent|ggee|gift|gmbh|gold|golf|goog|guge|guru|hair|haus|hdfc|help|here|hgtv|host|hsbc|icbc|ieee|imdb|immo|info|itau|java|jeep|jobs|jprs|kddi|kiwi|kpmg|kred|land|lego|lgbt|lidl|life|like|limo|link|live|loan|loft|love|ltda|luxe|maif|meet|meme|menu|mini|mint|mobi|moda|moto|name|navy|news|next|nico|nike|ollo|open|page|pars|pccw|pics|ping|pink|play|plus|pohl|porn|post|prod|prof|qpon|raid|read|reit|rent|rest|rich|rmit|room|rsvp|ruhr|safe|sale|sarl|save|saxo|scor|scot|seat|seek|sexy|shaw|shia|shop|show|silk|sina|site|skin|sncf|sohu|song|sony|spot|star|surf|talk|taxi|team|tech|teva|tiaa|tips|town|toys|tube|vana|visa|viva|vivo|vote|voto|wang|weir|wien|wiki|wine|work|xbox|yoga|zara|zero|zone|дети|сайт|بارت|بيتك|ڀارت|تونس|شبكة|عراق|عمان|موقع|भारत|ভারত|ভাৰত|ਭਾਰਤ|ભારત|ଭାରତ|ಭಾರತ|ලංකා|グーグル|クラウド|ポイント|大众汽车|组织机构|電訊盈科|香格里拉|aaa|abb|abc|aco|ads|aeg|afl|aig|anz|aol|app|art|aws|axa|bar|bbc|bbt|bcg|bcn|bet|bid|bio|biz|bms|bmw|bnl|bom|boo|bot|box|buy|bzh|cab|cal|cam|car|cat|cba|cbn|cbs|ceb|ceo|cfa|cfd|com|crs|csc|dad|day|dds|dev|dhl|diy|dnp|dog|dot|dtv|dvr|eat|eco|edu|esq|eus|fan|fit|fly|foo|fox|frl|ftr|fun|fyi|gal|gap|gdn|gea|gle|gmo|gmx|goo|gop|got|gov|hbo|hiv|hkt|hot|how|ibm|ice|icu|ifm|inc|ing|ink|int|ist|itv|jcb|jcp|jio|jll|jmp|jnj|jot|joy|kfh|kia|kim|kpn|krd|lat|law|lds|llc|lol|lpl|ltd|man|map|mba|med|men|mil|mit|mlb|mls|mma|moe|moi|mom|mov|msd|mtn|mtr|nab|nba|nec|net|new|nfl|ngo|nhk|now|nra|nrw|ntt|nyc|obi|off|one|ong|onl|ooo|org|ott|ovh|pay|pet|phd|pid|pin|pnc|pro|pru|pub|pwc|qvc|red|ren|ril|rio|rip|run|rwe|sap|sas|sbi|sbs|sca|scb|ses|sew|sex|sfr|ski|sky|soy|srl|srt|stc|tab|tax|tci|tdk|tel|thd|tjx|top|trv|tui|tvs|ubs|uno|uol|ups|vet|vig|vin|vip|wed|win|wme|wow|wtc|wtf|xin|xxx|xyz|you|yun|zip|бел|ком|қаз|мкд|мон|орг|рус|срб|укр|հայ|קום|عرب|قطر|كوم|مصر|कॉम|नेट|คอม|ไทย|ストア|セール|みんな|中文网|天主教|我爱你|新加坡|淡马锡|诺基亚|飞利浦|ac|ad|ae|af|ag|ai|al|am|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw|ελ|бг|ею|рф|გე|닷넷|닷컴|삼성|한국|コム|世界|中信|中国|中國|企业|佛山|信息|健康|八卦|公司|公益|台湾|台灣|商城|商店|商标|嘉里|在线|大拿|娱乐|家電|工行|广东|微博|慈善|手机|手表|招聘|政务|政府|新闻|时尚|書籍|机构|游戏|澳門|点看|珠宝|移动|网址|网店|网站|网络|联通|谷歌|购物|通販|集团|食品|餐厅|香港)/,Y=new RegExp("["+U+"!#$%&'*+/=?^_`{|}~-]"),q=new RegExp("^"+H.source+"$"),W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.localPartCharRegex=Y,e.strictTldRegex=q,e}return E(e,t),e.prototype.parseMatches=function(t){for(var e=this.tagBuilder,n=this.localPartCharRegex,s=this.strictTldRegex,i=[],r=t.length,o=new V,a={m:"a",a:"i",i:"l",l:"t",t:"o",o:":"},u=0,c=0,h=o;u<r;){var l=t.charAt(u);switch(c){case 0:d(l);break;case 1:f(t.charAt(u-1),l);break;case 2:p(l);break;case 3:m(l);break;case 4:v(l);break;case 5:b(l);break;case 6:A(l);break;case 7:w(l);break;default:g(c)}u++}return C(),i;function d(t){"m"===t?E(1):n.test(t)&&E()}function f(t,e){":"===t?n.test(e)?(c=2,h=new V(O(O({},h),{hasMailtoPrefix:!0}))):T():a[t]===e||(n.test(e)?c=2:"."===e?c=3:"@"===e?c=4:T())}function p(t){"."===t?c=3:"@"===t?c=4:n.test(t)||T()}function m(t){"."===t||"@"===t?T():n.test(t)?c=2:T()}function v(t){z.test(t)?c=5:T()}function b(t){"."===t?c=7:"-"===t?c=6:z.test(t)||C()}function A(t){"-"===t||"."===t?C():z.test(t)?c=5:C()}function w(t){"."===t||"-"===t?C():z.test(t)?(c=5,h=new V(O(O({},h),{hasDomainDot:!0}))):C()}function E(t){void 0===t&&(t=2),c=t,h=new V({idx:u})}function T(){c=0,h=o}function C(){if(h.hasDomainDot){var n=t.slice(h.idx,u);/[-.]$/.test(n)&&(n=n.slice(0,-1));var r=h.hasMailtoPrefix?n.slice("mailto:".length):n;(function(t){var e=(t.split(".").pop()||"").toLowerCase();return s.test(e)})(r)&&i.push(new y({tagBuilder:e,matchedText:n,offset:h.idx,email:r}))}T()}},e}(_),V=function(t){void 0===t&&(t={}),this.idx=void 0!==t.idx?t.idx:-1,this.hasMailtoPrefix=!!t.hasMailtoPrefix,this.hasDomainDot=!!t.hasDomainDot},Z=function(){function t(){}return t.isValid=function(t,e){return!(e&&!this.isValidUriScheme(e)||this.urlMatchDoesNotHaveProtocolOrDot(t,e)||this.urlMatchDoesNotHaveAtLeastOneWordChar(t,e)&&!this.isValidIpAddress(t)||this.containsMultipleDots(t))},t.isValidIpAddress=function(t){var e=new RegExp(this.hasFullProtocolRegex.source+this.ipRegex.source);return null!==t.match(e)},t.containsMultipleDots=function(t){var e=t;return this.hasFullProtocolRegex.test(t)&&(e=t.split("://")[1]),e.split("/")[0].indexOf("..")>-1},t.isValidUriScheme=function(t){var e=t.match(this.uriSchemeRegex),n=e&&e[0].toLowerCase();return"javascript:"!==n&&"vbscript:"!==n},t.urlMatchDoesNotHaveProtocolOrDot=function(t,e){return!(!t||e&&this.hasFullProtocolRegex.test(e)||-1!==t.indexOf("."))},t.urlMatchDoesNotHaveAtLeastOneWordChar=function(t,e){return!(!t||!e)&&(!this.hasFullProtocolRegex.test(e)&&!this.hasWordCharAfterProtocolRegex.test(t))},t.hasFullProtocolRegex=/^[A-Za-z][-.+A-Za-z0-9]*:\/\//,t.uriSchemeRegex=/^[A-Za-z][-.+A-Za-z0-9]*:/,t.hasWordCharAfterProtocolRegex=new RegExp(":[^\\s]*?["+B+"]"),t.ipRegex=/[0-9][0-9]?[0-9]?\.[0-9][0-9]?[0-9]?\.[0-9][0-9]?[0-9]?\.[0-9][0-9]?[0-9]?(:[0-9]*)?\/?$/,t}(),X=(T=new RegExp("[/?#](?:["+U+"\\-+&@#/%=~_()|'$*\\[\\]{}?!:,.;^✓]*["+U+"\\-+&@#/%=~_()|'$*\\[\\]{}✓])?"),new RegExp(["(?:","(",/(?:[A-Za-z][-.+A-Za-z0-9]{0,63}:(?![A-Za-z][-.+A-Za-z0-9]{0,63}:\/\/)(?!\d+\/?)(?:\/\/)?)/.source,J(2),")","|","(","(//)?",/(?:www\.)/.source,J(6),")","|","(","(//)?",J(10)+"\\.",H.source,"(?![-"+$+"])",")",")","(?::[0-9]+)?","(?:"+T.source+")?"].join(""),"gi")),Q=new RegExp("["+U+"]"),tt=function(t){function e(e){var n=t.call(this,e)||this;return n.stripPrefix={scheme:!0,www:!0},n.stripTrailingSlash=!0,n.decodePercentEncoding=!0,n.matcherRegex=X,n.wordCharRegExp=Q,n.stripPrefix=e.stripPrefix,n.stripTrailingSlash=e.stripTrailingSlash,n.decodePercentEncoding=e.decodePercentEncoding,n}return E(e,t),e.prototype.parseMatches=function(t){for(var e,n=this.matcherRegex,s=this.stripPrefix,i=this.stripTrailingSlash,r=this.decodePercentEncoding,o=this.tagBuilder,a=[],u=function(){var n=e[0],u=e[1],h=e[4],l=e[5],d=e[9],f=e.index,p=l||d,m=t.charAt(f-1);if(!Z.isValid(n,u))return"continue";if(f>0&&"@"===m)return"continue";if(f>0&&p&&c.wordCharRegExp.test(m))return"continue";if(/\?$/.test(n)&&(n=n.substr(0,n.length-1)),c.matchHasUnbalancedClosingParen(n))n=n.substr(0,n.length-1);else{var g=c.matchHasInvalidCharAfterTld(n,u);g>-1&&(n=n.substr(0,g))}var v=["http://","https://"].find((function(t){return!!u&&-1!==u.indexOf(t)}));if(v){var b=n.indexOf(v);n=n.substr(b),u=u.substr(b),f+=b}var A=u?"scheme":h?"www":"tld",w=!!u;a.push(new k({tagBuilder:o,matchedText:n,offset:f,urlMatchType:A,url:n,protocolUrlMatch:w,protocolRelativeMatch:!!p,stripPrefix:s,stripTrailingSlash:i,decodePercentEncoding:r}))},c=this;null!==(e=n.exec(t));)u();return a},e.prototype.matchHasUnbalancedClosingParen=function(t){var e,n=t.charAt(t.length-1);if(")"===n)e="(";else if("]"===n)e="[";else{if("}"!==n)return!1;e="{"}for(var s=0,i=0,r=t.length-1;i<r;i++){var o=t.charAt(i);o===e?s++:o===n&&(s=Math.max(s-1,0))}return 0===s},e.prototype.matchHasInvalidCharAfterTld=function(t,e){if(!t)return-1;var n=0;e&&(n=t.indexOf(":"),t=t.slice(n));var s=new RegExp("^((.?//)?[-."+U+"]*[-"+U+"]\\.[-"+U+"]+)").exec(t);return null===s?-1:(n+=s[1].length,t=t.slice(s[1].length),/^[^-.A-Za-z0-9:\/?#]/.test(t)?n:-1)},e}(_),et=new RegExp("#[_"+U+"]{1,139}(?![_"+U+"])","g"),nt=new RegExp("[^"+U+"]"),st=function(t){function e(e){var n=t.call(this,e)||this;return n.serviceName="twitter",n.matcherRegex=et,n.nonWordCharRegex=nt,n.serviceName=e.serviceName,n}return E(e,t),e.prototype.parseMatches=function(t){for(var e,n=this.matcherRegex,s=this.nonWordCharRegex,i=this.serviceName,r=this.tagBuilder,o=[];null!==(e=n.exec(t));){var a=e.index,u=t.charAt(a-1);if(0===a||s.test(u)){var c=e[0],h=e[0].slice(1);o.push(new C({tagBuilder:r,matchedText:c,offset:a,serviceName:i,hashtag:h}))}}return o},e}(_),it=new RegExp(/(?:(?:(?:(\+)?\d{1,3}[-\040.]?)?\(?\d{3}\)?[-\040.]?\d{3}[-\040.]?\d{4})|(?:(\+)(?:9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)[-\040.]?(?:\d[-\040.]?){6,12}\d+))([,;]+[0-9]+#?)*/.source+"|"+/(0([1-9]{1}-?[1-9]\d{3}|[1-9]{2}-?\d{3}|[1-9]{2}\d{1}-?\d{2}|[1-9]{2}\d{2}-?\d{1})-?\d{4}|0[789]0-?\d{4}-?\d{4}|050-?\d{4}-?\d{4})/.source,"g"),rt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.matcherRegex=it,e}return E(e,t),e.prototype.parseMatches=function(t){for(var e,n=this.matcherRegex,s=this.tagBuilder,i=[];null!==(e=n.exec(t));){var r=e[0],o=r.replace(/[^0-9,;#]/g,""),a=!(!e[1]&&!e[2]),u=0==e.index?"":t.substr(e.index-1,1),c=t.substr(e.index+r.length,1),h=!u.match(/\d/)&&!c.match(/\d/);this.testMatch(e[3])&&this.testMatch(r)&&h&&i.push(new I({tagBuilder:s,matchedText:r,offset:e.index,number:o,plusSign:a}))}return i},e.prototype.testMatch=function(t){return F.test(t)},e}(_),ot=new RegExp("@[_"+U+"]{1,50}(?![_"+U+"])","g"),at=new RegExp("@[_."+U+"]{1,30}(?![_"+U+"])","g"),ut=new RegExp("@[-_."+U+"]{1,50}(?![-_"+U+"])","g"),ct=new RegExp("[^"+U+"]"),ht=function(t){function e(e){var n=t.call(this,e)||this;return n.serviceName="twitter",n.matcherRegexes={twitter:ot,instagram:at,soundcloud:ut},n.nonWordCharRegex=ct,n.serviceName=e.serviceName,n}return E(e,t),e.prototype.parseMatches=function(t){var e,n=this.serviceName,s=this.matcherRegexes[this.serviceName],i=this.nonWordCharRegex,r=this.tagBuilder,o=[];if(!s)return o;for(;null!==(e=s.exec(t));){var a=e.index,u=t.charAt(a-1);if(0===a||i.test(u)){var c=e[0].replace(/\.+$/g,""),h=c.slice(1);o.push(new S({tagBuilder:r,matchedText:c,offset:a,serviceName:n,mention:h}))}}return o},e}(_);function lt(t,e){for(var n,s=e.onOpenTag,i=e.onCloseTag,r=e.onText,o=e.onComment,a=e.onDoctype,u=new dt,c=0,h=t.length,l=0,d=0,f=u;c<h;){var p=t.charAt(c);switch(l){case 0:m(p);break;case 1:v(p);break;case 2:A(p);break;case 3:b(p);break;case 4:w(p);break;case 5:E(p);break;case 6:T(p);break;case 7:y(p);break;case 8:C(p);break;case 9:S(p);break;case 10:I(p);break;case 11:k(p);break;case 12:_(p);break;case 13:F(p);break;case 14:B(p);break;case 15:R(p);break;case 16:M(p);break;case 17:$(p);break;case 18:U(p);break;case 19:L(p);break;case 20:G(p);break;default:g(l)}c++}function m(t){"<"===t&&J()}function v(t){"!"===t?l=13:"/"===t?(l=2,f=new dt(O(O({},f),{isClosing:!0}))):"<"===t?J():D.test(t)?(l=3,f=new dt(O(O({},f),{isOpening:!0}))):(l=0,f=u)}function b(t){x.test(t)?(f=new dt(O(O({},f),{name:H()})),l=4):"<"===t?J():"/"===t?(f=new dt(O(O({},f),{name:H()})),l=12):">"===t?(f=new dt(O(O({},f),{name:H()})),z()):D.test(t)||N.test(t)||":"===t||K()}function A(t){">"===t?K():D.test(t)?l=3:K()}function w(t){x.test(t)||("/"===t?l=12:">"===t?z():"<"===t?J():"="===t||P.test(t)||j.test(t)?K():l=5)}function E(t){x.test(t)?l=6:"/"===t?l=12:"="===t?l=7:">"===t?z():"<"===t?J():P.test(t)&&K()}function T(t){x.test(t)||("/"===t?l=12:"="===t?l=7:">"===t?z():"<"===t?J():P.test(t)?K():l=5)}function y(t){x.test(t)||('"'===t?l=8:"'"===t?l=9:/[>=`]/.test(t)?K():"<"===t?J():l=10)}function C(t){'"'===t&&(l=11)}function S(t){"'"===t&&(l=11)}function I(t){x.test(t)?l=4:">"===t?z():"<"===t&&J()}function k(t){x.test(t)?l=4:"/"===t?l=12:">"===t?z():"<"===t?J():(l=4,c--)}function _(t){">"===t?(f=new dt(O(O({},f),{isClosing:!0})),z()):l=4}function F(e){"--"===t.substr(c,2)?(c+=2,f=new dt(O(O({},f),{type:"comment"})),l=14):"DOCTYPE"===t.substr(c,7).toUpperCase()?(c+=7,f=new dt(O(O({},f),{type:"doctype"})),l=20):K()}function B(t){"-"===t?l=15:">"===t?K():l=16}function R(t){"-"===t?l=18:">"===t?K():l=16}function M(t){"-"===t&&(l=17)}function $(t){l="-"===t?18:16}function U(t){">"===t?z():"!"===t?l=19:"-"===t||(l=16)}function L(t){"-"===t?l=17:">"===t?z():l=16}function G(t){">"===t?z():"<"===t&&J()}function K(){l=0,f=u}function J(){l=1,f=new dt({idx:c})}function z(){var e=t.slice(d,f.idx);e&&r(e,d),"comment"===f.type?o(f.idx):"doctype"===f.type?a(f.idx):(f.isOpening&&s(f.name,f.idx),f.isClosing&&i(f.name,f.idx)),K(),d=c+1}function H(){var e=f.idx+(f.isClosing?2:1);return t.slice(e,c).toLowerCase()}d<c&&(n=t.slice(d,c),r(n,d),d=c+1)}var dt=function(t){void 0===t&&(t={}),this.idx=void 0!==t.idx?t.idx:-1,this.type=t.type||"tag",this.name=t.name||"",this.isOpening=!!t.isOpening,this.isClosing=!!t.isClosing},ft=function(){function t(e){void 0===e&&(e={}),this.version=t.version,this.urls={},this.email=!0,this.phone=!0,this.hashtag=!1,this.mention=!1,this.newWindow=!0,this.stripPrefix={scheme:!0,www:!0},this.stripTrailingSlash=!0,this.decodePercentEncoding=!0,this.truncate={length:0,location:"end"},this.className="",this.replaceFn=null,this.context=void 0,this.sanitizeHtml=!1,this.matchers=null,this.tagBuilder=null,this.urls=this.normalizeUrlsCfg(e.urls),this.email="boolean"==typeof e.email?e.email:this.email,this.phone="boolean"==typeof e.phone?e.phone:this.phone,this.hashtag=e.hashtag||this.hashtag,this.mention=e.mention||this.mention,this.newWindow="boolean"==typeof e.newWindow?e.newWindow:this.newWindow,this.stripPrefix=this.normalizeStripPrefixCfg(e.stripPrefix),this.stripTrailingSlash="boolean"==typeof e.stripTrailingSlash?e.stripTrailingSlash:this.stripTrailingSlash,this.decodePercentEncoding="boolean"==typeof e.decodePercentEncoding?e.decodePercentEncoding:this.decodePercentEncoding,this.sanitizeHtml=e.sanitizeHtml||!1;var n=this.mention;if(!1!==n&&"twitter"!==n&&"instagram"!==n&&"soundcloud"!==n)throw new Error("invalid `mention` cfg - see docs");var s=this.hashtag;if(!1!==s&&"twitter"!==s&&"facebook"!==s&&"instagram"!==s)throw new Error("invalid `hashtag` cfg - see docs");this.truncate=this.normalizeTruncateCfg(e.truncate),this.className=e.className||this.className,this.replaceFn=e.replaceFn||this.replaceFn,this.context=e.context||this}return t.link=function(e,n){return new t(n).link(e)},t.parse=function(e,n){return new t(n).parse(e)},t.prototype.normalizeUrlsCfg=function(t){return null==t&&(t=!0),"boolean"==typeof t?{schemeMatches:t,wwwMatches:t,tldMatches:t}:{schemeMatches:"boolean"!=typeof t.schemeMatches||t.schemeMatches,wwwMatches:"boolean"!=typeof t.wwwMatches||t.wwwMatches,tldMatches:"boolean"!=typeof t.tldMatches||t.tldMatches}},t.prototype.normalizeStripPrefixCfg=function(t){return null==t&&(t=!0),"boolean"==typeof t?{scheme:t,www:t}:{scheme:"boolean"!=typeof t.scheme||t.scheme,www:"boolean"!=typeof t.www||t.www}},t.prototype.normalizeTruncateCfg=function(t){return"number"==typeof t?{length:t,location:"end"}:function(t,e){for(var n in e)e.hasOwnProperty(n)&&void 0===t[n]&&(t[n]=e[n]);return t}(t||{},{length:Number.POSITIVE_INFINITY,location:"end"})},t.prototype.parse=function(t){var e=this,n=["a","style","script"],s=0,i=[];return lt(t,{onOpenTag:function(t){n.indexOf(t)>=0&&s++},onText:function(t,n){if(0===s){var r=function(t,e){if(!e.global)throw new Error("`splitRegex` must have the 'g' flag set");for(var n,s=[],i=0;n=e.exec(t);)s.push(t.substring(i,n.index)),s.push(n[0]),i=n.index+n[0].length;return s.push(t.substring(i)),s}(t,/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi),o=n;r.forEach((function(t,n){if(n%2==0){var s=e.parseText(t,o);i.push.apply(i,s)}o+=t.length}))}},onCloseTag:function(t){n.indexOf(t)>=0&&(s=Math.max(s-1,0))},onComment:function(t){},onDoctype:function(t){}}),i=this.compactMatches(i),i=this.removeUnwantedMatches(i)},t.prototype.compactMatches=function(t){t.sort((function(t,e){return t.getOffset()-e.getOffset()}));for(var e=0;e<t.length-1;e++){var n=t[e],s=n.getOffset(),i=n.getMatchedText().length,r=s+i;if(e+1<t.length){if(t[e+1].getOffset()===s){var o=t[e+1].getMatchedText().length>i?e:e+1;t.splice(o,1);continue}t[e+1].getOffset()<r&&t.splice(e+1,1)}}return t},t.prototype.removeUnwantedMatches=function(t){return this.hashtag||m(t,(function(t){return"hashtag"===t.getType()})),this.email||m(t,(function(t){return"email"===t.getType()})),this.phone||m(t,(function(t){return"phone"===t.getType()})),this.mention||m(t,(function(t){return"mention"===t.getType()})),this.urls.schemeMatches||m(t,(function(t){return"url"===t.getType()&&"scheme"===t.getUrlMatchType()})),this.urls.wwwMatches||m(t,(function(t){return"url"===t.getType()&&"www"===t.getUrlMatchType()})),this.urls.tldMatches||m(t,(function(t){return"url"===t.getType()&&"tld"===t.getUrlMatchType()})),t},t.prototype.parseText=function(t,e){void 0===e&&(e=0),e=e||0;for(var n=this.getMatchers(),s=[],i=0,r=n.length;i<r;i++){for(var o=n[i].parseMatches(t),a=0,u=o.length;a<u;a++)o[a].setOffset(e+o[a].getOffset());s.push.apply(s,o)}return s},t.prototype.link=function(t){if(!t)return"";this.sanitizeHtml&&(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"));for(var e=this.parse(t),n=[],s=0,i=0,r=e.length;i<r;i++){var o=e[i];n.push(t.substring(s,o.getOffset())),n.push(this.createMatchReturnVal(o)),s=o.getOffset()+o.getMatchedText().length}return n.push(t.substring(s)),n.join("")},t.prototype.createMatchReturnVal=function(t){var e;return this.replaceFn&&(e=this.replaceFn.call(this.context,t)),"string"==typeof e?e:!1===e?t.getMatchedText():e instanceof v?e.toAnchorString():t.buildTag().toAnchorString()},t.prototype.getMatchers=function(){if(this.matchers)return this.matchers;var t=this.getTagBuilder(),e=[new st({tagBuilder:t,serviceName:this.hashtag}),new W({tagBuilder:t}),new rt({tagBuilder:t}),new ht({tagBuilder:t,serviceName:this.mention}),new tt({tagBuilder:t,stripPrefix:this.stripPrefix,stripTrailingSlash:this.stripTrailingSlash,decodePercentEncoding:this.decodePercentEncoding})];return this.matchers=e},t.prototype.getTagBuilder=function(){var t=this.tagBuilder;return t||(t=this.tagBuilder=new b({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),t},t.version="3.14.3",t.AnchorTagBuilder=b,t.HtmlTag=v,t.matcher={Email:W,Hashtag:st,Matcher:_,Mention:ht,Phone:rt,Url:tt},t.match={Email:y,Hashtag:C,Match:A,Mention:S,Phone:I,Url:k},t}();function pt(t,e=t){return{type:"autolink",url:t,text:e}}o(/^([ \t]*`{3,4})(?![^\r?\n]*```)([^\r\n`]*)([\s\S]+?)(^[ \t]*\1)\r?\n?/gm,(([t,e,n,s])=>function(t,e){return{type:"codeblock",language:t,text:e}}(n,s.replace(/^\s*\n/m,"").replace(/\n\s*$/m,"")))),o(/^> (?:.*|\r?\n> )*\r?\n?/gm,(([t])=>function(t=[]){return{type:"blockquote",children:t}}([t.trim().replace(/^> /gm,"")])));const mt=o(/<!!mention:([^>\s]*?)\|(.*?)>/gm,(([t,e,n])=>function(t,e){return{type:"mention",id:t,text:e}}(decodeURIComponent(e),n))),gt=o(/<!!customemoji:(.*?)>/gm,(([t,e])=>function(t){return{type:"customemoji",text:t}}(e))),vt=o(/<((?:https?|mailto):.*?)\|(.*?)>/gi,(([t,e,n])=>function(t,e=[]){return{type:"link",url:t,children:e}}(e,[n]))),bt=o(/<actionlink:([^|]+)[|]([^>]*)>/gi,(([t,e,n])=>{const{action:s,params:i}=wt(e);return function(t,e,n=[]){return{type:"actionlink",action:t,params:e,children:n}}(s,i,[n])})),At=o(/<actionbutton:([^|]+)[|]([^>]*)>/gi,(([t,e,n])=>{const{action:s,params:i}=wt(e);return function(t,e,n=[]){return{type:"actionbutton",action:t,params:e,children:n}}(s,i,[n])}));function wt(t){const e=t.indexOf("?");if(-1===e)return{action:t,params:{}};return{action:t.slice(0,e),params:Object.fromEntries(new URLSearchParams(t.slice(e)))}}const Et=o(/(?:^|\n)(?:\s*[-*+]\s+[^\n]+(?:\n|$))+/g,(([t])=>function(t=[]){return{type:"bulletlist",children:t}}([t.startsWith("\n")?t.slice(1):t]))),Ot=o(/^\s*[-*+]\s+([^\n]+)(?:\n|$)/gm,(([t,e])=>({type:"bulletpoint",children:[e]}))),Tt=t=>{const e=/(?:^|[^-:/\w])([(+]?[0-9](?:[-_+ ().]?[0-9]){5,11}[0-9])(?:[^-:/\w]|$)/g;let n=0;const s=[];for(const r of Object(i.a)(t,e)){const e=r[0],i=r[1],o=e.startsWith(i)?r.index:r.index+1;o-n>0&&s.push(t.substring(n,o));const a=pt("tel:"+i.replace(/[^0-9+]/g,""),i);s.push(a),n=o+i.length}return n<t.length&&s.push(t.substring(n)),s},yt=t=>vt(t).flatMap((t=>"string"==typeof t?Ct(t):["<",...Ct(t.url),...Ct("|"+t.children[0]+">")])),Ct=t=>{const e=ft.parse(t,{urls:!0,email:!0,phone:!1,hashtag:!1,mention:!1}),n=[];let s=0;for(const i of e){const e=i.getOffset(),r=i.getMatchedText(),o=r.length;let a=r;i instanceof y?a="mailto:"+i.getEmail():i instanceof k&&(a=i.getUrl()),e>s&&n.push(t.substring(s,e)),n.push(pt(a,r)),s=e+o}return s<t.length&&n.push(t.substring(s)),n},St=["Codeblock","Codespan","FormattedLink","Wikitext","Autolink","Actions","Mention","Mention","BulletPoint","CustomEmoji"];function It(t={except:[]}){var e;const n={multilineSteps:[],singlelineSteps:[]},s=null!==(e=t.except)&&void 0!==e?e:St.filter((e=>!t.only.includes(e)));return s.includes("BulletPoint")||n.multilineSteps.push(Et,Ot),s.includes("Mention")||n.singlelineSteps.push(mt),s.includes("CustomEmoji")||n.singlelineSteps.push(gt),s.includes("Codespan")||n.multilineSteps.push(o(/```([^]+?)```/g,(([t,e])=>({type:"codespan",text:e})))),s.includes("FormattedLink")||n.singlelineSteps.push(vt),s.includes("Actions")||(n.singlelineSteps.push(bt),n.singlelineSteps.push(At)),s.includes("Wikitext")||n.singlelineSteps.push(l),s.includes("Autolink")||n.singlelineSteps.push(yt,Tt),n}const kt=Object(i.i)("\n");function _t(t,e={except:[]}){let n=function(t,e){let n=[t];return n=Nt(n,e.multilineSteps),n=Nt(n,[kt]),n=Nt(n,e.singlelineSteps),n=Ft(n),n}(t,It(e));return n=xt(n,!1),n}function Dt(t){return _t(t,{except:["FormattedLink","Actions"]})}function Nt(t,e){return e.reduce(((t,e)=>r(t,e)),t)}function Ft(t){const e=[];let n=-1;for(const s of t)"string"==typeof s?"string"==typeof e[n]?e[n]+=s:e[++n]=s:e[++n]="children"in s?Object.assign(Object.assign({},s),{children:Ft(s.children)}):s;return e}function xt(t,e){const n=[];let s=[];for(let i=0;i<t.length;i++){const r=t[i];"string"==typeof r?s.push(r):"children"in r?(s.length>0&&(n.push(s.join("")),s=[]),r.children=xt(r.children,e||"link"===r.type||"actionbutton"===r.type||"actionlink"===r.type),n.push(r)):"autolink"===r.type&&e?s.push(r.text):(s.length>0&&(n.push(s.join("")),s=[]),n.push(r))}return s.length>0&&(n.push(s.join("")),s=[]),n}},267:function(t,e,n){t.exports=n(382)},28:function(t,e,n){"use strict";function s(t,e){for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(t[n],n)}n.d(e,"a",(function(){return s}))},31:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}));n(6);const s=/^\/.*[^\\]\/[im]*$/;function i(t){if(!s.test(t))return!1;return!r(t).test("")}function r(t){const e=t.match(/^\/(.*[^\\])\/(.*)$/);if(!e)throw new Error(`Expected ${t} to be a (non-empty) regex`);let n=e[2]||"";return n=n.replace(/[^im]/g,"")+"g",new RegExp(e[1],n)}function o(t){const e=t.replace(/\./g,"\\.").replace(/\*/g,".*");return new RegExp("^"+e+"$","i")}},33:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var s=n(100),i=n.n(s);function r(t){const e=new i.a("SHA-1","TEXT");return e.update(t),e.getHash("HEX").substr(0,20)}},34:function(t,e,n){"use strict";n.d(e,"g",(function(){return i})),n.d(e,"i",(function(){return r})),n.d(e,"e",(function(){return o})),n.d(e,"d",(function(){return a})),n.d(e,"a",(function(){return u})),n.d(e,"h",(function(){return c})),n.d(e,"c",(function(){return h})),n.d(e,"b",(function(){return l})),n.d(e,"f",(function(){return f}));var s=n(33);function i(t){return"function"==typeof t.then}function r(t){return function(){try{return t.apply(this,arguments)}catch(t){0}}}function o(t){return/(gif|png|jpg|jpeg|svg|bmp)$/i.test(t)}function a(t,e,n){return Object(s.a)(`${t}_${e}_${n||"GLOBAL"}`)}const u=1900;function c(t){const e=t.slice().sort(((t,e)=>t.length-e.length));let n=0,i=0;for(i=0;i!==e.length&&(n+=e[i].length+"&".length,!(n>u));i++);const r=e.slice(0,i).join("&"),o=e.slice(i).join("&");return{short:r,long:o,key:o?Object(s.a)(o):void 0}}function h(t){return e=JSON.stringify(t),btoa(unescape(encodeURIComponent(e)));var e}class l{constructor(t){this.C=t}add(t,e){return new l(this.C.concat([[t,e]]))}split(){return c(this.S())}S(){return this.I||(this.I=this.C.map((([t,e])=>(null==e&&(e=""),"object"==typeof e&&(e=h(e)),t+"="+encodeURIComponent(e))))),this.I}toString(){return this.S().join("&")}}const d={ByV39eoc:1,B1FxElnd:1,aW4c49tW:1,qGfuGtx:1,SbERe5ee:1,ilaVEa15:1,FOlWOSaH:1,dao5gGmT:1,DLUgAhzL:1,fqXFumr6:1,FtiWHMYT:1,"66iWOyWt":1,"1375amYi":1,mWbJgzpt:1,jO7GqAvL:1,SkFIKxo5:1,"2z4ILc3y":1,aDr8oPL1:1,Hku1c4Pt:1};function f(t){return!function(t,e,n){return n=n||0,t.substr(n,e.length)===e}(t,"t")&&!d[t]}},35:function(t,e,n){"use strict";n.d(e,"d",(function(){return s})),n.d(e,"a",(function(){return i})),n.d(e,"g",(function(){return r})),n.d(e,"f",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return u})),n.d(e,"e",(function(){return c}));const{cdnHost:s,appHost:i,restHost:r,realtimeHost:o,appProtocol:a,appWsProtocol:u}=function(){if("undefined"==typeof window)return{cdnHost:"test-hostname",appHost:"test-hostname",appProtocol:"http:",appWsProtocol:"ws:"};const t=function(){if(document.currentScript)return document.currentScript.src;try{throw new Error}catch(t){const e=t.stack.match(/https?:\/\/.*\.(js|jsx|ts|tsx)/);return e?e[0]:""}}(),e=document.createElement("a");e.href=t;const n=e.host,s=function(t){if(t.match(/^cdn[.-]/))return t.replace(/^cdn/,"app");0;if("talkjs.com"===t)return"app.talkjs.com";return t}(n),i=function(t){if(t.match(/^app[.-]/))return t.replace(/^app/,"api");return t+"/public_api"}(s),r=function(t){if(t.match(/^app[.-]/))return t.replace(/^app/,"realtime");return t+"/public_api"}(s),o=e.protocol;return{cdnHost:n,appHost:s,restHost:i,realtimeHost:r,appProtocol:o,appWsProtocol:"https:"===o?"wss:":"ws:"}}();const c=i.startsWith("app.talkjs.com")},38:function(t,e,n){"use strict";var s=n(67);n.d(e,"a",(function(){return s.a})),n.d(e,"b",(function(){return s.b})),n.d(e,"c",(function(){return s.c}))},381:function(t,e,n){t.exports=n.p+"5e83cb28291edefe5f467e9b31453b97.mp3"},382:function(t,e,n){var s,i;(i=function(){"use strict";var t={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3,BASELINE_YEAR:2014,MAX_SCORE:864e6,AMBIGUITIES:{"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Europe/Helsinki","Asia/Damascus","Africa/Cairo","Asia/Gaza","Europe/Minsk"],"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]}},e=function(t){var e=-t.getTimezoneOffset();return null!==e?e:0},n=function(){var n=e(new Date(t.BASELINE_YEAR,0,2)),s=e(new Date(t.BASELINE_YEAR,5,2)),i=n-s;return i<0?n+",1":i>0?s+",1,s":n+",0"},s=function(t){for(var e=new Date(t,0,1,0,0,1,0).getTime(),n=new Date(t,12,31,23,59,59).getTime(),s=e,i=new Date(s).getTimezoneOffset(),o=null,a=null;s<n-864e5;){var u=new Date(s),c=u.getTimezoneOffset();c!==i&&(c<i&&(o=u),c>i&&(a=u),i=c),s+=864e5}return!(!o||!a)&&{s:r(o).getTime(),e:r(a).getTime()}},r=function e(n,s,i){void 0===s&&(s=t.DAY,i=t.HOUR);for(var r=new Date(n.getTime()-s).getTime(),o=n.getTime()+s,a=new Date(r).getTimezoneOffset(),u=r,c=null;u<o-i;){var h=new Date(u);if(h.getTimezoneOffset()!==a){c=h;break}u+=i}return s===t.DAY?e(c,t.HOUR,t.MINUTE):s===t.HOUR?e(c,t.MINUTE,t.SECOND):c},o=function(e){var n=function(){for(var t=[],e=0;e<i.olson.dst_rules.years.length;e++){var n=s(i.olson.dst_rules.years[e]);t.push(n)}return t}();return function(t){for(var e=0;e<t.length;e++)if(!1!==t[e])return!0;return!1}(n)?function(e,n){for(var s=function(s){for(var i=0,r=0;r<e.length;r++)if(s.rules[r]&&e[r]){if(!(e[r].s>=s.rules[r].s&&e[r].e<=s.rules[r].e)){i="N/A";break}if(i=0,i+=Math.abs(e[r].s-s.rules[r].s),(i+=Math.abs(s.rules[r].e-e[r].e))>t.MAX_SCORE){i="N/A";break}}return function(t,e,n,s){if("N/A"!==n)return n;if("Asia/Beirut"===e){if("Africa/Cairo"===s.name&&13983768e5===t[6].s&&14116788e5===t[6].e)return 0;if("Asia/Jerusalem"===s.name&&13959648e5===t[6].s&&14118588e5===t[6].e)return 0}else if("America/Santiago"===e){if("America/Asuncion"===s.name&&14124816e5===t[6].s&&1397358e6===t[6].e)return 0;if("America/Campo_Grande"===s.name&&14136912e5===t[6].s&&13925196e5===t[6].e)return 0}else if("America/Montevideo"===e){if("America/Sao_Paulo"===s.name&&14136876e5===t[6].s&&1392516e6===t[6].e)return 0}else if("Pacific/Auckland"===e&&"Pacific/Fiji"===s.name&&14142456e5===t[6].s&&13961016e5===t[6].e)return 0;return n}(e,n,i,s)},r={},o=i.olson.dst_rules.zones,a=o.length,u=t.AMBIGUITIES[n],c=0;c<a;c++){var h=o[c],l=s(o[c]);"N/A"!==l&&(r[h.name]=l)}for(var d in r)if(r.hasOwnProperty(d))for(var f=0;f<u.length;f++)if(u[f]===d)return d;return n}(n,e):e};return{determine:function(){var s=function(){var t,e;if("undefined"!=typeof Intl&&void 0!==Intl.DateTimeFormat&&void 0!==(t=Intl.DateTimeFormat())&&void 0!==t.resolvedOptions)return(e=t.resolvedOptions().timeZone)&&(e.indexOf("/")>-1||"UTC"===e)&&0!=e.indexOf("Etc")?e:void 0}();return s||(s=i.olson.timezones[n()],void 0!==t.AMBIGUITIES[s]&&(s=o(s))),{name:function(){return s},stdTimezoneOffset:function(){return-n().split(",")[0]},timezoneOffset:function(){return-e(new Date)}}}}}()).olson=i.olson||{},i.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},i.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572e5,s:12090744e5},{e:1250802e6,s:1240524e6},{e:12858804e5,s:12840696e5},!1,!1,!1,{e:14116788e5,s:1406844e6}]},{name:"Africa/Casablanca",rules:[{e:12202236e5,s:12122784e5},{e:12508092e5,s:12438144e5},{e:1281222e6,s:12727584e5},{e:13120668e5,s:13017888e5},{e:13489704e5,s:1345428e6},{e:13828392e5,s:13761e8},{e:14142888e5,s:14069448e5}]},{name:"America/Asuncion",rules:[{e:12050316e5,s:12243888e5},{e:12364812e5,s:12558384e5},{e:12709548e5,s:12860784e5},{e:13024044e5,s:1317528e6},{e:1333854e6,s:13495824e5},{e:1364094e6,s:1381032e6},{e:13955436e5,s:14124816e5}]},{name:"America/Campo_Grande",rules:[{e:12032172e5,s:12243888e5},{e:12346668e5,s:12558384e5},{e:12667212e5,s:1287288e6},{e:12981708e5,s:13187376e5},{e:13302252e5,s:1350792e6},{e:136107e7,s:13822416e5},{e:13925196e5,s:14136912e5}]},{name:"America/Goose_Bay",rules:[{e:122559486e4,s:120503526e4},{e:125704446e4,s:123648486e4},{e:128909886e4,s:126853926e4},{e:13205556e5,s:129998886e4},{e:13520052e5,s:13314456e5},{e:13834548e5,s:13628952e5},{e:14149044e5,s:13943448e5}]},{name:"America/Havana",rules:[{e:12249972e5,s:12056436e5},{e:12564468e5,s:12364884e5},{e:12885012e5,s:12685428e5},{e:13211604e5,s:13005972e5},{e:13520052e5,s:13332564e5},{e:13834548e5,s:13628916e5},{e:14149044e5,s:13943412e5}]},{name:"America/Mazatlan",rules:[{e:1225008e6,s:12074724e5},{e:12564576e5,s:1238922e6},{e:1288512e6,s:12703716e5},{e:13199616e5,s:13018212e5},{e:13514112e5,s:13332708e5},{e:13828608e5,s:13653252e5},{e:14143104e5,s:13967748e5}]},{name:"America/Mexico_City",rules:[{e:12250044e5,s:12074688e5},{e:1256454e6,s:12389184e5},{e:12885084e5,s:1270368e6},{e:1319958e6,s:13018176e5},{e:13514076e5,s:13332672e5},{e:13828572e5,s:13653216e5},{e:14143068e5,s:13967712e5}]},{name:"America/Miquelon",rules:[{e:12255984e5,s:12050388e5},{e:1257048e6,s:12364884e5},{e:12891024e5,s:12685428e5},{e:1320552e6,s:12999924e5},{e:13520016e5,s:1331442e6},{e:13834512e5,s:13628916e5},{e:14149008e5,s:13943412e5}]},{name:"America/Santa_Isabel",rules:[{e:12250116e5,s:1207476e6},{e:12564612e5,s:12389256e5},{e:12885156e5,s:12703752e5},{e:13199652e5,s:13018248e5},{e:13514148e5,s:13332744e5},{e:13828644e5,s:13653288e5},{e:1414314e6,s:13967784e5}]},{name:"America/Santiago",rules:[{e:1206846e6,s:1223784e6},{e:1237086e6,s:12552336e5},{e:127035e7,s:12866832e5},{e:13048236e5,s:13138992e5},{e:13356684e5,s:13465584e5},{e:1367118e6,s:13786128e5},{e:13985676e5,s:14100624e5}]},{name:"America/Sao_Paulo",rules:[{e:12032136e5,s:12243852e5},{e:12346632e5,s:12558348e5},{e:12667176e5,s:12872844e5},{e:12981672e5,s:1318734e6},{e:13302216e5,s:13507884e5},{e:13610664e5,s:1382238e6},{e:1392516e6,s:14136876e5}]},{name:"Asia/Amman",rules:[{e:1225404e6,s:12066552e5},{e:12568536e5,s:12381048e5},{e:12883032e5,s:12695544e5},{e:13197528e5,s:13016088e5},!1,!1,{e:14147064e5,s:13959576e5}]},{name:"Asia/Damascus",rules:[{e:12254868e5,s:120726e7},{e:125685e7,s:12381048e5},{e:12882996e5,s:12701592e5},{e:13197492e5,s:13016088e5},{e:13511988e5,s:13330584e5},{e:13826484e5,s:1364508e6},{e:14147028e5,s:13959576e5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572e5,s:12066552e5},{e:12520152e5,s:12381048e5},{e:1281474e6,s:126964086e4},{e:1312146e6,s:130160886e4},{e:13481784e5,s:13330584e5},{e:13802292e5,s:1364508e6},{e:1414098e6,s:13959576e5}]},{name:"Asia/Irkutsk",rules:[{e:12249576e5,s:12068136e5},{e:12564072e5,s:12382632e5},{e:12884616e5,s:12697128e5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612e5,s:12066624e5},{e:1254006e6,s:1238112e6},{e:1284246e6,s:12695616e5},{e:131751e7,s:1301616e6},{e:13483548e5,s:13330656e5},{e:13828284e5,s:13645152e5},{e:1414278e6,s:13959648e5}]},{name:"Asia/Kamchatka",rules:[{e:12249432e5,s:12067992e5},{e:12563928e5,s:12382488e5},{e:12884508e5,s:12696984e5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612e5,s:12068172e5},{e:12564108e5,s:12382668e5},{e:12884652e5,s:12697164e5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648e5,s:12068208e5},{e:12564144e5,s:12382704e5},{e:12884688e5,s:126972e7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504e5,s:12068064e5},{e:12564e8,s:1238256e6},{e:12884544e5,s:12697056e5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954e6,s:120681e7},{e:12564036e5,s:12382596e5},{e:1288458e6,s:12697092e5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684e5,s:12068244e5},{e:1256418e6,s:1238274e6},{e:12884724e5,s:12697236e5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972e6,s:1206828e6},{e:12564216e5,s:12382776e5},{e:1288476e6,s:12697272e5},{e:13199256e5,s:13011768e5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076e5,s:12231342e5},{e:12388572e5,s:12545838e5},{e:12703068e5,s:12860334e5},{e:13017564e5,s:1317483e6},{e:1333206e6,s:13495374e5},{e:13652604e5,s:1380987e6},{e:139671e7,s:14124366e5}]},{name:"Australia/Perth",rules:[{e:12068136e5,s:12249576e5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]},{name:"Europe/Minsk",rules:[{e:12249792e5,s:12068352e5},{e:12564288e5,s:12382848e5},{e:12884832e5,s:12697344e5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756e5,s:12068316e5},{e:12564252e5,s:12382812e5},{e:12884796e5,s:12697308e5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528e5,s:13168728e5},{e:13332024e5,s:13489272e5},{e:13652568e5,s:13803768e5},{e:13967064e5,s:14118264e5}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984e5,s:12878424e5},{e:13271544e5,s:1319292e6},{e:1358604e6,s:13507416e5},{e:139005e7,s:1382796e6},{e:14215032e5,s:14148504e5}]},{name:"Europe/London",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]}]},void 0!==t.exports?t.exports=i:null!==n(383)&&null!=n(384)?void 0===(s=function(){return i}.apply(e,[]))||(t.exports=s):window.jstz=i},383:function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},384:function(t,e){(function(e){t.exports=e}).call(this,{})},385:function(t,e,n){t.exports=n.p+"b5786376d7c049feb43c8dc0e630738f.css"},386:function(t,e,n){"use strict";n.r(e),e.default={ar:{VOICE_MESSAGE:"رسالة صوتية",LOCATION:"الموقع",DESKTOP_NOTIFICATIONS_ERROR:"لا يمكن تمكين إشعارات المتصفح لأن متصفحك يمنعها بشكل نشط. جرّب البحث في الإعدادات أو استخدام متصفح آخر.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"إعلام $APPNAME التجريبي",DESKTOP_NOTIFICATIONS_DEMO_BODY:"إذا أبقيت علامة تبويب المتصفح مفتوحة ، فسترى هذا ينبثق عندما يتحدث شخص معك."},bg:{VOICE_MESSAGE:"Гласово съобщение",LOCATION:"местоположението",DESKTOP_NOTIFICATIONS_ERROR:"Не можете да активирате известията на браузъра, защото браузърът ви ги блокира активно. Опитайте да погледнете в настройките или да използвате друг браузър.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME демо известие",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Ако държите раздела на браузъра си отворен, ще видите този изскачащ прозорец, когато някой говори с вас."},bs:{VOICE_MESSAGE:"Glasovna poruka",LOCATION:"Lokacija",DESKTOP_NOTIFICATIONS_ERROR:"Notifikacije preglednika se ne mogu omogućiti jer ih vaš preglednik aktivno blokira. Pokušajte pregledati postavke ili koristiti drugi preglednik.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo notifikacija",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Ako karticu preglednika ostavite otvorenu, pojavit će se ovaj pop-up kada netko razgovara s vama."},ca:{VOICE_MESSAGE:"Missatge de veu",LOCATION:"Ubicació",DESKTOP_NOTIFICATIONS_ERROR:"No es poden habilitar les notificacions del navegador perquè el teu navegador les bloqueja activament. Prova de buscar a la configuració o utilitza un altre navegador.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"Notificació de demostració de $APPNAME",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Si mantens la pestanya del navegador oberta, veuràs aquesta notificació quan algú et parli."},cs:{VOICE_MESSAGE:"Hlasová zpráva",LOCATION:"Lokace",DESKTOP_NOTIFICATIONS_ERROR:"Nelze povolit notifikace prohlížeče, protože váš prohlížeč je aktivně blokuje. Zkuste se podívat na nastavení nebo zkuste použít jiný prohlížeč.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo notifikace",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Pokud necháte kartu prohlížeče otevřenou, uvidíte tento popup jakmile s vámi bude někdo mluvit."},da:{VOICE_MESSAGE:"Talebesked",LOCATION:"Placering",DESKTOP_NOTIFICATIONS_ERROR:"Kan ikke aktivere Browsermeddelelser, fordi din browser aktivt blokerer dem. Prøv at kigge i indstillingerne eller benyt en anden browser.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demomeddelelse",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Hvis du holder dit browser-faneblad åben, vil du se det her komme op, når nogen taler til dig."},de:{VOICE_MESSAGE:"Sprachnachricht",LOCATION:"Standort",DESKTOP_NOTIFICATIONS_ERROR:"Browser-Benachrichtigungen können nicht aktiviert werden, da Ihr Browser sie aktiv blockiert. Versuchen Sie, in den Einstellungen nachzuschlagen oder einen anderen Browser zu verwenden.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME Demo-Benachrichtigung",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Wenn Sie Ihre Browser-Registerkarte geöffnet lassen, wird dies angezeigt, wenn jemand mit Ihnen spricht."},el:{VOICE_MESSAGE:"Ηχητικό μήνυμα",LOCATION:"Τοποθεσία",DESKTOP_NOTIFICATIONS_ERROR:"Δεν είναι δυνατή η ενεργοποίηση των ειδοποιήσεων του προγράμματος περιήγησης, επειδή το πρόγραμμα περιήγησης τις αποκλείει ενεργά. Δοκιμάστε να τσεκάρετε τις ρυθμίσεις ή να χρησιμοποιήσετε διαφορετικό πρόγραμμα περιήγησης.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME Δοκιμαστική επίδειξη",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Αν διατηρήσετε ανοιχτή τη σελίδα του προγράμματος περιήγησης, θα δείτε αυτό το pop up (παράθυρο) όταν κάποιος σας μιλάει."},en:{VOICE_MESSAGE:"Voice message",LOCATION:"Location",DESKTOP_NOTIFICATIONS_ERROR:"Can't enable browser notifications because your browser actively blocks them. Try looking in the settings or using a different browser.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo notification",DESKTOP_NOTIFICATIONS_DEMO_BODY:"If you keep your browser tab open, you'll see this pop up when someone talks to you."},es:{VOICE_MESSAGE:"Mensaje de voz",LOCATION:"Ubicación",DESKTOP_NOTIFICATIONS_ERROR:"No se logró habilitar las notificaciones del navigador, comprueba que tu navegador no las esté bloqueando o intenta con otro navegador.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME notificación de prueba",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Si dejas esta pestaña abierta, verás este pop up cuando alguien te hable."},et:{VOICE_MESSAGE:"Häälsõnum",LOCATION:"Asukoht",DESKTOP_NOTIFICATIONS_ERROR:"Töölaua teatisi ei saa lubada, kuna Teie brauser blokeerib need aktiivselt. Proovige muuta seadeid või kasutada mõnda muud brauserit.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo teavitus",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Kui hoiate oma brauseri vahekaardi lahti ja näete seda hüpikakent, siis keegi soovib Teiega rääkida."},fa:{VOICE_MESSAGE:"پیام صوتی",LOCATION:"مکان",DESKTOP_NOTIFICATIONS_ERROR:"خطا در فعال سازی اعلان های مرورگر، مرورگر شما آنها را مسدود می کند سعی کنید تنظیمات مرورگر را تغییر دهید یا از یک مرورگر دیگر استفاده کنید.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"نوتیفیکیشن دمو $APPNAME",DESKTOP_NOTIFICATIONS_DEMO_BODY:"اگر صفحه ی مرورگر را باز نگهدارید این را موقعه ای که کسی با شما صحبت کند خواهید دید"},fi:{VOICE_MESSAGE:"Ääniviesti",LOCATION:"Sijainti",DESKTOP_NOTIFICATIONS_ERROR:"Työpöydän ilmoituksia ei voitu kytkeä päälle, koska selaimesi estää ne aktiivisesti. Koeta tutkia sen asetuksia tai vaihda selainta.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo ilmoitus",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Jos pidät tämän sivun auki, näet vastaavan ilmoituksen kun joku puhuu sinulle."},fr:{VOICE_MESSAGE:"Message vocal",LOCATION:"Emplacement",DESKTOP_NOTIFICATIONS_ERROR:"Impossible d'activer les notifications du navigateur car votre navigateur les bloque. Essayez de changer ses paramètres ou de changer de navigateur.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"Notification de démonstration $APPNAME",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Si vous maintenez l'onglet ouvert dans votre navigateur vous verrez apparaître une alerte lorsque quelqu'un vous parlera."},he:{VOICE_MESSAGE:"הודעה קולית",LOCATION:"מיקום",DESKTOP_NOTIFICATIONS_ERROR:"לא ניתן להפעיל התראות במרועה דפדפן מכיוון שהדפדפן שלך חוסם אותן באופן פעיל. נסה להסתכל בהגדרות או להשתמש בדפדפן אחר.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME הודעה על הדגמה",DESKTOP_NOTIFICATIONS_DEMO_BODY:"אם אתה שומר על כרטיסיית הדפדפן שלך פתוחה, תראה את זה צץ כשמישהו ידבר איתך."},hi:{VOICE_MESSAGE:"वॉयस मैसेज",LOCATION:"जगह",DESKTOP_NOTIFICATIONS_ERROR:"ब्राउज़र सूचनाएं सक्षम नहीं कर सकता क्योंकि आपका ब्राउज़र सक्रिय रूप से उन्हें ब्लॉक करता है। सेटिंग्स में देखने या एक अलग ब्राउज़र का उपयोग करने का प्रयास करें।",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME डेमो अधिसूचना",DESKTOP_NOTIFICATIONS_DEMO_BODY:"यदि आप अपना ब्राउज़र टैब खुला रखते हैं, तो यह पॉप अप आपको तब दिखाई देगा जब कोई आपसे बात करेगा।"},hr:{VOICE_MESSAGE:"Glasovna poruka",LOCATION:"Lokacija",DESKTOP_NOTIFICATIONS_ERROR:"Notifikacije preglednika nisu omogućene jer ih vaš preglednik aktivno blokira. Pokušajte pogledati postavke ili koristiti neki drugi preglednik.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo notifikacija",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Ako karticu preglednika ostavite otvorenu, pojavit će se ovaj pop-up kada netko razgovara s vama."},hu:{VOICE_MESSAGE:"Hangüzenet",LOCATION:"Helyszín",DESKTOP_NOTIFICATIONS_ERROR:"Azért nem tudja bekapcsolni a böngésző értesítések funkciót, mert böngészője aktívan blokkolja azt. Tekintse meg a beállításokat vagy használjon másik böngészőt.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo értesítés",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Ha nyitva hagyja böngészőjét, felugró ablak fog megjelenni, ha valaki beszélni szeretne Önnel."},id:{VOICE_MESSAGE:"Pesan suara",LOCATION:"Lokasi",DESKTOP_NOTIFICATIONS_ERROR:"Tidak dapat mengaktifkan pemberitahuan browser karena browser Anda secara aktif memblokir mereka. Coba cari di pengaturan atau menggunakan browser yang berbeda.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"pemberitahuan demo $APPNAME",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Jika Anda membiarkan tab browser tetap terbuka, Anda akan melihat ini muncul ketika seseorang berbicara kepada Anda."},is:{VOICE_MESSAGE:"Raddskilaboð",LOCATION:"Staðsetning",DESKTOP_NOTIFICATIONS_ERROR:"Ekki er hægt að birta tilkynningar í vafra vegna þess að vafrinn sem þú notar hindrar það. Reyndu að leita að stillingum eða að nota annan vafra.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME prufutilkynning",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Ef flipinn í vafranum er opinn muntu sjá þessa tilkynningu birtast þegar einhver sendir þér skilaboð."},it:{VOICE_MESSAGE:"Messaggio vocale",LOCATION:"Posizione",DESKTOP_NOTIFICATIONS_ERROR:"Impossibile abilitare le notifiche browser perché il browser le blocca attivamente. Prova a cercare le impostazioni o utilizzare un browser diverso.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo notification",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Se si mantiene aperta la scheda del browser, questo verrà visualizzato quando qualcuno ti parla."},ja:{VOICE_MESSAGE:"ボイスメッセージ",LOCATION:"場所",DESKTOP_NOTIFICATIONS_ERROR:"ブラウザの通知はブロックされているため、ブラウザの通知を有効にできません。設定を確認するか、別のブラウザを使用してください。",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME デモ通知",DESKTOP_NOTIFICATIONS_DEMO_BODY:"ブラウザのタブを開いたままにしておくと、誰かがあなたに話しかけたときにこのポップアップが表示されます。"},ka:{VOICE_MESSAGE:"ხმოვანი შეტყობინება",LOCATION:"ადგილმდებარეობა",DESKTOP_NOTIFICATIONS_ERROR:"შეუძლებელია ბრაუზერის შეტკობინებების ჩართვა. ეს ბრაუზერი ბლოკავს მათ. სცადე ცვლილება ოპციებიდან ან გამოიყენე სხვა ბრაუზერი.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME შეტყობინებების დემო ვერსია",DESKTOP_NOTIFICATIONS_DEMO_BODY:"თუ დატოვებ ბრაუზერის ფანჯარას გახსნილს, როცა ვიღაც მოგწერს საუბარი ამოვარდება დესკტოპზე."},ko:{VOICE_MESSAGE:"음성 메시지",LOCATION:"위치",DESKTOP_NOTIFICATIONS_ERROR:"브라우저 알림을 표시할 수 없습니다. 브라우저 설정을 확인하거나 다른 브라우저를 사용해주세요.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME 데모 알림",DESKTOP_NOTIFICATIONS_DEMO_BODY:"브라우저 탭을 열어 둔 상태에서 누군가 대화 할 때 이 팝업이 표시됩니다."},nb:{VOICE_MESSAGE:"Lydmelding",LOCATION:"Plassering",DESKTOP_NOTIFICATIONS_ERROR:"Kan ikke aktivere Nettleservarsler fordi nettleseren din aktivt blokkerer dem. Prøv å se i innstillingene eller bruke en annen nettleser.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo varslinger",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Hvis du holder nettleservinduet åpent, vil du se dette varsel når noen snakker til deg."},nl:{VOICE_MESSAGE:"Spraakbericht",LOCATION:"Locatie",DESKTOP_NOTIFICATIONS_ERROR:"Browsermeldingen kunnen niet geactiveerd worden omdat de browser het blokkeert. Check de instellingen van je browser of probeer een andere browser.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo notificatie",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Als je je browser open houdt, zie je deze popup als iemand tegen je praat."},pl:{VOICE_MESSAGE:"Wiadomość głosowa",LOCATION:"Lokalizacja",DESKTOP_NOTIFICATIONS_ERROR:"Nie można aktywować powiadomień, ponieważ twoja przeglądarka je blokuje. Proszę zmienić ustawienie lub spróbować innej przeglądarki.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME przykładowe powiadomienie",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Jeśli zostawisz tę kartę otwartą, zobaczysz takie powiadomienie, gdy ktoś napisze do Ciebie."},pt:{VOICE_MESSAGE:"Mensagem de voz",LOCATION:"Localização",DESKTOP_NOTIFICATIONS_ERROR:"Não é possível ativar as notificações da navegador porque seu navegador as bloqueia. Tente procurar nas configurações ou usar um navegador diferente.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME notificação de demonstração",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Se você mantiver a guia do navegador aberta, verá essa mensagem quando alguém falar com você."},ro:{VOICE_MESSAGE:"Mesaj vocal",LOCATION:"Locație",DESKTOP_NOTIFICATIONS_ERROR:"Nu se pot activa notificări browser deoarece browserul dvs. le blochează în mod activ. Încercați să căutați în setări sau utilizând un alt browser.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"Notificare de debit $APPNAME",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Dacă țineți fișa browserului deschis, veți vedea acest pop-up atunci când cineva vorbește cu dvs."},ru:{VOICE_MESSAGE:"Голосовое сообщение",LOCATION:"Местоположение",DESKTOP_NOTIFICATIONS_ERROR:"Невозможно включить оповещения, потому что ваш браузер активно блокирует их. Проверьте ваши настройки или попробуйте другой браузер.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME демо-оповещение",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Если вкладка вашего браузера открыта, вы увидите всплывающее окошко оповещения когда кто-то отправит вам сообщение."},sq:{VOICE_MESSAGE:"Mesazh zanor",LOCATION:"Pozicion",DESKTOP_NOTIFICATIONS_ERROR:"Nuk mund të aktivizohen njoftimet në shfletues sepse shfletuesi juaj i bllokon ato në mënyrë aktive. Provoni të shikoni cilësimet ose përdorni një shfletues të ndryshëm.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME njoftime në desktop",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Lënia e skedës së shfletuesit tuaj të hapur do të pop-up kur dikush flet me ju."},sr:{VOICE_MESSAGE:"Glasovna poruka",LOCATION:"Lokacija",DESKTOP_NOTIFICATIONS_ERROR:"Browser notifikacije nisu omogućene jer ih vaš pregledač aktivno blokira. Pokušajte pogledati postavke ili koristiti neki drugi pregledač.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demo notifikacija",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Ako karticu pregledača ostavite otvorenu, pojaviće se ovaj pop-up kada neko razgovara s vama."},sv:{VOICE_MESSAGE:"Röstmeddelande",LOCATION:"Plats",DESKTOP_NOTIFICATIONS_ERROR:"Kan inte aktivera webbläsarnotiser eftersom din webbläsare aktivt blockerar dem. Se över inställningarna eller använd en annan webbläsare.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME demonotis",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Om du har fliken i webbläsaren öppen så kommer den här notisen visas när någon pratar med dig."},tr:{VOICE_MESSAGE:"Sesli mesaj",LOCATION:"Konum",DESKTOP_NOTIFICATIONS_ERROR:"Tarayıcınız aktif olarak engellediğinden tarayıcı bildirimlerini etkinleştiremiyoruz. Ayarları kontrol etmeyi veya farklı bir tarayıcı kullanmayı deneyebilirsiniz.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME test bildirimi",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Eğer tarayıcınızın penceresini açık tutarsanız biri mesaj yazdığında bu bildirimi göreceksiniz."},uk:{VOICE_MESSAGE:"Голосове повідомлення",LOCATION:"Місцезнаходження",DESKTOP_NOTIFICATIONS_ERROR:"Неможливо ввімкнути сповіщення в браузері, оскільки ваш веб-переглядач активно їх блокує. Спробуйте переглянути налаштування або використовувати інший браузер.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"Демо-повідомлення про $APPNAME",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Якщо ви відкриєте вкладку веб-переглядача відкритою, ви побачите це спливаюче вікно, коли хтось спілкується з вами."},vi:{VOICE_MESSAGE:"Tin nhắn thoại",LOCATION:"Địa điểm",DESKTOP_NOTIFICATIONS_ERROR:"Không thể bật thông báo trên trình duyệt vì trình duyệt của bạn đang tắt chức năng này. Hãy thử tìm trong cài đặt trình duyệt hoặc sử dụng một trình duyệt khác.",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME thông báo thử nghiệm",DESKTOP_NOTIFICATIONS_DEMO_BODY:"Nếu bạn giữ tab trình duyệt của bạn mở, bạn sẽ thấy cửa sổ bật lên khi ai đó nói chuyện với bạn."},zh:{VOICE_MESSAGE:"语音消息",LOCATION:"地点",DESKTOP_NOTIFICATIONS_ERROR:"因浏览器设置为阻止，所以无法激活浏览器提醒。请去设置里查看或者尝试其他的浏览器。",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME 演示提醒",DESKTOP_NOTIFICATIONS_DEMO_BODY:"只要保持浏览器开着，如果有人和你对话，将会自动弹出对话窗口。"},"zh-tw":{VOICE_MESSAGE:"語音訊息",LOCATION:"地點",DESKTOP_NOTIFICATIONS_ERROR:"無法啟用瀏覽器通知，因為您的瀏覽器主動阻止它們。 嘗試查看設置或使用其他瀏覽器。",DESKTOP_NOTIFICATIONS_DEMO_TITLE:"$APPNAME 演示通知",DESKTOP_NOTIFICATIONS_DEMO_BODY:"如果您持續打開瀏覽器標籤頁，當有人與您通話時，您會看到此彈出窗口。"}}},403:function(t,e,n){"use strict";n.r(e);var s,i=n(35);n.p=i.b+"//"+i.d+n.p,function(t){t[t.NOTIFICATIONS_PERMISSION_DENIED=0]="NOTIFICATIONS_PERMISSION_DENIED",t[t.NOTIFICATIONS_NOT_SUPPORTED=1]="NOTIFICATIONS_NOT_SUPPORTED",t[t.ARGUMENT_INVALID=2]="ARGUMENT_INVALID"}(s||(s={}));class r extends Error{constructor(t,e){super(`[TalkJS] ${e}`),this.code=t,Object.setPrototypeOf&&Object.setPrototypeOf(this,new.target.prototype)}}function o(t,e,n,i=[]){const o=p(t);if(-1===e.indexOf(o))throw new r(s.ARGUMENT_INVALID,n);for(let e of i)if(!e(t))throw new r(s.ARGUMENT_INVALID,n);return t}function a(t,e,n){if(-1===e.indexOf(t))throw new r(s.ARGUMENT_INVALID,n)}function u(t,e,n){for(let s in t)o(t[s],e,n(s,t[s]))}function c(t,e,n,s,i,r=[]){void 0!==n&&(t[e]=o(n,s,i,r))}function h(t){return""!==t}function l(t){return!t||/^[a-z]{1,3}(-.+)?$/.test(t)}function d(t){return!(["ios","android"].indexOf(t)<0)}function f(t){return!(["fcm","apns"].indexOf(t)<0)}function p(t){if(null===t)return"null";const e=typeof t;return"object"!==e?e:t instanceof Array?t.length?p(t[0])+"[]":"[]":e}r.Code=s;class m{constructor(t,e){this.user=t,e=o(e,["undefined","object"],'Conversation.setParticipants: optional field "settings" is given but not an object.');let{access:n,notify:s}=e||{access:void 0,notify:void 0};n=o(n,["undefined","string"],'Conversation.setParticipants: optional field "settings.access" is given but not one of "ReadWrite" or "Read".',[t=>void 0===t||("Read"===t||"ReadWrite"===t)]),s=o(s,["undefined","boolean","string"],'Conversation.setParticipants: optional field "settings.notify" is given but not a boolean or "MentionsOnly".',[t=>void 0===t||"boolean"==typeof t||"MentionsOnly"===t]),this.participationSettings={access:n,notify:s},this.participationSetting=this.participationSettings}}var g=n(33);function v(t){return[t=(t=o(t,["string","number"],'User: required field "id" is not given or not a string or a number.',[h])).toString(),Object(g.a)(t)+"_n"]}var b=n(20);class A{constructor(t={}){if("string"==typeof(e=t)||e instanceof String||"number"==typeof e||e instanceof Number)this.__sync=!1,[this.id,this.internalId]=v(t);else{this.__sync=!0;let{id:e,name:n,email:s,phone:i,photoUrl:r,welcomeMessage:a,role:d,configuration:f,custom:p,availabilityText:m,locale:g}=t;[this.id,this.internalId]=v(e),c(this,"email",s,["null","undefined","string","string[]"],`User ${e}: optional field "email" is not a string or array of strings. Pass \`null\` if you're sure the user should never get emails`,[h]),c(this,"phone",i,["null","undefined","string","string[]"],`User ${e}: optional field "phone" is given but not a string or array of strings.`,[h]);const A=[].concat(void 0===this.phone||null===this.phone?[]:this.phone);for(let t of A)if(!/^\+[1-9]\d{1,14}$/.test(t))throw new Error(`User ${e}: optional field "phone" does not conform E.164 standard. Numbers should start with a plus, followed by a country code and then the phone number. Numbers must not have any other special characters like dashes or spaces. For example, a UK phone number 0123456789 would be formatted as "+44123456789" (${t}).`);this.name=o(n,["string"],`User ${e}: required field "name" is not given or not a string or is an empty string.`,[h]),c(this,"welcomeMessage",a,["null","undefined","string"],`User ${e}: optional field "welcomeMessage" is given but not a string or is an empty string.`,[h]),c(this,"role",d,["null","undefined","string"],`User ${e}: optional field "role" is given but not a string or is an empty string.`,[h]),c(this,"configuration",f,["null","undefined","string"],`User ${e}: optional field "configuration" is given but not a string or is an empty string.`,[h]),c(this,"custom",p,["null","undefined","object"],`User ${e}: optional field "custom" is given but not an object.`),r=o(r,["null","undefined","string"],`User ${e}: optional field "photoUrl" is given but not a string or is an empty string.`,[h]),this.photoUrl=r?Object(b.e)(r):r,c(this,"availabilityText",m,["null","undefined","string"],`User ${e}: optional field "availabilityText" is given but not a string or is an empty string.`,[h]),c(this,"locale",g,["null","undefined","string"],`User ${e}: optional field "locale" is given but not a string or is an empty string or does not conform the BCP 47 format.`,[h,l]),this.custom&&u(this.custom,["string","null"],(t=>`User ${e}: optional field "custom.${t}" is given but not a string.`)),this.configuration||this.role||console.warn(`[TalkJS] No role is set for user ${e}. TalkJS will work, but with some features disabled (such as email notifications).`),this.configuration&&this.role&&console.warn(`[TalkJS] A configuration and role was set for the user ${e}, the assigned role will take presedence over a configuration.`),this.role&&(this.configuration=this.role)}var e}}function w(t){return null===t||(void 0===t||("string"==typeof t||"id"in t&&"string"==typeof t.id))}function E(t){if(!t)return!1;if("string"==typeof t)return!1;if("subscribe"in t&&"participant"in t&&"message"in t){return!0}return!1}function O(t){if(!t)return!1;if("object"!=typeof t)return!1;if("participants"in t){return!0}return!1}class T{constructor({conversationId:t,participants:e,topicId:n,subject:s,photoUrl:i,welcomeMessages:r,custom:a}){this.participants=[],this.id=o(t,["string"],"Conversation: field conversationId cannot be empty.",[h]);for(let t of e)this.participants.map((t=>t.user.id)).indexOf(t.user.id)<0&&this.participants.push(t);c(this,"subject",s,["null","undefined","string"],'Conversation: optional field "subject" is given but not a string.'),i=o(i,["null","undefined","string"],'Conversation: optional field "photoUrl" is given but not a string or is an empty string.',[h]),this.photoUrl=i?Object(b.e)(i):i,c(this,"welcomeMessages",r,["null","undefined","string[]"],'Conversation: optional field "welcomeMessages" is given but not an array of strings.'),c(this,"custom",a,["null","undefined","object"],'Conversation: optional field "custom" is given but not an object.'),this.custom&&u(this.custom,["string"],(t=>`Field "custom.${t}" must be a string.`)),void 0!==(n=null!=n?n.toString():void 0)&&(this.topicId=o(n,["string"],'Conversation: optional field "topicId" is given but not a string or is an empty string.',[h])),this.internalId=S(this.id)}}class y{constructor(t,e){this.D=e,this.participants=[],this.id=o(t,["string"],"Conversation: field conversationId cannot be empty.",[h]),this.internalId=S(this.id)}setParticipant(t,e){if(this.D.N(),!(t instanceof A))throw new Error("[TalkJS] The first argument of ConversationBuilder#setParticipant should be of type Talk.User. For example:\n            \nvar user = new Talk.User(data);\nconversation.setParticipant(user);\n            \nFor more information check our documentation https://talkjs.com/docs/Reference/JavaScript_Chat_SDK/ConversationBuilder.html#setparticipant\n            ");this.participants=this.participants.filter((e=>e.user.id!==t.id)),this.participants.push(new m(t,e))}setAttributes(t){this.D.N(),c(this,"subject",t.subject,["null","undefined","string"],'Conversation.setAttributes: optional field "subject" is given but not a string.'),c(this,"custom",t.custom,["null","undefined","object"],'Conversation.setAttributes: optional field "custom" is given but not an object.');const e=o(t.photoUrl,["null","undefined","string"],'Conversation.setAttributes: optional field "photoUrl" is given but not a string or is an empty string.',[h]);this.photoUrl=e?Object(b.e)(e):e,c(this,"welcomeMessages",t.welcomeMessages,["null","undefined","string[]"],'Conversation.setAttributes:Conversation: optional field "welcomeMessages" is given but not an array of strings'),this.custom&&u(this.custom,["null","string"],(t=>`Conversation.setAttributes: Field "custom.${t}" must be a string.`))}sendMessage(t,{custom:e}={}){this.D.N(),t=o(t,["string"],"sendMessage() accepts a single String value representing the text of the message"),null!=e&&(o(e,["object","undefined"],`'custom' should be an object whose keys and values are all strings, got: \`${e}\``),u(e,["string"],(t=>`Value of field "custom.${t}" must be a string.`)));const n=this.internalId;return this.D.F.then((s=>s.sendMessage({text:t,custom:e},n)))}leave(){this.D.N();const t=this.internalId;return this.D.F.then((e=>e.leaveConversation(t)))}markAsUnread(){this.D.N();const t=this.internalId;return this.D.F.then((e=>e.markConversationAsUnread(t)))}}function C(t,e,n){return"string"==typeof t&&(t=new A(t)),"string"==typeof e&&(e=new A(e)),function(t,e){const n=t.map((t=>t.id));n.sort();let s={p:n};return void 0!==e&&(s.t=e),JSON.stringify(s)}([t,e],n)}function S(t){return Object(g.a)(t)}var I=n(18),k=n(63),_=n(34);const D=function(){try{return Audio&&new Audio(n(381))}catch(t){return null}}();function N(){return window.Notification&&"granted"===Notification.permission}let F=[];function x({title:t,body:e,conversationId:n}={},s){if(e){if(D)try{D.play()}catch(t){}var i=new Notification(t||"",{body:e,icon:K()});i.onclick=()=>{window.focus(),s()},F.push(i)}}window.addEventListener("focus",(function(){F.forEach(Object(_.i)((t=>t.close()))),F=[]}));let P=!1,j=0;const B="talkjs:desktop_notifications";function R(){const t=k.a.get(B);if(t&&"string"==typeof t)try{return JSON.parse(t)}catch(t){return{}}return{}}function M(t){k.a.set(B,JSON.stringify(t))}function $(t,e){return`${t}:${e}`}function U(t,e){if(!N())return!1;const n=R(),s=$(t,e),i=k.a.get(s);return null!==i?(k.a.removeItem(s),n[s]=Boolean(i),M(n),n[s]):void 0!==n[s]&&n[s]}async function L(t,{appId:e,userId:n,locale:s,alertOnFailure:i,appName:o,emitBrowserPermissionNeeded:a,emitBrowserPermissionDenied:u}){const c=R(),h=$(e,n);if(c[h]=t,M(c),t)try{switch(await async function(t){if(N())return"granted";if(!window.Notification)throw new r(r.Code.NOTIFICATIONS_NOT_SUPPORTED,"The browser doesn't support desktop notifications.");if("cancel"===await t())return"cancelled";return await new Promise((t=>Notification.requestPermission(t))),N()?"granted":"denied"}(a)){case"cancelled":return c[h]=!1,M(c),!1;case"granted":return o&&function(t,e){x({title:e.t("DESKTOP_NOTIFICATIONS_DEMO_TITLE",{APPNAME:t}),body:e.t("DESKTOP_NOTIFICATIONS_DEMO_BODY")},(()=>{}))}(o,s),!0;case"denied":throw c[h]=!1,M(c),u(),new r(r.Code.NOTIFICATIONS_PERMISSION_DENIED,"The user or the browser denied permission to send notifications.")}}catch(t){throw i&&alert(s.t("DESKTOP_NOTIFICATIONS_ERROR")),t}return!0}let G;function K(){if(G)return G;let t=document.getElementsByTagName("head")[0].getElementsByTagName("link"),e=[];for(let n=t.length-1;n>=0;n--)/(^|\s)icon(\s|$)/i.test(t[n].getAttribute("rel")||"")&&e.push(t[n]);const n=e.reduce(((t,e)=>J(t)>J(e)?t:e),void 0);return G=n&&n.getAttribute("href")||void 0,G}function J(t){return parseInt(t&&(t.getAttribute("sizes")||"").split("x")[0]||"0")}var z=n(47),H=n(6),Y=n(19);class q{constructor(t,e,n,s,i,r){this.D=t,this.F=e,this.P=n,this.B=s,this.externalMeId=i,this.R=r,this.M={change:()=>this.$()},this.U=new z.a({change(t){}},this.M),this.L={},this.G=void 0,this.K=!1,this.J=({id:t,data:e})=>{delete this.L[t]},this.H=(t,{emitNewMessageEvent:e})=>{const n=t||[];let s=[];for(let t of n){const n=this.L[t.id];if(void 0===n&&!this.isSideDtoComplete(t))break;t=Object.assign(Object.assign({},n),t),e&&(!n||t.lastMessageTs>n.lastMessageTs)&&s.push(t),this.L[t.id]=t}const i=Object.keys(this.L).map((t=>this.L[t])).filter((t=>t.canIRead&&!1===t.lastMessageRead));this.Y(i,s).then((({unreadSns:t,newMessageSns:e})=>{this.q(t);const n=e.filter((t=>!t.side.lastMessageRead));for(let t of n)this.W(t);this.V(e)})).catch((()=>{}))},this.senderSubscriptions={},this.F.then((t=>{this.Z=t})).catch((()=>{}))}$(){this.X||(this.X=this.F.then((()=>{this.tt({amount:Y.a.INITIAL_CHATS_LOADED+1})})).catch((()=>{})))}nt(){return this.Z.getOrJoinChannel(`seq/sides/${this.Z.me.internalId}`)}st(t){this.$(),this.X.then((()=>this.tt(t)))}tt({amount:t,lastChatTs:e}){const n=this.nt();n.on("recordUpdated",(t=>this.H(t.data,{emitNewMessageEvent:!0}))),n.on("recordDeleted",(t=>this.J(t))),n.push("get_all",{limit:t,oldestRecordTs:e}).receive("ok",(t=>this.H(t.data,{emitNewMessageEvent:!1})))}async Y(t,e){this.rt([...t,...e]);const n=[];for(const e of t){const t=e.lastMessageSenderExternalId;if(null===t)n.push({side:e,sender:null});else{const s=this.senderSubscriptions[t],i=await s.connected;n.push({side:e,sender:i.latestSnapshot})}}const s=[];for(const t of e){const e=t.lastMessageSenderExternalId;if(null===e)s.push({side:t,sender:null});else{const n=this.senderSubscriptions[e],i=await n.connected;s.push({side:t,sender:i.latestSnapshot})}}return{unreadSns:n,newMessageSns:s}}rt(t){const e=t.filter((t=>null!==t.lastMessageSenderExternalId)).map((t=>t.lastMessageSenderExternalId)),n=new Set(e);for(const t of Object.keys(this.senderSubscriptions))n.has(t)||(this.senderSubscriptions[t].unsubscribe(),delete this.senderSubscriptions[t]);for(const t of n)Object.hasOwnProperty.call(this.senderSubscriptions,t)||(this.senderSubscriptions[t]=this.D.user(t).subscribe())}ot(t,e){if(t.length!==e.length)return!0;for(let n of t){const t=e.filter((t=>t.lastMessage.conversation.id===n.lastMessage.conversation.id))[0];if(!t)return!0;const s=n.lastMessage,i=t.lastMessage;if(s.body!==i.body)return!0;if(s.conversation.id!==i.conversation.id)return!0;if(s.isByMe!==i.isByMe)return!0;if(s.read!==i.read)return!0;if(s.timestamp!==i.timestamp)return!0;if(s.type!==i.type)return!0}return!1}q(t){const e=t.map((t=>{const e=this.makeMessage(t);return{lastMessage:e,unreadMessageCount:t.side.unreadMessageCount,conversation:e.conversation}}));this.G&&!this.ot(e,this.G)||this.U.emit("change",e),this.G=e}V(t){for(let e of t)this.P(this.makeMessage(e))}W({side:t,sender:e}){if(!this.R.isLeader)return;const n=Date.now();if(null!==t.lastMessageSenderId&&null!==e){this.ut={body:this.ct(t),title:e.name};const s=Date.now()-n,i=()=>this.B(this.makeConversation(t));!function(t,e,n,s=500,i){!P&&U(e,n)&&(j+100>Date.now()||(P=!0,setTimeout((()=>{try{if(!document.hasFocus()){const e=t();e&&x(e,i)}}finally{P=!1,j=Date.now()}}),s)))}((()=>this.ut),this.D.appId,this.D.me.id,Math.max(0,500-s),i)}}ht(t){return function(e){let n,s=[];for(t.lastIndex=0;n=t.exec(e);){const t=n[0],e=n.index;s.push({offset:e,matchedText:t,regexMatch:n})}return s}}ct(t){if("text"===t.lastMessageType){if("rest"===t.lastMessageOrigin){this.ht(/<((?:https?|mailto):.*?)\|(.*?)>/gi)(t.lastMessageBody).forEach((e=>{t.lastMessageBody=t.lastMessageBody.replace(e.regexMatch[0],e.regexMatch[2])}))}return t.lastMessageBody}if("location"===t.lastMessageType)return"📍 Shared location";if("media"===t.lastMessageType&&t.lastMessageAttachment){const{url:e}=t.lastMessageAttachment,n=Object(H.c)(e);return Object(_.e)(n)?`📷 ${n}`:`[↓] ${n}`}return""}makeMessage({side:t,sender:e}){let n;n=t.lastMessageSenderExternalId?Object.assign(Object.assign({},e),{configuration:null==e?void 0:e.role,email:"<suppressed>",phone:"<suppressed>"}):null;const s=null===t.lastMessageAttachment?null:{url:t.lastMessageAttachment.url,size:t.lastMessageAttachment.size,dimensions:Object(b.g)(t.lastMessageAttachment)};return{id:t.lastMessageExternalId,conversation:this.makeConversation(t),isByMe:t.isByMe,senderId:t.lastMessageSenderExternalId,sender:n,body:t.lastMessageBody,type:t.lastMessageType,timestamp:t.lastMessageTs,read:t.lastMessageRead,origin:t.lastMessageOrigin,custom:t.lastMessageCustom,attachment:s,location:t.lastMessageLocation}}makeConversation(t){const e=I.c(t.participants[t.meId]),n={};return"Read"!==e&&"ReadWrite"!==e||(n[this.externalMeId]={access:e}),{id:t.conversationExternalId,custom:t.conversationCustom,topicId:t.conversationTopicId,subject:t.conversationSubject,welcomeMessages:t.conversationWelcomeMessages,photoUrl:t.conversationPhotoUrl,participants:n}}isSideDtoComplete(t){return void 0===t.id||void 0!==t.canIRead&&void 0!==t.canIWrite&&void 0!==t.participants}on(t,e){this.N(),this.U.on(t,e)}off(t,e){this.U.off(t,e)}onChange(t){return this.N(),this.U.subscribe("change",t)}N(){if(this.K)throw new Error("[TalkJS] This object has been destroyed, please create a new Session.")}lt(){var t;this.K=!0,null===(t=this.Z)||void 0===t||t.disconnect(),this.U.removeAllListeners()}}var W=n(12),V=n(73);const Z=[];function X(t={}){const e={stack:(new Error).stack||"no stack trace available",called:new Date,args:t};return Z.push(e),Z.length>100&&Z.shift(),()=>{e.settled=new Date}}var Q="undefined"==typeof window?{log:t=>Promise.resolve(),setData:t=>{}}:new class{constructor(t){this.dt=Date.now(),this.ft=i.e,this.gt={customer:{application:"",correlationId:"",sessionId:"",token:"",userId:"",version:"release-fe737e0-2025-06-20T10:57:23.032Z"},entry:"direct",environment:{age:Date.now()-this.dt,dependencies:{},originalUrl:window.location.href,referrer:document.referrer,userAgent:window.navigator.userAgent},metadata:[],nav:[],network:[],url:window.location.href,stack:"",timestamp:(new Date).toISOString(),version:"release-fe737e0-2025-06-20T10:57:23.032Z",throttled:0},this.vt=`https://capture.trackjs.com/capture?token=${t}`,this.gt.customer.token=t}setData({appId:t,meId:e,sessionId:n}){this.gt.customer.userId=t,this.gt.customer.sessionId=`${t}/${e}`,this.gt.customer.correlationId=n}async log(t){try{if(!this.ft)return Promise.resolve();const e=Object.assign(Object.assign({},this.gt),{message:t});await tt({method:"POST",url:this.vt,data:JSON.stringify(e),options:{contentType:"text/plain"}})}catch(t){console.error("[TalkJS] Failed when sending an error report. Error: ",t)}}}("970cd0be0fb74630b75c8451051299dc");function tt({method:t,url:e,data:n,options:s,attempts:i,shouldRetry:r,authProvider:o}){var a;(!i||i<=0)&&(i=1);const u={"x-talkjs-client-build":"jssdk-release-fe737e0","x-talkjs-client-date":"2025-06-20T10:57:23.032Z"};n instanceof FormData||(u["Content-Type"]=null!==(a=null==s?void 0:s.contentType)&&void 0!==a?a:"application/json");return Object(W.e)(i,(async()=>{if(o){const t=await o.getToken();u.Authorization=`Bearer ${t}`}return fetch(e,{method:t,headers:u,body:n}).then((t=>{if(t.ok)return t;throw t}))}),{initialDelay:.2,log:void 0,shouldRetry:async n=>o&&401===n.status?(Q.log(`401 error from ${t} ${e}, ${await o.getToken()}`),o.refreshToken(),!0):r?r(n):!("status"in n&&n.status>=400&&n.status<500)}).catch((n=>{if(Math.random()<.1&&!e.toString().startsWith("https://capture.trackjs.com")){const s=`Network Error for ${t} ${e}`;if("undefined"!=typeof window)if(n instanceof Response){n.clone().text().then((t=>Q.log(`${s} ${n.status} ${t} (10% logged)`)))}else Q.log(`${s} ${n} (10% logged)`);console.error("[TalkJS]",s)}throw n}))}var et=n(74);class nt{constructor(t,e,n,s,r,o,a=0){var u,c;this.authProvider=t,this.me=e,this.appId=n,this.appLocale=s,this.bt=r,this.isRealtimeConnected=o,this.version=a,this.At=new V.a((u=i.b,c=i.a,`${u.replace("http:","ws:").replace("https:","wss:")}//${c}`),{appId:this.appId}),t.getToken().then((t=>{this.At.connect({authToken:t})})),t.onTokenRefreshFailed((()=>this.At.disconnect())),t.onTokenAccepted((t=>{this.At.setAuth(t)}));let h=!1;const l=new W.a(1e4,(async()=>{const t=await this.isRealtimeConnected();if(t.connected&&!this.At.isConnected()){await this.At.setAuth(t.token)}}));this.At.onConnectionStatusChanged((t=>{t?l.stop():(h=!1,l.start())}))}url(t){return st(this.appId,t,this.version)}async post(t,e){return tt({method:"POST",url:this.url(t),data:JSON.stringify(e),authProvider:this.authProvider})}async delete(t,e){return tt({method:"DELETE",url:this.url(t),data:JSON.stringify(e),shouldRetry:it,authProvider:this.authProvider})}getOrJoinChannel(t,e={}){const n=Object.assign(Object.assign({},e),{origin:"JSSDK"});return this.At.getOrJoin(t,n)}sendMessage({text:t,custom:e},n){const s=this.bt,i={text:t,custom:e,nymId:this.me.internalId,idempotencyKey:Object(et.a)(Date.now())};return this.post(`/say/${n}/?sessionId=${s}`,i).then((t=>t.json())).then((({id:t})=>{0}))}leaveConversation(t){const e=this.me.internalId;return this.delete(`/conversations/${t}/participants/${e}`).then((()=>!0)).catch((t=>{if(t&&403===t.status)return!1;throw t}))}markConversationAsUnread(t){const e=this.me.id;return this.delete(`/conversations/${t}/unreadBy/${e}`).then((t=>!0),(t=>{if(t&&403===t.status)return!1;throw t}))}disconnect(){this.At.disconnect()}}function st(t,e,n=0){return`${i.b}//${i.a}/api/v${n}/${t}/${e}`}function it(t){return!(t instanceof Response&&t.status>=400&&t.status<500)}var rt=n(75);class ot{constructor(t,e){this.wt=t,this.Et=e,this.router=()=>{};for(const t in e)this.listen(t,e[t])}initialise(t){void 0!==this.port&&this.destroy(),this.port=t,this.router=rt.a(this.port,this.Et),this.port.start(),t.addEventListener("message",this.router)}destroy(){var t,e;null===(t=this.port)||void 0===t||t.removeEventListener("message",this.router),null===(e=this.port)||void 0===e||e.close(),this.router=()=>{},this.port=void 0}listen(t,e){this.Et[t]=(...t)=>e.apply(this.wt,t)}unlisten(...t){for(const e of t)delete this.Et[e]}}const at=[[2,1],[2],[],[3,4,5]];class ut{constructor(t,e,n,s){this.Ot=t,this.Tt=e,this.initialPath=n,this.queryStringData=s,this.yt=!1,this.Ct=Object(W.b)(),this.St=void 0,this.nav=async(t,e={},n)=>{this.queryStringData=Object.assign(Object.assign({},this.queryStringData),{dbSyncData:e,localSettings:n});const s=new ct(this.queryStringData);this.yt?await this.request("nav",this.It(t),s.toString()):this.kt(t,s)},this.mount=(t,e)=>{t!==this._t&&(this._t=t,this.Dt(),e(this.Nt.style))},this.Ft=`${i.b}//${i.a}`,this.Nt=document.createElement("iframe"),this.Nt.scrolling="no",this.Nt.name="____talkjs__chat__ui_internal",this.Nt.style.border="none",this.Nt.setAttribute("aria-label","Chat"),this.Nt.allow="fullscreen;microphone",this.Nt.style.colorScheme="normal",this.Nt.style.border="0px",this.xt(this.Nt);const r=new ct(this.queryStringData);this.kt(this.initialPath,r)}reloadWithNewAuthToken(t){this.queryStringData.authToken=t;const e=new ct(this.queryStringData);this.kt(this.initialPath,e)}async getPort(){return await this.Ct.promise,this.St}xt(t){t.onload=t=>{this.yt=!0}}Pt(t){return`${this.Ft}/app/${this.Ot}${this.It(t)}`}It(t){return`/user/${this.Tt}/${t}`}contentWindow(){return this.Nt.contentWindow}request(t,...e){return this.Ct.promise.then((()=>{if(!this.jt())throw new ht("[TalkJS] Attempted to operate on a UI object that does not exist any more. This object has been deleted before (either by calling destroy(), by a user closing the popup, or by external code removing the TalkJS Iframe from the DOM), and is now in an invalid state.");return rt.b(t,e,(()=>this.getPort()))}))}async patchQueryString(t){var e;this.queryStringData=Object.assign(Object.assign(Object.assign({},this.queryStringData),t),{localSettings:Object.assign(Object.assign({},this.queryStringData.localSettings),null!==(e=t.localSettings)&&void 0!==e?e:{})});try{await this.request("patchQueryString",t)}catch(t){if("IFrameLostError"===t.name)return;throw t}}xdmReady(t){this.St=t,this.Ct.resolve()}kt(t,e){let n=e.toString();if(n.length>b.b){const{short:t,long:s,key:i}=e.split();tt({method:"PUT",url:`${this.Ft}/app/${this.Ot}/__buffer/${i}`,data:JSON.stringify({value:s}),attempts:5}),n=`bufferKey=${i}&${t}`}this.Nt.src=this.Pt(`${t}?${n}`)}patchLocalSettings(t){return t.tokenRefreshFailed&&(this.Nt.style.pointerEvents="none",this.Nt.blur()),this.patchQueryString({localSettings:t})}Dt(){this._t.appendChild(this.Nt)}cleanupContainer(){if(this.jt()&&this._t.hasChildNodes()){for(;this._t.firstChild&&this._t.firstChild!==this.Nt;)this._t.firstChild.remove();for(;this._t.lastChild&&this._t.lastChild!==this.Nt;)this._t.lastChild.remove()}}destroy(){this.Nt.remove()}isZombie(){return!!this.yt&&!this.jt()}jt(){return document.body.contains(this.Nt)}}class ct extends b.c{constructor({dbSyncData:t,localSettings:e,clientHeight:n,signature:s,authToken:i,externalUserId:r,thirdparties:o,sessionId:a}){let u=[];t&&u.push(["syncPlease",t]),e&&u.push(["localSettings",e]),void 0!==s&&u.push(["signature",s]),i&&u.push(["authToken",i]),u.push(["clientHeight",n]),u.push(["sessionId",a]),u.push(["thirdparties",o]),u.push(["id",r]),super(u)}}class ht extends Error{constructor(t){super(t),this.name="IFrameLostError"}}var lt=n(14);function dt(t,e,n=[]){const s=document.createElement(t),{style:i}=e,r=Object(lt.d)(e,["style"]);Object.assign(s,r),Object.assign(s.style,i);for(let t of n)s.appendChild(t);return s}function ft(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","30"),t.setAttribute("height","30"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.setAttribute("class","feather feather-x");const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1","18"),e.setAttribute("y1","6"),e.setAttribute("x2","6"),e.setAttribute("y2","18");const n=document.createElementNS("http://www.w3.org/2000/svg","line");return n.setAttribute("x1","6"),n.setAttribute("y1","6"),n.setAttribute("x2","18"),n.setAttribute("y2","18"),t.appendChild(e),t.appendChild(n),t}var pt=n(117);const mt=100,gt=!0,vt=(t,e)=>{if(n=t,isNaN(parseFloat(n))||!isFinite(n))throw new Error(`[TalkJS][HtmlPanel] ${e||"value"} must be a number.`);var n;return Number(t)};class bt{constructor(t,e){if(this.Bt=!1,this.panelLoaded=Object(W.b)(),this.Rt=Object(W.b)(),this.Mt=Object(W.b)(),!e.url)throw new Error("[TalkJS] URL is required for the `HTMLPanel`.");const{url:n,show:s=gt,height:i=mt,conversation:r}=e,o=document.createElement("a");o.href=n,this.$t={url:o.href,show:s,height:vt(i,"height"),conversation:"object"==typeof r?r.id:r},this.Ut=t,this.DOMContentLoadedPromise=this.Rt.promise,this.windowLoadedPromise=this.Mt.promise}show(){this.N(),!1===this.$t.show&&(this.$t.show=!0,this.Lt())}hide(){this.N(),!0===this.$t.show&&(this.$t.show=!1,this.Lt())}setHeight(t){this.N(),this.$t.height=vt(t,"height"),this.Lt()}isVisible(){return this.N(),!this.Bt&&!0===this.$t.show}N(){if(this.Ut.N(),this.Bt)throw new Error("[TalkJS] This HTML Panel has been destroyed, and you cannot use it anymore. Please create a new HTML Panel.")}destroy(){return this.$t.show=!1,this.$t.url="",this.Bt=!0,this.Lt()}Gt(){this.panelLoaded.resolve()}Kt(){return this.htmlPanelId=Object(_.d)(this.$t.url,this.Ut.sessionId,this.$t.conversation),this.Lt().then((()=>this.panelLoaded.promise.then((()=>{const t=this.Jt();if(!t)throw new Error("[TalkJS][HtmlPanel]: Couldn't get a reference to the window property of the HTML panel iframe.");this.window=t;try{this.window.scrollBy(0,0)}catch(t){return void console.warn(`[TalkJS] HTML Panel on url ${this.$t.url} is not on the same origin as the current page, functionality may be limited. DOMContentLoadedPromise and windowLoadedPromise will never resolve. See https://talkjs.com/docs/Features/Customizations/HTML_Panels.html#page_HTML-Panel-Limitations for more information.`)}const e=(t,e)=>{e.resolve()},n=()=>this.window.addEventListener("load",(()=>e(0,this.Mt)),!0),s=()=>this.window.document.addEventListener("DOMContentLoaded",(()=>e(0,this.Rt)),!0);"loading"===this.window.document.readyState?(s(),n()):"complete"===this.window.document.readyState?(e(0,this.Rt),e(0,this.Mt)):(e(0,this.Rt),n())}))))}Lt(){return this.Ut.contentLoaded().then((()=>this.Ut.zt()))}Jt(){const t=this.Ht();return null!==t?t.frames[this.htmlPanelId]:null}Ht(){const t=this.Ut.Yt();return t||null}}class At{constructor(t){this.Ut=t}focus(){return this.Ut.qt("focusMessageField")}setText(t){return this.Ut.qt("setText",t)}typeText(t){return this.Ut.qt("typeText",t)}getText(){return this.Ut.qt("getText")}setVisible(t){return this.Ut.Wt("messageField",{visible:t})}}function wt(t,e){if(Array.isArray(e)){if(2!==e.length||"any"!==e[0]||!Array.isArray(e[1]))throw new r(s.ARGUMENT_INVALID,`${t} must be a valid predicate. See the docs for all available options.`);e[1].forEach(((e,n)=>{Et(`${t}[1][${n}]`,e)}))}else Et(t,e)}function Et(t,e){const n=e||{},{hasUnreadMessages:s,custom:i,access:r,subject:u,lastMessageTs:c}=n,h=Object(lt.d)(n,["hasUnreadMessages","custom","access","subject","lastMessageTs"]);o(s,["boolean","undefined"],`${t}.hasUnreadMessages must be boolean.`),yt(`${t}.access`,r,["ReadWrite","Read","None"]),St(`${t}.custom`,i),Ct(`${t}.subject`,u,void 0,["string","null"]),function(t,e){const n=`${t} must be a valid predicate. See the docs for all available options.`;if(o(e,["string[]","undefined"],n),!e)return;if(2!==e.length)throw new Error("[TalkJS] "+n);const[s,i]=e;if(a(s,[">","<",">=","<=","between","!between"],n),"between"===s||"!between"===s){if(o(i,["number[]"],n),2!==i.length)throw new Error("[TalkJS] "+n);const[t,e]=i;if(o(e,["number"],n),t>=e)throw new Error("[TalkJS] "+n)}else o(i,["number"],n)}(`${t}.lastMessageTs`,c);for(let e in h)console.warn(`[TalkJS] ${t}.${e} is not a valid field.`)}function Ot(t,e){if(Array.isArray(e)){if(2!==e.length||"any"!==e[0]||!Array.isArray(e[1]))throw new r(s.ARGUMENT_INVALID,`${t} must be a valid predicate. See the docs for all available options.`);e[1].forEach(((e,n)=>{Tt(`${t}[1][${n}]`,e)}))}else Tt(t,e)}function Tt(t,e){const n=e||{},{origin:s,type:i,custom:r,sender:o}=n,a=Object(lt.d)(n,["origin","type","custom","sender"]);yt(`${t}.origin`,s,["web","rest","email","import"]),yt(`${t}.type`,i,["SystemMessage","UserMessage"]),function(t,e){const n=e||{},{id:s,locale:i,role:r,custom:o}=n,a=Object(lt.d)(n,["id","locale","role","custom"]);yt(`${t}.id`,s),yt(`${t}.locale`,i),yt(`${t}.role`,r),St(`${t}.custom`,o);for(let e in a)console.warn(`[TalkJS] ${t}.${e} is not a valid field.`)}(`${t}.sender`,o),St(`${t}.custom`,r);for(let e in a)console.warn(`[TalkJS] ${t}.${e} is not a valid field.`)}function yt(t,e,n){return Ct(t,e,n,["string"])}function Ct(t,e,n,s){o(e,["string[]","undefined"],`${t} must be a valid predicate. See the docs for all available options.`),e&&It(t,e,n,s)}function St(t,e){if(o(e,["object","undefined"],`${t} must be an object.`),e)for(let n of Object.getOwnPropertyNames(e)){It(`${t}.${n}`,e[n])}}function It(t,e,n,s=["string"]){const i=`${t} must be a valid predicate. See the docs for all available options.`;if("string"==typeof e)return void a(e,["exists","!exists"],i);if(2!==e.length)throw new Error("[TalkJS] "+i);const[r,u]=e;if(a(r,["==","!=","oneOf","!oneOf"],i),"oneOf"===r||"!oneOf"===r){if(o(u,s.map((t=>`${t}[]`)),i),n)for(let t of u)a(t,n,i)}else o(u,s||["string"],i),n&&a(u,n,i)}var kt=n(38),_t=n(267);const Dt={sendMessage(t){},focus(){},blur(){},translationToggled(t){},keyup(t){},keydown(t){},customMessageAction(t){},customConversationAction(t){},leaveConversation(t){},markConversationAsUnread(t){},messagesTranslated(t){}};class Nt{get Vt(){return this.D.Zt.Vt}constructor(t,{selectedConversation:e,hideHub:n=!1}={},s,i){this.D=t,this.Xt=new ot(this,{getCurrentLocation:this.Qt,showMoreChats:this.te,sendMessage:this.ee,leaveConversation:this.ne,markConversationAsUnread:this.se,uiBoxFocusChange:this.ie,translationToggled:this.re,customMessageAction:this.oe,customConversationAction:this.ae,selectedConversationChanged:this.ue,keyup:this.ce,keydown:this.le,hasParentFocus:this.fe,showImagePopup:this.pe,openExternalLink:this.ge,refreshAuth:this.ve,emitBrowserPermissionNeeded:this.be,emitBrowserPermissionDenied:this.Ae,pingJssdk:this.we,htmlPanelLoaded:this.Ee,isRealtimeConnected:this.Oe,messagesTranslated:this.Te,selectConversation:t=>({stop:!1}),desktopNotifyChanged:t=>{},closePopover:()=>{}}),this.ye={perConv:Object.create(null)},this.Ce=Object(W.b)(),this.U=new z.a(Dt),this.sessionId=b.n(),this.messageField=new At(this),this.isAlive=!0;let{dir:r}=i;!r&&document.documentElement.dir&&"auto"!==document.documentElement.dir&&(r=document.documentElement.dir),this.Se={hideHub:n,dir:r},this.boxType=s,this.Ie=Object.assign({},i),this.select(e);const o=this.Vt.onTokenAccepted((t=>this.ke({authToken:t}))),a=this.Vt.onTokenRefreshFailed((()=>this._e({tokenRefreshFailed:!0})));this.unsubscribeAuth=()=>{o(),a()}}contentLoaded(){return this.Ce.promise}async select(t,e={}){X({conversation:t,selectOptions:e}),o(t,["null","undefined","string","object"],"Expected 1st parameter to `select` to be a conversation ID, a ConversationBuilder, null, or undefined. More info on https://talkjs.com/docs/Reference/JavaScript_Chat_SDK/Chatbox.html#Chatbox.select",[w]),this.N();const n=this.Ie,i=this.Ie,a=this.Ie,u=n.messageField||{};if(n.messageField&&void 0!==n.messageField.visible&&"boolean"!=typeof n.messageField.visible&&wt("messageField.visible",n.messageField.visible),n.theme&&(o(n.theme,["string","object"],'The "theme" option should either be a string (the theme name), or an object with optional "name" and "custom" fields.'),"object"==typeof n.theme&&(o(n.theme.name,["string","undefined"],'The "name" field of them "theme" options object must be a string, or undefined.'),n.theme.custom)))try{JSON.stringify(n.theme.custom)}catch(t){throw new r(s.ARGUMENT_INVALID,"theme.custom must be a JSON-serializable value.")}if(n.customEmojis){o(n.customEmojis,["object"],'The "customEmojis" field must be an object mapping custom emoji names to CustomEmoji objects');for(let t of Object.keys(n.customEmojis)){if(!/^:.*:$/.test(t))throw new r(s.ARGUMENT_INVALID,"Custom emoji name must start and end with a colon, eg ':lol'. Found: "+t);const e=n.customEmojis[t],i=`customEmojis[${JSON.stringify(t)}])`;o(e,["object"],`Each "customEmoji" value must be an object (in ${i}).`),o(e.url,["string"],`Each "customEmoji" value must have a "url" field of type string (in ${i}).`)}}this.De={desktopNotify:U(this.D.appId,this.D.me.id),dir:this.Se.dir,htmlPanelOptions:this.Ne(),feedFilter:void 0===i.feedFilter?{}:i.feedFilter,messageFilter:void 0===i.messageFilter?{}:i.messageFilter,useBrowserHistory:void 0===i.useBrowserHistory?this.boxType===I.a.Inbox:i.useBrowserHistory,translationOptions:this.Fe(),highlight:[],chatHeaderState:"profile",theme:"string"==typeof i.theme?{name:i.theme}:i.theme,presence:this.Ie.presence,messageField:{enterSendsMessage:void 0===u.enterSendsMessage||u.enterSendsMessage,placeholder:u.placeholder,spellcheck:void 0!==u.spellcheck&&u.spellcheck,visible:void 0===u.visible||u.visible,autofocus:!1!==u.autofocus},view:{mode:this.getMode(a),isInsideMobileApp:b.i(),captureKeyboardEvents:!!n.captureKeyboardEvents,showChatHeader:void 0===n.showChatHeader||n.showChatHeader,showFeedHeader:void 0===i.showFeedHeader||i.showFeedHeader,searchInConv:this.D.xe(3),chatTitleMode:void 0===n.chatTitleMode?"participants":n.chatTitleMode,chatSubtitleMode:void 0===n.chatSubtitleMode?"subject":null===n.chatSubtitleMode?"none":n.chatSubtitleMode,feedConversationTitleMode:void 0===i.feedConversationTitleMode?"auto":i.feedConversationTitleMode,showCloseInHeader:void 0===a.showCloseInHeader?"auto":a.showCloseInHeader,legacyNoChatsPage:this.D.xe(2),timeZone:_t.determine().name(),showMobileBackButton:void 0===i.showMobileBackButton||i.showMobileBackButton,customEmojis:void 0===n.customEmojis?{}:n.customEmojis},tokenRefreshFailed:!1},this.Pe=this.je(t),this.vt=this.Be(t,e),this.Re&&await this.Re.nav(this.vt,this.Pe,this.De);const c=[];e.messageId&&c.push(this.qt("scrollToMessage",e.messageId));const h=e.messageSuggestion||n.messageSuggestion;h&&c.push(this.qt("setText",h)),await Promise.all(c)}createHtmlPanel(t){X({options:t});this.N();const e=new bt(this,t),n=t.conversation;n?this.ye.perConv["object"==typeof n?n.id:n]=e:this.ye.global=e;const s=e.Kt();return this.zt(),s.then((()=>e))}setTranslationEnabledForConversation(t,e){let n;X({conversation:t,enabled:e}),n="string"==typeof t?S(t):t.internalId,this.De.translationOptions.perConv[n]=e,this._e({translationOptions:this.De.translationOptions})}setTranslationEnabledDefault(t){X({shouldTranslate:t}),this.De.translationOptions.global=t,this._e({translationOptions:this.De.translationOptions})}on(t,e){X({eventType:t,handler:e}),this.N(),this.U.on(t,e)}off(t,e){X({eventType:t,handler:e}),this.U.off(t,e)}onCustomMessageAction(...t){const[e,n]=1===t.length?[void 0,t[0]]:t;X({action:e,handler:n}),this.N();return this.U.subscribe("customMessageAction",(t=>{void 0!==e&&t.action!==e||n(t)}))}onCustomConversationAction(...t){const[e,n]=1===t.length?[void 0,t[0]]:t;X({action:e,handler:n}),this.N();return this.U.subscribe("customConversationAction",(t=>{void 0!==e&&t.action!==e||n(t)}))}onMessagesTranslated(t){return X({handler:t}),this.N(),this.U.subscribe("messagesTranslated",t)}onSendMessage(t){return X({handler:t}),this.N(),this.U.subscribe("sendMessage",t)}onLeaveConversation(t){return X({handler:t}),this.N(),this.U.subscribe("leaveConversation",t)}onMarkConversationAsUnread(t){return X({handler:t}),this.N(),this.U.subscribe("markConversationAsUnread",t)}onFocus(t){return X({handler:t}),this.N(),this.U.subscribe("focus",t)}onBlur(t){return X({handler:t}),this.N(),this.U.subscribe("blur",t)}onTranslationToggled(t){return X({handler:t}),this.N(),this.U.subscribe("translationToggled",t)}onKeyup(t){return X({handler:t}),this.N(),this.U.subscribe("keyup",t)}onKeydown(t){return X({handler:t}),this.N(),this.U.subscribe("keydown",t)}Me(t,e){return b.l(this.Ie,t),this._e(e)}_e(t){return b.l(this.De,t),this.contentLoaded().then((()=>this.Re.patchLocalSettings(t)))}ke(t){return this.contentLoaded().then((()=>this.Re.patchQueryString(t)))}$e(t){return this.contentLoaded().then((()=>{const e=this.Re;if(null==e?void 0:e.isZombie())throw new Error(t||"[TalkJS] Attempted to operate on a UI object that does not exist any more. This object has been deleted before (either by calling destroy(), by a user closing the popup, or by external code removing the TalkJS Iframe from the DOM), and is now in an invalid state. Please call createInbox, createChatbox or createPopup again. See the attached stack trace for more information on the operation that failed.");return e}))}qt(t,...e){return this.$e().then((n=>n.request(t,...e)))}Wt(t,e){b.l(this.De[t],e);const n={[t]:this.De[t]};return this.contentLoaded().then((()=>this.Re.patchLocalSettings(n)))}async setPresence({visible:t,custom:e}={}){X({visible:t,custom:e}),this.N(),o(t,["undefined","boolean"],"UIBox.setPresence: field visible has to be boolean."),e&&u(e,["string"],(t=>`UIBox.setPresence: Field "custom.${t}" must be a string.`));const n={visible:t,custom:e};this.Me({presence:n},{presence:n}),await this.qt("setPresence",n)}sendFile(t){X({file:t});return this.N(),o(t,["object"],"UIBox.sendFile: parameter file must be a File object and its name must have a file extension",[t=>{if(t instanceof File){const e=t.name.split(/[\\/]/).pop();return!(""===e||e.lastIndexOf(".")<1)}return!1}]),this.qt("sendFile",t)}sendLocation(){X();return this.N(),this.qt("sendLocation")}setHighlightedWords(t){X({words:t});return this._e({highlight:t})}Ue(t){return this.U.supports(t)}Yt(){return this.Re?this.Re.contentWindow():null}je(t){const e={};if(e.me=this.D.me,null!==t)if(void 0===t)e.externalConversationId=void 0;else if(E(t))e.externalConversationId=t.id;else if(O(t))e.others=t.participants.filter((t=>t.user.id!==this.D.me.id)).map((t=>t.user)),e.conversation={internalId:t.internalId,id:t.id,participants:t.participants,subject:t.subject,custom:t.custom,welcomeMessages:t.welcomeMessages,photoUrl:t.photoUrl,topicId:"topicId"in t?t.topicId:void 0},e.externalConversationId=t.id;else{if("string"!=typeof t){throw new Error("Invalid conversation type")}e.externalConversationId=t}return e}Be(t,e){if(null===t)return"inbox/chats/hubOnly";const n=this.Se.hideHub?"chatbox":"inbox";if(t){const s=e.asGuest?"/g":"";return`${n}/${S("string"==typeof t?t:t.id)}${s}`}return`${n}/chats`}N(){if(this.D.N(),!this.isAlive)throw new Error("[TalkJS] This UI object has been destroyed, and you cannot use it anymore. This object has been deleted before (either by calling destroy(), by a user closing the popup, or by external code removing the TalkJS Iframe from the DOM), and is now in an invalid state. Please call createInbox, createChatbox or createPopup again.")}Le(t){X({container:t});this.N();const e=t,n=e&&e.jquery&&e.length?e[0]:t;if(this.Re)throw new Error("[TalkJS] Cannot mount UI more than once. Please call createInbox, createChatbox or createPopup again if you want to create a new UI.");if(!n||!n.tagName)throw new Error("[TalkJS] Cannot mount UI: container element not found");if(!this.vt)throw new Error("[TalkJS] Internal Error: cannot mount UI without URL");const s=this.D.legacyThemePath;return s?tt({method:"GET",url:s}).then((t=>t.text())).then((t=>this.De.rawV1Theme=t.replace(/\/\*[^@]+?\*\//gm,""))).then((()=>this.mountIframe(n))):this.mountIframe(n)}Fe(){return this.De&&this.De.translationOptions?this.De.translationOptions:("auto"!==this.Ie.translateConversations&&o(this.Ie.translateConversations,["object[]","string[]","boolean","undefined"],"translateConversations should either be a boolean or an array of ConversationBuilders or conversation ids as strings."),"auto"!==this.Ie.showTranslationToggle&&o(this.Ie.showTranslationToggle,["boolean","undefined"],'showTranslationToggle should either be a boolean or "auto".'),Array.isArray(this.Ie.translateConversations)?{global:!1,perConv:Object(kt.b)(this.Ie.translateConversations,(t=>"string"==typeof t?[S(t),!0]:[t.internalId,!0])),showToggle:this.Ie.showTranslationToggle||!1}:{global:this.Ie.translateConversations||!1,perConv:{},showToggle:this.Ie.showTranslationToggle||!1})}Ne(){const t=t=>({show:t.show,url:t.url,height:t.height}),{global:e,perConv:n}=this.ye;let s={perConv:{}};e&&(s.global=t(e.$t));for(let e in n)s.perConv[e]=t(n[e].$t);return s}zt(){this._e({htmlPanelOptions:this.Ne()})}async mountIframe(t){var e;const n={};if(this.Vt.usingBokens)n.signature=null!==(e=this.D.signature)&&void 0!==e?e:"";else{const t=await this.Vt.getToken();n.authToken=t}const{height:s}=Object(pt.a)(),i=Object.assign({dbSyncData:this.Pe,localSettings:this.De,clientHeight:s,sessionId:this.sessionId,thirdparties:this.Ie.thirdparties,externalUserId:this.D.me.id},n);if(this.Re=new ut(this.D.appId,this.D.me.internalId,this.vt,i),this.Ge(),"full"===this.De.view.mode){let e;if(this.D.xe(1)){const n=function(t){const e=document.createElement("div");Ft(t,e);const n=t.style.boxSizing;t.style.boxSizing="content-box";const s=parseInt(getComputedStyle(t).height);return t.style.boxSizing=n,Ft(e,t),s>1}(t);e=e=>{e.width="100%",this.Ke(t,e,n),e.marginLeft="auto",e.marginRight="auto",e.visibility="visible",e.outline="none","ti8AJFWH"!==this.D.appId&&"LfC1CcQC"!==this.D.appId&&(e.minHeight="500px")}}else e=t=>{t.width="100%",t.height="100%",t.marginLeft="auto",t.marginRight="auto",t.visibility="visible",t.outline="none"};this.Re.mount(t,e)}else this.Re.mount(t,(t=>{t.width=t.height="0",t.minWidth=t.maxWidth=t.minHeight=t.maxHeight="100%",t.visibility="visible"}));await Promise.race([this.Ce.promise,new Promise(((t,e)=>setTimeout(e,6e4)))]).catch((async()=>{Math.random()<.01&&Q.log("IFrame mount timed out, iframe failed to load. (Only 1% of these errors actually go to trackjs so this is happening 100x as much as it says in trackjs)"),console.error("[TalkJS]: .mount has taken over 60 seconds, which should not happen. There may be other messages in the console explaining what went wrong. If there aren't any other errors and you're on a fast connection, TalkJS may be experiencing downtime. Continuing trying to load.");const t=(new Date).getTime();await this.Ce.promise;const e=(6e4+(new Date).getTime()-t)/1e3;Math.random()<.01&&Q.log(`IFrame loaded after timeout, total load time ${e}s. (1% logged)`),console.error(`[TalkJS]: UI did eventually load after ${e} seconds. You are probably on a very slow connection.`)}))}Ke(t,e,n){if(n)return void(e.height="100%");const s=t.getBoundingClientRect().top+window.pageYOffset,i=window.innerHeight;let r=i-s,o=0;if(window.innerWidth>=1010){const e=getComputedStyle(t);o=parseInt(e.paddingTop)+parseInt(e.paddingBottom)||10,r-=o}e.height=r>500?Math.round(r)+"px":Math.round(.75*i)+"px"}Ge(){let t=!0;window.addEventListener("message",(e=>{if(e.source===this.Re.contentWindow())if("__talkjs:hello"===e.data)this.Re.cleanupContainer(),this.Ce.resolve();else if("__talkjs:xdmready"===e.data){t=!0;const n=e.ports[0];this.Re.xdmReady(n),this.Xt.initialise(n)}else"__talkjs:loaderror:Could not authenticate user. Check if you are authenticating correctly."===e.data&&t&&(t=!1,this.Vt.refreshToken(),this.Vt.getToken().then((t=>{this.Re.reloadWithNewAuthToken(t)})))}))}pe({url:t}){!function(t){const e=document.getElementById("___talkjs_image_popup");e&&e.parentNode.removeChild(e);const n=Math.min(window.innerWidth,window.innerHeight)<500?{padding:"0",maxWidth:"100%",maxHeight:"100%"}:{padding:"5px",maxWidth:"95%",maxHeight:"95%",background:"#fff"},s=dt("div",{tabIndex:-1,style:{boxSizing:"border-box",padding:"0",backgroundColor:"rgba(0,0,0,0.85)",opacity:"0",transition:"opacity 0.2s ease-out",overflow:"hidden",position:"fixed",zIndex:"54321",left:"0",top:"0",right:"0",bottom:"0"}},[dt("img",{src:t,style:Object.assign(Object.assign({},n),{opacity:"0",transition:"opacity 0.1s ease-out",margin:"auto",position:"absolute",top:"0",bottom:"0",right:"0",left:"0"})}),dt("span",{style:{cursor:"pointer",color:"#fff",font:"sans-serif",position:"absolute",right:"0",top:"0",padding:"1rem"}},[ft()])]);let i;const r=t=>{t.preventDefault(),s.parentNode.removeChild(s),document.body.removeEventListener("keydown",i)};i=t=>27===t.keyCode&&r(t),s.addEventListener("click",r),document.body.addEventListener("keydown",i);const o=window.requestAnimationFrame||(t=>setTimeout(t,20));o((()=>o((()=>s.style.opacity="1")))),s.getElementsByTagName("img")[0].onload=t=>t.target.style.opacity="1",document.body.appendChild(s),s.focus()}(t)}ie({focused:t}){this.U.emit(t?"focus":"blur",{})}re({conversation:t,isEnabled:e,externalNymIds:n}){this.U.emit("translationToggled",{isEnabled:e,conversation:I.d(t,n)})}ce(t){this.U.emit("keyup",t)}le(t){this.U.emit("keydown",t)}be(t){return this.D.be(t)}Ae(t){return this.D.Ae(t)}Te(t){this.U.emit("messagesTranslated",t)}we(){return"pong jssdk"}Oe(){return this.D.Oe()}Ee(t){var e;if((null===(e=this.ye.global)||void 0===e?void 0:e.htmlPanelId)!==t)for(const e in this.ye.perConv){const n=this.ye.perConv[e];if(n.htmlPanelId===t)return void n.Gt()}else this.ye.global.Gt()}ue(t){null!==t.conversation?this.currentConversation=I.d(t.conversation,t.externalNymIds):this.currentConversation=null}oe({action:t,conversation:e,message:n,sender:s,params:i,externalNymIds:r}){const o=I.f(s);this.U.emit("customMessageAction",{action:t,params:i,message:I.e(n,e,o,this.D.me.internalId,r)})}ae({action:t,conversation:e,params:n,externalNymIds:s}){this.U.emit("customConversationAction",{action:t,params:n,conversation:e&&s&&I.d(e,s)})}ne({conversation:t,externalNymIds:e}){const n=I.d(t,e);let s=!1,i=!1;return this.U.emit("leaveConversation",{conversation:n,preventDefault(){s&&console.warn("[TalkJS] Calling LeaveConversationEvent.preventDefault() after the event has completed. This has no effect, make sure you only call preventDefault directly from the event handler."),i=!0}}),s=!0,{prevent:i}}se({conversation:t,externalNymIds:e}){const n=I.d(t,e);let s=!1,i=!1;return this.U.emit("markConversationAsUnread",{conversation:n,preventDefault(){s&&console.warn("[TalkJS] Calling MarkConversationAsUnread.preventDefault() after the event has completed. This has no effect, make sure you only call preventDefault directly from the event handler."),i=!0}}),s=!0,{prevent:i}}async ee({me:t,conversation:e,text:n,entityTree:s,attachment:i,location:r,externalNymIds:a}){if(!this.U.handles("sendMessage"))return;const c=I.f(t),h=I.d(e,a),l={id:void 0,conversationId:e.id,type:"UserMessage",readBy:[],senderId:t.id,text:n,entityTree:s,origin:"web",attachment:i,location:r,createdAt:void 0};let d,f={text:n,custom:{}};const p=new b.d("SendMessageEvent.override",(t=>{d=Object(W.b)();const e="function"==typeof t?t():t;function n({text:t,custom:e={}}){o(t,["string","undefined"],`'text' should be a single string value representing the text of the message, got: \`${t}\``),o(e,["object","undefined"],`'custom' should be an object whose keys and values are all strings, got: \`${e}\``),u(e,["string"],(t=>`Field "custom.${t}" must be a string.`)),t&&(f.text=t),e&&(f.custom=e),d.resolve()}b.k(e)?e.then(n):n(e)})),m={me:c,message:l,conversation:h,override:p.callback};return this.U.emit("sendMessage",m),p.expire(),d&&await Object(W.f)(d.promise,5e3,(()=>{console.warn("[TalkJS] An async function passed to `override` in an onSendMessage handler took more than 5 seconds to resolve. Sending message without modifications.")})),f}async Qt(){return"cancel"===await this.be("geolocation")?"cancel":new Promise(((t,e)=>{navigator.geolocation.getCurrentPosition((e=>t([e.coords.latitude,e.coords.longitude])),(n=>{if(n.code===GeolocationPositionError.PERMISSION_DENIED){if(this.Ae("geolocation"))return void t("cancel")}e(n.message)}))}))}ge({url:t}){const e=window;e.cordova&&e.cordova.InAppBrowser?e.cordova.InAppBrowser.open(t,"_system"):window.open(t,"_system","location=yes")}te({amount:t,lastChatTs:e}){this.D.Je.st({amount:t,lastChatTs:e})}fe(){return document.hasFocus()}async ve(){return this.Vt.refreshToken(),this.Vt.getToken()}toggleDesktopNotifications(t){X({isEnabled:t});return this.D.setDesktopNotificationEnabled(t)}ze(t){return this._e({desktopNotify:t})}destroy(){X(),this.unsubscribeAuth(),this.Xt.unlisten("showImagePopup","sendMessage","selectedConversationChanged"),this.Xt.destroy(),this.D.forgetUIBox(this),this.U.removeAllListeners(),this.Re&&this.Re.destroy(),this.isAlive=!1}isZombie(){return!!this.Re&&this.Re.isZombie()}onWindowVisibleChanged(t){return this.isZombie()?Promise.resolve():this.qt("windowVisibleChanged",t)}getMode(t){switch(this.popupType(t)){case I.b.Widget:return"widget";case I.b.Popover:return"popover";default:return"full"}}popupType(t){}setMessageFilter(t){X({filter:t}),this.N(),Ot("filter",t),this.Me({messageFilter:t},{messageFilter:t})}}function Ft(t,e){for(;t.hasChildNodes();)e.appendChild(t.firstChild)}class xt extends Nt{constructor(t,e={},n){super(t,e,I.a.Inbox,n),this.He=new z.a({selectConversation(t){},conversationSelected(t){},desktopNotificationToggled(t){}}),this.Xt.listen("selectConversation",this.emitSelectConversation),this.Xt.listen("desktopNotifyChanged",this.handleDesktopNotifyChange)}mount(t){return super.Le(t)}select(t,e){if(null==e?void 0:e.asGuest)throw new Error("[TalkJS] Cannot select a conversation as guest in the Inbox UI. Please use a Popup or a Chatbox.");return super.select(t,e)}emitSelectConversation(t){const e=I.f(t.me),n=I.d(t.conversation,t.externalNymIds);let s={stop:!1};const i=new b.d("SelectConversationEvent.preventDefault",(()=>{s.stop=!0})),r=t.participants.map((t=>I.f(t)));return this.He.emit("selectConversation",{conversation:n,me:e,others:I.h(e,r),participants:r,preventDefault:i.callback,messageId:t.messageId}),i.expire(),s}ue(t){super.ue(t);const e=I.f(t.me);if(null===t.conversation)return void this.He.emit("conversationSelected",{me:e,conversation:null,conversationId:null});const n=I.d(t.conversation,t.externalNymIds),s=I.g(t.conversation,t.participants),i=I.h(e,s);this.He.emit("conversationSelected",{me:e,conversation:n,other:i[0],others:i,participants:s,conversationId:t.conversation.id})}handleDesktopNotifyChange({isEnabled:t,appName:e}){this.D.Ye(t,{appName:e}).then((e=>{e?this.He.emit("desktopNotificationToggled",{isEnabled:t}):this.D.setDesktopNotificationEnabled(!1)}),(()=>{this.D.setDesktopNotificationEnabled(!1)}))}setFeedFilter(t){X({filter:t}),wt("filter",t),this.Me({feedFilter:t},{feedFilter:t})}on(t,e){this.N(),super.Ue(t)?super.on(t,e):this.He.on(t,e)}off(t,e){super.Ue(t)?super.off(t,e):this.He.off(t,e)}onSelectConversation(t){return X({handler:t}),this.N(),this.He.subscribe("selectConversation",t)}onConversationSelected(t){return this.N(),this.He.subscribe("conversationSelected",t)}onDesktopNotificationToggled(t){return this.N(),this.He.subscribe("desktopNotificationToggled",t)}destroy(){this.Xt.unlisten("desktopNotifyChanged"),super.destroy(),this.He.removeAllListeners()}}class Pt extends Nt{constructor(t,e,n){super(t,{hideHub:!0,selectedConversation:e},I.a.Popup,n),this.conversation=e,this.qe=n,this.We=new z.a({close(){},open(){}}),this.Xt.listen("closePopover",this.Ve)}select(t,e){return this.conversation=t,e&&void 0!==e.asGuest&&o(e.asGuest,["boolean"],'Chatbox#select: field "asGuest" is given but not a boolean.'),super.select(t,e)}mount({show:t}={show:!0}){const e=this.Ze(t),[n,s]=e;return document.body.insertBefore(n,document.body.firstChild),t||this.setPresence({visible:!1}),super.Le(s).then((()=>{t&&this.Xe(e)}))}Ve(){if(!this.isAlive)throw new Error("[TalkJS] Can't hide a popup that's been destroyed. Please create and mount a new one.");const t=this.Qe();this.tn(t);this.We.emit("close",{})}destroy(){const t=this.nn();t&&t[0]&&document.body.removeChild(t[0]),this.restorePageHeight(),this.forgetMe(),this.Xt.unlisten("closePopover"),this.D.forgetUIBox(this),super.destroy()}show(){X(),this.N();const t=this.Qe();this.Xe(t)}hide(){X(),this.N();const t=this.Qe();this.tn(t)}on(t,e){this.N(),super.Ue(t)?super.on(t,e):this.We.on(t,e)}off(t,e){super.off(t,e),this.We.off(t,e)}onOpen(t){return this.N(),this.We.subscribe("open",t)}onClose(t){return this.N(),this.We.subscribe("close",t)}popupType(t){const e=null!=t?t:this.qe;if("widget"===e.popupType)return I.b.Widget;if("popover"===e.popupType)return I.b.Popover;const{width:n,height:s}=Object(pt.a)();return n<420||s<420?I.b.Popover:I.b.Widget}nn(){const t=document.getElementById("__talkjs_popup_container_"+this.sessionId);if(!t)return;const e=t.getElementsByTagName("span")[0],n=t.getElementsByClassName("__talkjs_launcher")[0];return[t,e,n]}Qe(){const t=this.nn();if(!t){throw Error(`[TalkJS] ${"Unexpected error: Could not find popup container. Maybe something, other than TalkJS, removed it from the DOM?"}`)}return t}async Xe([t,e,n]){var s;const i=this.D.sn(I.a.Popup);for(let t of i)this!==t&&t.hide();e.style.display="",n&&(n.className=n.className.replace("closed","open"),n.style.display="",n.setAttribute("aria-label","Close chat popup")),t.style.display="",this.rememberMe(),this.popupType()===I.b.Popover&&this.fixPageHeight(t),await this.setPresence({visible:!0}),(null===(s=this.Ie.messageField)||void 0===s?void 0:s.autofocus)&&await this.messageField.focus()}async tn([t,e,n]){"always"===this.qe.launcher?(e.style.display="none",n&&(n.className=n.className.replace("open","closed"),n.setAttribute("aria-label","Open chat popup"))):t.style.display="none",this.restorePageHeight(),this.forgetMe(),await this.setPresence({visible:!1})}Ze(t){const e=document.createElement("span"),s=document.createElement("link");s.type="text/css",s.rel="stylesheet";const i=n(385);s.href=i;const r=document.createElement("div");let o;r.id="__talkjs_popup_container_"+this.sessionId,e.style.display="none",e.className="__talkjs_popup",r.appendChild(s),r.appendChild(e);let a=[r,e,void 0];return"never"!==this.qe.launcher&&(o=document.createElement("a"),a[2]=o,o.href="#",o.className="__talkjs_launcher "+(t?"open":"closed"),(t||"close-only"===this.qe.launcher)&&(o.style.display="none"),o.id="__talkjs_launcher",o.addEventListener("click",(t=>{if(t.preventDefault(),t.target.className.match(/open/)){this.tn(a);const t={};this.We.emit("close",t)}else{this.Xe(a);const t={};this.We.emit("open",t)}})),r.appendChild(o)),a}rememberMe(){if(!this.qe.keepOpen)return;let t;t=E(this.conversation)||O(this.conversation)?this.conversation.id:this.conversation;const e=JSON.stringify({conversationId:t,options:this.qe});b.m(jt(this.D.appId,this.D.me.id,"v2-"),e)}fixPageHeight(t){const e=document.body,n=document.documentElement;this.rn={an:e.style.overflow,un:e.style.height,cn:e.style.width,hn:e.style.position,ln:window.scrollY,dn:window.scrollX,fn:n.style.height,pn:n.style.overflow},t.style.top=t.style.left="0px",window.scrollTo(0,0),e.style.height=n.style.height="100%",e.style.width="100%",n.style.overflow=e.style.overflow="hidden",e.style.position="relative"}restorePageHeight(){if(this.rn){const t=document.body,e=document.documentElement;t.style.overflow=this.rn.an,t.style.width=this.rn.cn,t.style.height=this.rn.un,t.style.position=this.rn.hn,e.style.height=this.rn.fn,e.style.overflow=this.rn.pn,window.scrollTo(this.rn.dn,this.rn.ln)}}forgetMe(){b.f(jt(this.D.appId,this.D.me.internalId)),b.f(jt(this.D.appId,this.D.me.id,"v2-"))}}function jt(t,e,n=""){return`talkjs-popup-${n}${e}-${t}`}class Bt extends Nt{constructor(t,{selectedConversation:e}={},n){super(t,{hideHub:!0,selectedConversation:e},I.a.Chatbox,n)}mount(t){return super.Le(t)}destroy(){super.destroy()}select(t,e){return e&&void 0!==e.asGuest&&o(e.asGuest,["boolean"],'Chatbox#select: field "asGuest" is given but not a boolean.'),super.select(t,e)}}var Rt=n(9);let Mt;Mt=n(386).default;let $t={};for(let t in Mt)$t[t]=new Rt.a({values:Mt[t]});window._talkjs_locales=$t;var Ut=$t;class Lt{constructor(t,e,n){this.realtimeWsApiUrl=t,this.internalHttpApiUrl=e,this.restApiHttpUrl=n}getBokensUrl(t,e,n){return this.internalHttpApiUrl+`/${t}/bokens/${encodeURIComponent(e)}?signature=${encodeURIComponent(null!=n?n:"")}`}getRealtimeWsUrl(t,e,n,s,i){const r=encodeURIComponent(e);return this.realtimeWsApiUrl+`/${t}/realtime/${r}?talkjs-client-build=${null!=i?i:"standalone"}&talkjs-core=${n}&talkjs-client-id=${s}`}}function Gt(t,e){if(e.ok)return e.value.data;if("SESSION_DESTROYED"===e.value)throw new Error(`${t} failed because the session was destroyed`);if("server"===e.where)throw new Error(Kt(t,e.value));throw"unreachable"}function Kt(t,e){let n;return n=Array.isArray(e.reasons)?e.reasons.join():JSON.stringify(e.reasons),`${t} failed, got status ${e.status} ${e.errorCode}, reasons: ${n}`}function Jt(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if("*"!==e[n]&&t[n]!==e[n])return!1;return!0}class zt{get state(){return this.mn}constructor(t,e,n){this.layer=t,this.states=e,this.transitions=n,this.mn=e[0]}transition(t){const e=this.transitions[t];if(!e)return;if(!this.canTransition(t))return;const n=this.state;this.mn=e.to,e.afterTransition({from:n,to:this.state})}canTransition(t){const e=this.transitions[t];return!!e&&("ANY"===e.from||e.from.includes(this.state))}}function Ht(t){return{ok:!0,value:t}}function Yt(t){return{ok:!1,where:"client",value:t}}function qt(t){return{ok:!1,where:"server",value:t}}function Wt(){const t={},e=new Promise((e=>{t.ok=async t=>e(Ht(t)),t.clientErr=t=>e(Yt(t)),t.serverErr=t=>e(qt(t)),t.resolve=t=>e(t)}));return t.promise=e,t}let Vt=null;class Zt{constructor(t,e){this.realtimeUrl=t,this.handlers=e,this.socket=null,this.stateMachine=new zt("ReconnectingSocket",["STOPPED","CONNECTING","READY","DISCONNECTED","TERMINATED"],{startWs:{from:["STOPPED","DISCONNECTED"],to:"CONNECTING",afterTransition:()=>{const t=new(function(){if(Vt)return Vt;if(globalThis.WebSocket)return globalThis.WebSocket;throw new Error("Missing WebSocket implementation")}())(this.realtimeUrl+"&talkjs-time="+Date.now());this.socket=t,t.addEventListener("open",(()=>{this.socket===t&&this.stateMachine.transition("onOpen")})),t.addEventListener("close",(()=>{this.socket===t&&this.stateMachine.transition("onClose")})),t.addEventListener("message",(e=>{this.socket===t&&this.handlers.onMessage(e)}))}},onOpen:{from:["CONNECTING"],to:"READY",afterTransition:()=>{this.handlers.onOpen()}},onClose:{from:["CONNECTING","READY"],to:"DISCONNECTED",afterTransition:async({from:t})=>{"READY"===t&&this.handlers.onClose(),this.socket=null;const e=Object(W.d)(1e4,.5);setTimeout((()=>{"DISCONNECTED"===this.stateMachine.state&&this.stateMachine.transition("startWs")}),e)}},stopWs:{from:["CONNECTING","DISCONNECTED","READY"],to:"STOPPED",afterTransition:({from:t})=>{"READY"===t&&this.handlers.onClose();const e=this.socket;this.socket=null,null==e||e.close(1e3)}},destroy:{from:"ANY",to:"TERMINATED",afterTransition:()=>{const t=this.socket;this.socket=null,null==t||t.close(1e3)}}})}stopWs(){this.stateMachine.transition("stopWs")}startWs(){this.stateMachine.transition("startWs")}send(t){return"READY"===this.stateMachine.state?(this.socket.send(t),Ht(void 0)):Yt("SOCKET_NOT_READY")}terminate(){const t=this.socket;this.stateMachine.canTransition("onClose")&&this.stateMachine.transition("onClose"),t&&("terminate"in t?t.terminate():t.close(1e3))}destroy(){this.stateMachine.transition("destroy")}}class Xt{constructor(t,e){this.handlers=e,this.socket=new Zt(t,{onOpen:()=>this.handlers.onOpen(),onClose:()=>this.handlers.onClose(),onMessage:t=>this.onWebSocketMessage(t)})}call(t,e,n,s){const i=`/${n.map((t=>encodeURIComponent(t))).join("/")}`,r=JSON.stringify([t,e,i,s]);return this.socket.send(r)}stopWs(){this.socket.stopWs()}startWs(){this.socket.startWs()}destroy(){this.socket.destroy()}terminate(){this.socket.terminate()}onWebSocketMessage(t){if("Auth token expired"!==t.data)try{const e=JSON.parse(t.data);if("PUBLISH"===e[1]){const t=e[0],n=JSON.stringify([t,"ACK"]);this.socket.send(n);const s=e.slice(2),i=[];s.forEach((t=>{"session.expired"===t.type?this.handlers.onAuthExpired():"upstream.restarting"===t.type?this.handlers.onUpstreamRestarting():i.push(t)})),i.length>0&&this.handlers.onPublish(t,i)}else{const t=e[0],n=e[1],s=e[2];this.handlers.onResponse(t,n,s)}}catch(t){}else this.handlers.onAuthExpired()}}class Qt{constructor(t){this.delayMs=t,this.timeout=void 0}schedule(t){this.stop(),this.timeout=setTimeout((()=>{void 0!==this.timeout&&(this.stop(),t())}),this.delayMs)}stop(){void 0!==this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0)}}class te{constructor(){this.i=-1}next(){return this.i++,this.i}reset(){this.i=-1}}class ee{constructor(t,e){this.handlers=e,this.seqCounter=new te,this.responseHandlers={},this.heartbeats=new ne(this),this.socket=new Xt(t,{onUpstreamRestarting:()=>{this.heartbeats.serverActive(),this.handlers.onUpstreamRestarting()},onOpen:()=>{this.heartbeats.clientActive(),this.heartbeats.serverActive(),this.handlers.onReady()},onClose:()=>{this.heartbeats.stop(),Object.values(this.responseHandlers).forEach((t=>{t.clientErr("WEBSOCKET_DISCONNECTED")})),this.responseHandlers={},this.seqCounter.reset(),this.handlers.onNotReady()},onResponse:(t,e,n)=>{this.heartbeats.serverActive(),this.onResponse(t,e,n)},onPublish:(t,e)=>{this.heartbeats.serverActive(),this.handlers.onPublish(t,e),this.heartbeats.clientActive()},onAuthExpired:()=>{this.heartbeats.serverActive(),this.handlers.onAuthExpired()}})}call(t,e,n){const s=this.seqCounter.next(),i=Wt();this.responseHandlers[s]=i;const r=this.socket.call(s,t,e,n);return r.ok||i.resolve(r),this.heartbeats.clientActive(),i.promise}async onResponse(t,e,n){const s=this.responseHandlers[t];s&&(200===e?s.ok({status:e,data:n}):s.serverErr({status:e,errorCode:n.errorCode,reasons:n.reasons}),delete this.responseHandlers[t])}stopWs(){this.socket.stopWs()}startWs(){this.socket.startWs()}destroy(){this.heartbeats.stop(),Object.values(this.responseHandlers).forEach((t=>{t.clientErr("WEBSOCKET_DISCONNECTED")})),this.responseHandlers={},this.socket.destroy()}terminate(){this.socket.terminate()}}class ne{constructor(t){this.connection=t,this.clientInactivityTimer=new Qt(25e3),this.serverInactivityTimer=new Qt(1e4),this.serverTimeoutTimer=new Qt(5e3)}clientActive(){this.clientInactivityTimer.schedule((()=>{this.sendHeartbeat()}))}serverActive(){this.serverTimeoutTimer.stop(),this.serverInactivityTimer.schedule((()=>{this.sendHeartbeat(),this.serverTimeoutTimer.schedule((()=>{this.connection.terminate()}))}))}stop(){this.clientInactivityTimer.stop(),this.serverInactivityTimer.stop(),this.serverTimeoutTimer.stop()}sendHeartbeat(){this.connection.call("GET",["ping"],{}).catch((()=>{}))}}class se{constructor(t,e,n){this.authProvider=e,this.handlers=n,this.stateMachine=new zt("AuthenticatedConnection",["WAITING_FOR_WS","LOGGING_IN","RENEWING_SESSION","READY","TERMINATED"],{logIn:{from:["WAITING_FOR_WS"],to:"LOGGING_IN",afterTransition:async()=>{await this.renewSession()}},logInFailed:{from:["LOGGING_IN"],to:"LOGGING_IN",afterTransition:async()=>{this.authProvider.refreshToken(),await this.renewSession()}},scheduledReauth:{from:["READY"],to:"RENEWING_SESSION",afterTransition:async()=>{await this.renewSession()}},scheduledReauthFailed:{from:["RENEWING_SESSION"],to:"RENEWING_SESSION",afterTransition:async()=>{this.authProvider.refreshToken(),await this.renewSession()}},authenticated:{from:["LOGGING_IN","RENEWING_SESSION"],to:"READY",afterTransition:({from:t})=>{"LOGGING_IN"===t&&this.handlers.onReady()}},authExpired:{from:["READY","RENEWING_SESSION"],to:"LOGGING_IN",afterTransition:async()=>{this.handlers.onNotReady(),this.authProvider.refreshToken(),await this.renewSession()}},wsDisconnected:{from:["READY","LOGGING_IN","RENEWING_SESSION"],to:"WAITING_FOR_WS",afterTransition:({from:t})=>{"READY"!==t&&"RENEWING_SESSION"!==t||this.handlers.onNotReady(),this.authProvider.clearScheduledRefresh()}},destroy:{from:"ANY",to:"TERMINATED",afterTransition:()=>{this.authProvider.clearScheduledRefresh(),this.connection.destroy()}}}),this.connection=new ee(t,{onUpstreamRestarting:()=>this.handlers.onUpstreamRestarting(),onReady:()=>this.stateMachine.transition("logIn"),onNotReady:()=>{this.stateMachine.transition("wsDisconnected")},onAuthExpired:()=>{this.stateMachine.transition("authExpired")},onPublish:(t,e)=>{this.handlers.onPublish(t,e)}}),e.onTokenChanged((()=>{"READY"===this.stateMachine.state&&this.stateMachine.transition("scheduledReauth")}))}call(t,e,n){const s=this.connection.call(t,e,n);return s.then((t=>{t.ok||"server"!==t.where||401!==t.value.status||"READY"!==this.stateMachine.state&&"RENEWING_SESSION"!==this.stateMachine.state||this.stateMachine.transition("authExpired")})),s}stopWs(){this.connection.stopWs()}startWs(){this.connection.startWs()}destroy(){this.stateMachine.transition("destroy")}async renewSession(){const t=await this.authProvider.getToken(),e=await this.connection.call("POST",["session","renew"],{token:t});if(!e.ok&&"client"===e.where)return;const n=e.value;if(n.status,200===n.status){const e=n.data.expiresInSeconds;return void(null!==e&&e<120?(console.warn(`[TalkJS] Authenticated with a token that expires in ${e}s. Treating it as already expired and refreshing. Newly generated tokens should last at least 10 minutes.`),"LOGGING_IN"===this.stateMachine.state?this.stateMachine.transition("logInFailed"):"RENEWING_SESSION"===this.stateMachine.state&&this.stateMachine.transition("scheduledReauthFailed")):(this.authProvider.scheduleRefresh(e),this.authProvider.emitTokenAccepted(t),this.stateMachine.canTransition("authenticated")&&this.stateMachine.transition("authenticated")))}if(401===n.status)return void("LOGGING_IN"===this.stateMachine.state?this.stateMachine.transition("logInFailed"):"RENEWING_SESSION"===this.stateMachine.state&&this.stateMachine.transition("scheduledReauthFailed"));if(400===n.status)return void this.authProvider.emitTokenRefreshFailed(Kt("Authentication",n));if(402===n.status)return void this.authProvider.emitTokenRefreshFailed(Kt("Authentication",n));const s=5e3*Math.random()+5e3;setTimeout((()=>{this.call("POST",["session","renew"],{token:t}).catch((()=>{}))}),s)}}class ie{get inactive(){return 0===this.pendingCalls&&0===this.activeSubscriptions}constructor(t,e,n){this.handlers=n,this.stateMachine=new zt("StopStartConnection",["STOPPED","WAITING_FOR_WS","READY","TERMINATED"],{unexpectedDisconnect:{from:["READY"],to:"WAITING_FOR_WS",afterTransition:()=>{this.inactivityTimer.stop(),this.handlers.onNotReady()}},stop:{from:["WAITING_FOR_WS","READY"],to:"STOPPED",afterTransition:()=>{this.connection.stopWs(),this.inactivityTimer.stop(),this.handlers.onNotReady()}},start:{from:["STOPPED"],to:"WAITING_FOR_WS",afterTransition:()=>{this.connection.startWs()}},ready:{from:["WAITING_FOR_WS"],to:"READY",afterTransition:()=>{this.pendingCalls=0,this.activeSubscriptions=0,this.inactivityTimer.schedule((()=>{this.stateMachine.transition("stop")})),this.handlers.onReady()}},destroy:{from:"ANY",to:"TERMINATED",afterTransition:()=>{this.inactivityTimer.stop(),this.connection.destroy()}}}),this.pendingCalls=0,this.activeSubscriptions=0,this.inactivityTimer=new Qt(3e3),this.connection=new se(t,e,{onUpstreamRestarting:()=>{this.handlers.onUpstreamRestarting()},onReady:()=>{this.stateMachine.transition("ready")},onNotReady:()=>{"READY"===this.stateMachine.state&&this.stateMachine.transition("unexpectedDisconnect")},onPublish:(t,e)=>{this.handlers.onPublish(t,e)}})}ensureStarted(){this.stateMachine.canTransition("start")&&this.stateMachine.transition("start")}async call(t,e,n){this.inactivityTimer.stop(),this.pendingCalls++;const s=await this.connection.call(t,e,n);return this.pendingCalls--,"SUBSCRIBE"===t&&s.ok?this.activeSubscriptions++:"UNSUBSCRIBE"===t&&s.ok&&this.activeSubscriptions--,this.inactive&&this.inactivityTimer.schedule((()=>{this.stateMachine.transition("stop")})),s}destroy(){this.stateMachine.transition("destroy")}isConnected(){return"READY"===this.stateMachine.state}}class re{constructor(t,e,n){this.handlers=n,this.stateMachine=new zt("QueuedConnection",["NOT_READY","PROCESSING_QUEUE","READY","TERMINATED"],{processQueue:{from:["NOT_READY"],to:"PROCESSING_QUEUE",afterTransition:()=>{this.sendQueuedCalls()}},ready:{from:["PROCESSING_QUEUE"],to:"READY",afterTransition:()=>{this.handlers.onReady()}},notReady:{from:["PROCESSING_QUEUE","READY"],to:"NOT_READY",afterTransition:()=>{Object.values(this.subscribeQueue).forEach((t=>t.deferred.ok({status:200,data:{}}))),this.subscribeQueue={},this.handlers.onSubscriptionsLost()}},destroy:{from:"ANY",to:"TERMINATED",afterTransition:()=>{for(var t;this.callQueue.length;){const e=null===(t=this.callQueue.shift())||void 0===t?void 0:t.deferred;null==e||e.clientErr("SESSION_DESTROYED")}this.connection.destroy()}}}),this.subscribeQueue={},this.callQueue=[],this.connection=new ie(t,e,{onUpstreamRestarting:()=>{this.handlers.onUpstreamRestarting()},onReady:()=>{this.stateMachine.transition("processQueue")},onNotReady:()=>{this.stateMachine.transition("notReady")},onPublish:(t,e)=>{this.handlers.onPublish(t,e)}})}call(t,e,n){return"READY"===this.stateMachine.state?this.connection.call(t,e,n):("NOT_READY"===this.stateMachine.state&&this.connection.ensureStarted(),"SUBSCRIBE"===t||"UNSUBSCRIBE"===t?this.gn(t,e,n):this.vn(t,e,n))}gn(t,e,n){const s=e.join("/"),i=this.subscribeQueue[s];if(i&&i.method===t)return i.deferred.promise;i&&i.method!==t&&(i.deferred.ok({status:200,data:{}}),delete this.subscribeQueue[s]);const r={deferred:Wt(),method:t,path:e,data:n};return this.subscribeQueue[s]=r,r.deferred.promise}vn(t,e,n){const s={deferred:Wt(),method:t,path:e,data:n};return this.callQueue.push(s),s.deferred.promise}dequeue(){for(const t in this.subscribeQueue){const e=this.subscribeQueue[t];return delete this.subscribeQueue[t],e}return this.callQueue.shift()}destroy(){this.stateMachine.transition("destroy")}async sendQueuedCalls(){let t=0;for(;"PROCESSING_QUEUE"===this.stateMachine.state;){t++;const e=this.dequeue();if(!e)return void this.stateMachine.transition("ready");this.connection.call(e.method,e.path,e.data).then((t=>{e.deferred.resolve(t)})),t>50&&await new Promise((t=>setTimeout(t,100)))}}isConnected(){return"READY"===this.stateMachine.state||"PROCESSING_QUEUE"===this.stateMachine.state}}var oe;const ae="undefined"!=typeof window&&null!==(oe=window.queueMicrotask)&&void 0!==oe?oe:setTimeout;class ue{constructor(t,e){this.clearPendingBatch=t,this.sendCalls=e,this.sent=!1,ae((()=>this.send()))}send(){this.sent||(this.sent=!0,this.clearPendingBatch(),this.sendCalls())}destroy(){this.sent=!0}}class ce extends ue{constructor(t,e){super(e,(()=>{this.sendSubscribe(),this.sendGet()})),this.connection=t,this.getCalls=[],this.subscribeCalls=[]}canPush(t,e){return ce.isCorrectBatchTypeFor(t,e)}static isCorrectBatchTypeFor(t,e){return Jt(e,["users","*"])&&("GET"===t||"SUBSCRIBE"===t)}push(t,e,n){const s=e[1],i=Wt();return"GET"===t?this.getCalls.push({userId:s,deferred:i}):this.subscribeCalls.push({userId:s,deferred:i}),1e3!==this.getCalls.length&&1e3!==this.subscribeCalls.length||this.send(),i.promise}async sendGet(){if(0===this.getCalls.length)return;const t=[...new Set(this.getCalls.map((t=>t.userId)))],e=await this.connection.call("GET",["users"],{ids:t,includePrivateFields:!1});if(e.ok)for(const t of this.getCalls){const n=e.value.data[t.userId];n?t.deferred.ok({status:200,data:n}):t.deferred.serverErr({status:404,errorCode:"NOT_FOUND",reasons:["No user with that ID exists"]})}else this.getCalls.forEach((t=>t.deferred.resolve(e)))}sendSubscribe(){if(0===this.subscribeCalls.length)return;const t=[...new Set(this.subscribeCalls.map((t=>t.userId)))];this.connection.call("SUBSCRIBE",["users"],{ids:t}).then((t=>this.subscribeCalls.forEach((e=>e.deferred.resolve(t)))))}}class he extends ue{constructor(t,e,n){super(n,(()=>this.sendMutate())),this.conversationId=t,this.connection=e,this.calls=[]}canPush(t,e){return!!he.isCorrectBatchTypeFor(t,e)&&e[1]===this.conversationId}static isCorrectBatchTypeFor(t,e){return Jt(e,["conversations","*","participants","*"])&&("PUT"===t||"POST"===t||"PATCH"===t)}push(t,e,n){const s=e[3],i=Wt();return this.calls.push({action:{id:s,method:t,params:n},deferred:i}),100===this.calls.length&&this.send(),i.promise}async sendMutate(){const t=this.calls.map((t=>t.action)),e=await this.connection.call("POST",["conversations",this.conversationId,"participants"],{actions:t});if(!e.ok)return void this.calls.forEach((t=>t.deferred.resolve(e)));const n=e.value.data.responses;for(let t=0;t<n.length;t++){const e=this.calls[t].deferred,s=n[t];200===s.status?e.ok(Object.assign(Object.assign({},s),{data:{}})):e.serverErr(s)}}}class le{constructor(t,e,n){this.pendingBatch=null,this.connection=new re(t,e,n)}async call(t,e,n){var s;if(null===(s=this.pendingBatch)||void 0===s?void 0:s.canPush(t,e))return this.pendingBatch.push(t,e,n);this.pendingBatch&&this.pendingBatch.send();const i=this.createEmptyBatchFor(t,e);return i?(this.pendingBatch=i,i.push(t,e,n)):this.connection.call(t,e,n)}destroy(){var t;this.connection.destroy(),null===(t=this.pendingBatch)||void 0===t||t.destroy()}isConnected(){return this.connection.isConnected()}createEmptyBatchFor(t,e){if(ce.isCorrectBatchTypeFor(t,e))return new ce(this.connection,(()=>this.pendingBatch=null));if(he.isCorrectBatchTypeFor(t,e)){const t=e[1];return new he(t,this.connection,(()=>this.pendingBatch=null))}return null}}const de={200:"RESOLVE",400:"RESOLVE",401:"RETRY",402:"RESOLVE",403:"RESOLVE",404:"RESOLVE",405:"RESOLVE",409:"RESOLVE",429:"DELAY",500:"DELAY"};class fe{constructor(t,e,n){this.throttler=new pe,this.alive=!0,this.connection=new le(t,e,n)}async call(t,e,n){let s=0;for(;this.alive;){const i=await this.connection.call(t,e,n);if((i.ok||"client"!==i.where||"SOCKET_NOT_READY"!==i.value)&&(i.ok||"server"!==i.where||500!==i.value.status)||s++,10===s)return i;if(i.ok||"client"!==i.where){const t=i.value,e=t.status,n=de[e];if("RESOLVE"===n)return this.throttler.resetDelay(),i;if("RETRY"===n)continue;if("DELAY"===n){await this.throttler.wait();continue}return console.warn("[TalkJS] Unexpected status code",e),t}if("SESSION_DESTROYED"===i.value)return Yt("SESSION_DESTROYED");if("WEBSOCKET_DISCONNECTED"!==i.value)if("SOCKET_NOT_READY"!==i.value){i.value}else await this.throttler.wait()}return Yt("SESSION_DESTROYED")}destroy(){this.alive=!1,this.connection.destroy()}isConnected(){return this.connection.isConnected()}}class pe{constructor(){this.initialDelayMs=200,this.exponentialFactor=1.2,this.maxDelayMs=3e4,this.currentDelayMs=this.initialDelayMs,this.lastCall=0}getCurrentDelay(){return this.currentDelayMs}wait(){const t=(new Date).getTime(),e=Object(W.d)(this.currentDelayMs,.05),n=this.lastCall+e,s=Math.max(0,n-t);return this.lastCall=t+s,this.currentDelayMs=Math.min(e*this.exponentialFactor,this.maxDelayMs),Object(W.c)(s)}resetDelay(){this.currentDelayMs=this.initialDelayMs}}function me(t){return t.map((t=>encodeURIComponent(t))).join()}class ge{constructor(){this.paths={}}add(t){this.paths[me(t)]=t}delete(t){delete this.paths[me(t)]}has(t){return Object.hasOwnProperty.call(this.paths,me(t))}clear(){this.paths={}}forEach(t){Object.values(this.paths).forEach((e=>t(e)))}}class ve{constructor(t,e,n){this.handlers=n,this.targetSubscriptions=new ge,this.connection=new fe(t,e,{onUpstreamRestarting:()=>this.handlers.onUpstreamRestarting(),onSubscriptionsLost:()=>{this.targetSubscriptions.forEach((t=>{this.resubscribe(t)})),this.handlers.onResubscribeSent()},onReady:()=>this.handlers.onReady(),onPublish:(t,e)=>{this.handlers.onPublish(t,e)}})}call(t,e,n){return this.connection.call(t,e,n)}async subscribe(t){return this.targetSubscriptions.add(t),this.connection.call("SUBSCRIBE",t,{})}async unsubscribe(t){return this.targetSubscriptions.delete(t),this.connection.call("UNSUBSCRIBE",t,{})}async resubscribe(t){const e=await this.connection.call("SUBSCRIBE",t,{});e.ok||this.handlers.onResubscribeError(t,e)}destroy(){this.targetSubscriptions.clear(),this.connection.destroy()}isConnected(){return this.connection.isConnected()}}function be(t,e){return void 0===e?t:e}function Ae(t,e){if(void 0===e)return t;if(null===e)return{};const n=Object.assign({},t);for(const t in e){const s=e[t];null===s?delete n[t]:n[t]=s}return n}function we(t,e){if(t===e)return!0;if(!t||!e)return!1;if("object"!=typeof t||"object"!=typeof e)return!1;if(t.constructor!==e.constructor)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!we(t[n],e[n]))return!1}else{const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const s of n){if(!Object.hasOwnProperty.call(e,s))return!1;if(!we(t[s],e[s]))return!1}}return!0}class Ee{constructor(){this.prev=Promise.resolve()}async runExclusive(t){const e=this.prev.then((()=>t()));return this.prev=e,e}}class Oe extends class extends class{constructor(t){this.initialised=!1,this.getPointer=void 0,this.pendingStates=[t],t.resultPromise.then((()=>this.initialised=!0))}get pendingPointer(){if(0!==this.pendingStates.length)return this.pendingStates[this.pendingStates.length-1]}get mostRecentState(){var t;return null!==(t=this.pendingPointer)&&void 0!==t?t:this.getPointer}canAppendState(t){var e,n;const s=null===(e=this.getPointer)||void 0===e?void 0:e.seq;if(void 0!==s&&t<=s)return!1;const i=null===(n=this.pendingPointer)||void 0===n?void 0:n.seq;return!(void 0!==i&&t<i)}set(t){if(!this.canAppendState(t.seq))throw"Appending in the past";this.pendingStates.push(t)}mutate(t,e){if(!this.initialised)return;if(!this.canAppendState(t))throw"Mutating in the past";const n=this.mostRecentState.resultPromise.then((t=>t.ok?e(t):t));this.pendingStates.push({seq:t,resultPromise:n})}get(t){if(void 0!==this.getPointer&&t<this.getPointer.seq)throw`Trying to load state ${t} when we have previously loaded ${this.getPointer.seq}`;for(;this.pendingStates.length>0&&this.pendingStates[0].seq<=t;)this.getPointer=this.pendingStates.shift();return this.getPointer}}{constructor(t,e){super(t),this.onTeardown=e,this.bn=null,this.An=Promise.resolve(void 0)}get error(){return this.bn}get lastGoodState(){return this.An}mutate(t,e){super.mutate(t,e),this.registerNewState(this.mostRecentState.resultPromise)}set(t){super.set(t),this.registerNewState(this.mostRecentState.resultPromise)}registerNewState(t){const e=this.lastGoodState;this.An=t.then((t=>t.ok?t.value:e)),t.then((t=>{t.ok||this.setError(t)}))}setError(t){var e;this.bn||(this.bn=t,null===(e=this.onTeardown)||void 0===e||e.call(this,t),this.lastGoodState.then((t=>{void 0!==t&&this.teardownNested(t)})))}}{constructor(t){super({seq:0,resultPromise:new Promise((t=>setTimeout(t))).then((()=>this.fetchInitial(0)))},t),this.getDeepMutex=new Ee,this.lastDeep=void 0}async refetchInitial(t){const e=this.mostRecentState.resultPromise,n=this.fetchInitial(t),[s,i]=await Promise.all([e,n]);if(void 0===s||!s.ok)return i;if(!i.ok)return i;return this.equal(s.value,i.value)?s:i}refetch(t){if(null!==this.error)return;const e={seq:t,resultPromise:this.refetchInitial(t)};this.set(e)}async changedBetween(t,e){if(t>=e)return!1;const n=this.get(e),s=await n.resultPromise;if(!s.ok)return!1;if(s.value.lastChanged>t)return!0;return await this.anyChildChanged(t,e,s.value)}async getDeep(t){return this.getDeepMutex.runExclusive((async()=>{var e;if(null!==this.error)return this.error;const n=null===(e=this.lastDeep)||void 0===e?void 0:e.seq;if(t===n)return this.lastDeep.deep;if(void 0!==n){if(t<n)throw`Trying to load seq ${t} when we have previously loaded seq ${n}`;if(!await this.changedBetween(n,t))return this.lastDeep.seq=t,this.lastDeep.deep}const s=this.get(t).resultPromise,i=s.then((e=>e.ok?this.loadNested(t,e.value):e));this.lastDeep={seq:t,shallow:s,deep:i};const r=await i;return r.ok||this.setError(r),r}))}}class Te extends Oe{constructor(t,e){super(e),this.emitMutex=t,this.unsubscribeTimer=new ye,this.referencedByOtherStores=0,this.listeners=[],this.lastEmitSeq=void 0,this.lastEmitResult=void 0,t.runExclusive((async()=>{await this.emit(0)}))}registerInternalSubscription(){this.referencedByOtherStores++;let t=!0;return()=>{t&&(t=!1,this.referencedByOtherStores--,this.startUnsubscribeTimerIfOrphan())}}get onlyUsedInternally(){return 0===this.listeners.length}listen(t){return this.unsubscribeTimer.stop(),this.listeners.push(t),void 0!==this.lastEmitResult&&t(this.lastEmitResult),()=>{this.listeners=this.listeners.filter((e=>e!==t)),this.startUnsubscribeTimerIfOrphan()}}startUnsubscribeTimerIfOrphan(){0===this.referencedByOtherStores&&0===this.listeners.length&&this.unsubscribeTimer.restart((()=>{this.setError(Yt("UNSUBSCRIBED"))}),this.unsubscribeDebounceMs)}getLoadMoreSeq(){var t;const e=null!==(t=this.lastEmitSeq)&&void 0!==t?t:0,n=this.mostRecentState.seq;return Math.max(e,n)+1e-6}async emit(t){var e;if(this.onlyUsedInternally)return;if(this.lastEmitSeq&&this.lastEmitSeq>=t)return;if(!1===(null===(e=this.lastEmitResult)||void 0===e?void 0:e.ok))return;this.lastEmitSeq=t;const n=await this.getDeep(t);n!==this.lastEmitResult&&(this.lastEmitResult=n,this.listeners.forEach((t=>t(n))))}}class ye{constructor(){this.timerId=void 0}restart(t,e){void 0!==this.timerId&&clearTimeout(this.timerId),this.timerId=setTimeout((()=>t()),e)}stop(){clearTimeout(this.timerId)}}class Ce extends Te{constructor(t,e,n,s){super(n,s),this.userId=t,this.realtimeClient=e,this.unsubscribeDebounceMs=1e4}async fetchInitial(t){const e=await this.realtimeClient.call("GET",["users",this.userId],{includePrivateFields:!1},{bypassCache:!0});return e.ok?Ht({snapshot:this.realtimeClient.createUserSnapshot(e.value.data),lastChanged:t}):"server"===e.where&&404===e.value.status?Ht({snapshot:null,lastChanged:t}):e}equal(t,e){return we(t.snapshot,e.snapshot)}async loadNested(t,e){return Ht(e)}userCreated(t,e){this.mutate(t,(n=>null!==n.value.snapshot?n:Ht({snapshot:this.realtimeClient.createUserSnapshot(e.state),lastChanged:t})))}userEdited(t,e){this.mutate(t,(n=>{const s=n.value.snapshot;if(null===s)return console.warn("[TalkJS] Received a 'used edited' event for a user that we thought didn't exist."),n;return Ht({snapshot:{id:s.id,name:be(s.name,e.diff.name),custom:Ae(s.custom,e.diff.custom),locale:be(s.locale,e.diff.locale),photoUrl:be(s.photoUrl,e.diff.photoUrl),role:be(s.role,e.diff.role),welcomeMessage:be(s.welcomeMessage,e.diff.welcomeMessage)},lastChanged:t})}))}async getFromCache(){const t=await this.mostRecentState.resultPromise;return t.ok?null===t.value.snapshot?qt({status:404,errorCode:"USER_NOT_FOUND",reasons:["That user does not exist yet"]}):Ht({status:200,data:{id:t.value.snapshot.id,name:t.value.snapshot.name,custom:t.value.snapshot.custom,locale:t.value.snapshot.locale,photoUrl:t.value.snapshot.photoUrl,role:t.value.snapshot.role,welcomeMessage:t.value.snapshot.welcomeMessage}}):Yt("NOT_IN_CACHE")}teardownNested(t){}async anyChildChanged(t,e,n){return!1}}var Se=n(48);class Ie extends Oe{get messageId(){return"string"==typeof this.message?this.message:this.message.id}constructor(t,e,n){super(),this.conversationId=t,this.message=e,this.realtimeClient=n}async fetchInitial(t){let e;if("object"==typeof this.message)e=this.message;else{const t=await this.realtimeClient.call("GET",["me","conversations",this.conversationId,"messages",this.message],{},{bypassCache:!0});if(!t.ok)return t;e=t.value.data}return Ht({lastChanged:t,sender:null===e.senderId?null:this.realtimeClient.internalSubscribe(["users",e.senderId]),data:{id:e.id,type:e.type,custom:e.custom,createdAt:e.createdAt,editedAt:e.editedAt,referencedMessageId:e.referencedMessageId,origin:e.origin,plaintext:Object(Se.a)(e.content,{}),content:e.content}})}refetch(t){throw"Do not call refetch on message data stores, it can return outdated data. Destroy and remake them instead"}equal(t,e){return we(t.data,e.data)}teardownNested(t){var e;null===(e=t.sender)||void 0===e||e.unsubscribe()}async anyChildChanged(t,e,n){var s;const i=null===(s=n.sender)||void 0===s?void 0:s.store;return!0===await(null==i?void 0:i.changedBetween(t,e))}async loadNested(t,e){var n,s,i;const r=await(null===(s=null===(n=e.sender)||void 0===n?void 0:n.store)||void 0===s?void 0:s.getDeep(t));if(!1===(null==r?void 0:r.ok))return r;if(null===e.data)return Ht({snapshot:null});const o=null==r?void 0:r.value;return Ht({snapshot:{sender:null!==(i=null==o?void 0:o.snapshot)&&void 0!==i?i:null,id:e.data.id,type:e.data.type,custom:e.data.custom,createdAt:e.data.createdAt,editedAt:e.data.editedAt,origin:e.data.origin,plaintext:Object(Se.a)(e.data.content,{}),content:e.data.content,referencedMessageId:e.data.referencedMessageId}})}messageEdited(t,e){this.mutate(t,(n=>{if(null===n.value.data)return n;return Ht({lastChanged:t,sender:n.value.sender,data:{id:n.value.data.id,type:n.value.data.type,createdAt:n.value.data.createdAt,origin:n.value.data.origin,referencedMessageId:n.value.data.referencedMessageId,editedAt:be(n.value.data.editedAt,e.diff.editedAt),custom:Ae(n.value.data.custom,e.diff.custom),content:be(n.value.data.content,e.diff.content)}})}))}messageDeleted(t,e){this.mutate(t,(n=>null===n.value.data?n:this.messageId===e.messageId?(this.teardownNested(n.value),Ht({lastChanged:t,sender:null,data:null})):n.value.data.referencedMessageId===e.messageId?Ht({lastChanged:t,sender:n.value.sender,data:{id:n.value.data.id,type:n.value.data.type,createdAt:n.value.data.createdAt,origin:n.value.data.origin,referencedMessageId:null,editedAt:n.value.data.editedAt,custom:n.value.data.custom,content:n.value.data.content}}):n))}async getFromCache(){var t;const e=await this.mostRecentState.resultPromise;if(!e.ok)return Yt("NOT_IN_CACHE");if(null===e.value.data){return qt({status:404,errorCode:"MESSAGE_NOT_FOUND",reasons:["No message with that ID exists"]})}const n=e.value,{sender:s}=n,i=Object(lt.d)(n,["sender"]);return Ht({status:200,data:Object.assign(Object.assign({},i.data),{senderId:null!==(t=null==s?void 0:s.store.userId)&&void 0!==t?t:null})})}}class ke extends Oe{get messageId(){return this.dataStore.messageId}constructor(t,e,n){super(),this.createdAt=t,this.dataStore=e,this.referencedDataStore=n}async fetchInitial(t){return Ht({lastChanged:t,dataStore:this.dataStore,referencedDataStore:this.referencedDataStore})}refetch(t){throw"Do not call refetch on message stores, it can return outdated data. Destroy and remake them instead"}equal(t,e){return!0}teardownNested(t){}async anyChildChanged(t,e,{dataStore:n,referencedDataStore:s}){if(!0===await n.changedBetween(t,e))return!0;return!0===await(null==s?void 0:s.changedBetween(t,e))}async loadNested(t,e){var n,s,i;const r=await e.dataStore.getDeep(t);if(!r.ok)return r;const o=r.value;if(null===o.snapshot)return Ht({snapshot:null});const a=await(null===(n=e.referencedDataStore)||void 0===n?void 0:n.getDeep(t));if(a&&!a.ok)return a;const u=null!==(s=null==a?void 0:a.value)&&void 0!==s?s:null,c=null!==(i=null==u?void 0:u.snapshot)&&void 0!==i?i:null;return Ht({snapshot:{id:o.snapshot.id,type:o.snapshot.type,sender:o.snapshot.sender,custom:o.snapshot.custom,createdAt:o.snapshot.createdAt,editedAt:o.snapshot.editedAt,referencedMessage:c,origin:o.snapshot.origin,plaintext:o.snapshot.plaintext,content:o.snapshot.content}})}}class _e extends Te{listen(t){return this.onlyUsedInternally&&this.mostRecentState.resultPromise.then((t=>{if(t.ok&&null!==t.value.inWindow){const e=30-t.value.inWindow.length;e>0&&this.wn(e)}})),super.listen(t)}constructor(t,e,n,s){super(n,s),this.conversationId=t,this.realtimeClient=e,this.unsubscribeDebounceMs=1e3,this.pendingLoadMore=void 0}async fetchInitial(t){const e=this.onlyUsedInternally?1:30,n=await De({realtimeClient:this.realtimeClient,conversationId:this.conversationId,count:e});return n.ok?null===n.value.messages?Ht({lastChanged:t,lastMessageChanged:t,stores:null,inWindow:null,windowEnd:null}):Ne({seq:t,messages:n.value.messages,cursor:n.value.nextCursor,conversationId:this.conversationId,realtimeClient:this.realtimeClient}):n}teardownNested(t){if(t.stores){const e=Yt("TERMINATED");Object.values(t.stores).forEach((t=>t.setError(e))),t.inWindow.forEach((t=>t.setError(e)))}}async anyChildChanged(t,e,n){for(const s in n.stores){const i=n.stores[s];if(!0===await(null==i?void 0:i.changedBetween(t,e)))return!0}return!1}async lastMessageChangedBetween(t,e){if(t>=e)return!1;const n=await this.get(e).resultPromise;if(!n.ok)return!1;if(n.value.lastMessageChanged>t)return!0;if(null===n.value.stores)return!1;const s=n.value.inWindow[0];if(void 0===s)return!1;return!0===await s.changedBetween(t,e)}equal(t,e){return null===t.stores&&null===e.stores||null!==t.stores&&null!==e.stores&&(!!we(Object.keys(t.stores),Object.keys(e.stores))&&(!!we(t.inWindow.map((t=>t.messageId)),e.inWindow.map((t=>t.messageId)))&&we(t.windowEnd,e.windowEnd)))}async loadNested(t,e){if(null===e.stores)return Ht({snapshot:null,loadedAll:!0});const n=await Promise.all(e.inWindow.map((e=>e.getDeep(t)))),s=n.find((t=>!t.ok));if(s)return s;return Ht({snapshot:n.filter((t=>null!==t.value.snapshot)).map((t=>t.value.snapshot)),loadedAll:null===e.windowEnd})}async loadMore(t){if(this.pendingLoadMore)return this.pendingLoadMore;const e=Object(W.b)();this.pendingLoadMore=e.promise,await this.wn(t),e.resolve(),this.pendingLoadMore=void 0}async wn(t=30){const e=await this.mostRecentState.resultPromise;if(!e.ok)return;if(null===e.value.windowEnd)return;const n=e.value.windowEnd.cursor,s=await De({count:t,cursor:n,conversationId:this.conversationId,realtimeClient:this.realtimeClient}),i=this.getLoadMoreSeq();this.mutate(i,(t=>null===t.value.windowEnd||n!==t.value.windowEnd.cursor?t:s.ok?null===s.value.messages?(console.warn("[TalkJS] When loading more messages, the conversation no longer existed. We should have been told about this."),t):Ne({seq:i,prevState:t.value,messages:s.value.messages,cursor:s.value.nextCursor,conversationId:this.conversationId,realtimeClient:this.realtimeClient}):s)),await this.emitMutex.runExclusive((()=>this.emit(i)))}messageCreated(t,e){this.mutate(t,(n=>{if(null===n.value.stores)return console.warn("[TalkJS] Received a 'message.created' event for a nonexistent conversation."),n;if(n.value.windowEnd&&e.state.createdAt<n.value.windowEnd.oldestMessageTs)return n;if(Object.hasOwnProperty.call(n.value.stores,e.state.id))return n;const s=Object.assign({},n.value.stores),i=new Ie(this.conversationId,e.state,this.realtimeClient);s[e.state.id]=i;const r=e.state.referencedMessageId;let o;null===r?o=null:r in s?o=s[r]:(o=new Ie(this.conversationId,r,this.realtimeClient),s[r]=o);const a=new ke(e.state.createdAt,i,o),u=[...n.value.inWindow,a];u.sort(((t,e)=>e.createdAt-t.createdAt));const c=u[0].messageId===e.messageId?t:n.value.lastMessageChanged;return Ht({lastChanged:t,lastMessageChanged:c,stores:s,inWindow:u,windowEnd:n.value.windowEnd})}))}messageEdited(t,e){this.mutate(t,(n=>{var s;return null===n.value.stores?(console.warn("[TalkJS] Received a 'message.edited' event for a nonexistent conversation."),n):(null===(s=n.value.stores[e.messageId])||void 0===s||s.messageEdited(t,e),n)}))}messageDeleted(t,e){this.mutate(t,(n=>{if(null===n.value.stores)return console.warn("[TalkJS] Received a 'message.deleted' event for a conversation that we thought didn't exist."),n;if(Object.values(n.value.stores).forEach((n=>n.messageDeleted(t,e))),void 0===n.value.stores[e.messageId])return n;const s=Object.assign({},n.value.stores);delete s[e.messageId];const i=n.value.inWindow.filter((t=>t.messageId!==e.messageId));if(e.newLastMessage&&0===i.length){const t=new Ie(this.conversationId,e.newLastMessage,this.realtimeClient);s[t.messageId]=t;const n=e.newLastMessage.referencedMessageId;let r;null===n?r=null:n in s?r=s[n]:(r=new Ie(this.conversationId,n,this.realtimeClient),s[n]=r);const o=new ke(e.newLastMessage.createdAt,t,r);i.push(o)}const r=void 0!==e.newLastMessage?t:n.value.lastMessageChanged;return Ht({lastChanged:t,lastMessageChanged:r,stores:s,inWindow:i,windowEnd:n.value.windowEnd})}))}conversationCleared(t,e){this.mutate(t,(e=>{var n;return 0===(null===(n=e.value.inWindow)||void 0===n?void 0:n.length)&&null===e.value.windowEnd?e:(this.teardownNested(e.value),Ht({lastChanged:t,lastMessageChanged:t,stores:{},inWindow:[],windowEnd:null}))}))}sideCreated(t,e){const n=this.fetchInitial(t);this.mutate(t,(t=>null!==t.value.stores?(n.then((t=>{t.ok&&this.teardownNested(t.value)})),t):n))}sideDeleted(t,e){this.mutate(t,(e=>null===e.value.stores?e:(this.teardownNested(e.value),Ht({lastChanged:t,lastMessageChanged:t,stores:null,inWindow:null,windowEnd:null}))))}async getMessageFromCache(t){const e=await this.mostRecentState.resultPromise;if(!e.ok)return Yt("NOT_IN_CACHE");if(null===e.value.stores)return Yt("NOT_IN_CACHE");const n=e.value.stores[t];return void 0===n?Yt("NOT_IN_CACHE"):n.getFromCache()}}async function De({cursor:t,realtimeClient:e,conversationId:n,count:s}){const i={limit:s,cursor:t},r=await e.call("GET",["me","conversations",n,"messages"],i,{bypassCache:!0});if(r.ok){const{data:t,cursor:e}=r.value.data;return Ht({messages:t,nextCursor:e})}return(r.ok||"server"!==r.where||404!==r.value.status)&&(r.ok||"server"!==r.where||403!==r.value.status||"NOT_A_PARTICIPANT"!==r.value.errorCode)?r:Ht({messages:null,nextCursor:null})}function Ne({seq:t,prevState:e,messages:n,cursor:s,conversationId:i,realtimeClient:r}){var o,a,u,c;const h=e?Object.assign({},e.stores):{};for(const t of n)if(void 0===h[t.id]){const e=new Ie(i,t,r);h[e.messageId]=e}for(const t of n){const e=t.referencedMessageId;if(e&&void 0===h[e]){const t=new Ie(i,e,r);h[t.messageId]=t}}const l=e?[...e.inWindow]:[];for(const t of n)l.push(new ke(t.createdAt,h[t.id],t.referencedMessageId?h[t.referencedMessageId]:null));l.sort(((t,e)=>e.createdAt-t.createdAt));const d=null===(a=null===(o=null==e?void 0:e.inWindow)||void 0===o?void 0:o[0])||void 0===a?void 0:a.messageId,f=null===(u=null==l?void 0:l[0])||void 0===u?void 0:u.messageId,p=null!==(c=null==e?void 0:e.lastMessageChanged)&&void 0!==c?c:t,m=d===f?p:t;if(null===s)return Ht({lastChanged:t,lastMessageChanged:m,stores:h,inWindow:l,windowEnd:null});return Ht({lastChanged:t,lastMessageChanged:m,stores:h,inWindow:l,windowEnd:{cursor:s,oldestMessageTs:n[n.length-1].createdAt}})}class Fe extends Te{constructor(t,e,n,s){super(n,s),this.convDataStore=t,this.realtimeClient=e,this.unsubscribeDebounceMs=0}async fetchInitial(t){return Ht({lastChanged:t,store:this.convDataStore})}teardownNested(t){t.store.unsubscribe()}async anyChildChanged(t,e,n){return n.store.store.changedBetween(t,e)}equal(t,e){return!0}async loadNested(t,e){return e.store.store.getDeep(t)}async getFromCache(){return this.convDataStore.store.getFromCache()}}var xe=n(8);class Pe extends Te{constructor(t,e,n,s){super(n,s),this.conversationId=t,this.realtimeClient=e,this.unsubscribeDebounceMs=1e4}async fetchInitial(t){const e=await this.realtimeClient.call("GET",["me","conversations",this.conversationId,"typing"],{},{bypassCache:!0});if(!e.ok&&"server"===e.where&&404===e.value.status)return Ht({data:null,lastChanged:t});if(!e.ok&&"server"===e.where&&403===e.value.status&&"NOT_A_PARTICIPANT"===e.value.errorCode)return Ht({data:null,lastChanged:t});if(!e.ok)return e;const n=e.value.data;if(n.many)return Ht({data:{usersTyping:null,many:!0},userSubscriptions:{},lastChanged:t});return Ht({data:n,userSubscriptions:xe.g(n.usersTyping,((t,e)=>this.realtimeClient.internalSubscribe(["users",e]))),lastChanged:t})}equal(t,e){return we(t.data,e.data)}async loadNested(t,e){if(null===e.data)return Ht({snapshot:null,lastChanged:e.lastChanged});if(e.data.many)return Ht({snapshot:{many:!0},lastChanged:e.lastChanged});const n=Object.entries(e.data.usersTyping).sort((([t,e],[n,s])=>e-s)).map((([t,e])=>t)).map((n=>e.userSubscriptions[n].store.getDeep(t))),s=await Promise.all(n),i=s.find((t=>!t.ok));if(i)return i;const r=s.map((t=>t.value)),o=r.map((t=>t.snapshot)),a=r.map((t=>t.lastChanged));return Ht({snapshot:{users:o,many:!1},lastChanged:Math.max(e.lastChanged,...a)})}typingAvailable(t,e){this.mutate(t,(()=>Ht({data:e.state,userSubscriptions:e.state.many?{}:xe.g(e.state.usersTyping,((t,e)=>this.realtimeClient.internalSubscribe(["users",e]))),lastChanged:t})))}typingChanged(t,e){this.mutate(t,(n=>{if(null===n.value.data)return n;if(void 0===e.diff.many){if(!0===n.value.data.many)return n;const s=Object.assign({},n.value.data.usersTyping),i=Object.assign({},n.value.userSubscriptions);return xe.d(e.diff.usersTyping,((t,e)=>{var n;if("number"==typeof t)s[e]=t,i[e]=this.realtimeClient.internalSubscribe(["users",e]);else if(null===t)delete s[e],null===(n=i[e])||void 0===n||n.unsubscribe(),delete i[e];else{}})),Ht({data:{usersTyping:s,many:!1},userSubscriptions:i,lastChanged:t})}if(!0===e.diff.many)return n.value.data.many?n:Ht({data:{usersTyping:null,many:!0},userSubscriptions:{},lastChanged:t});if(!1===e.diff.many){if(!1===n.value.data.many)return n;const s=xe.g(e.diff.usersTyping,((t,e)=>this.realtimeClient.internalSubscribe(["users",e])));return Ht({data:e.diff,userSubscriptions:s,lastChanged:t})}e.diff;throw"Unreachable"}))}sideDeleted(t,e){this.mutate(t,(e=>null===e.value.data?e:Ht({data:null,lastChanged:t})))}teardownNested(t){t.data&&xe.d(t.userSubscriptions,(t=>t.unsubscribe()))}async anyChildChanged(t,e,n){var s;if(null===n.data)return!1;for(const i in n.userSubscriptions){const r=n.userSubscriptions[i];if(!0===await(null===(s=null==r?void 0:r.store)||void 0===s?void 0:s.changedBetween(t,e)))return!0}return!1}}class je extends Oe{constructor(t,e,n){super(),this.conversationId=t,this.participantData=e,this.realtimeClient=n}async fetchInitial(t){return Ht({lastChanged:t,user:this.realtimeClient.internalSubscribe(["users",this.participantData.id]),data:this.participantData})}refetch(t){throw"Do not call refetch on participant data stores, it can return outdated data. Destroy and remake them instead"}equal(t,e){var n,s,i,r;return(null===(s=null===(n=t.user)||void 0===n?void 0:n.store)||void 0===s?void 0:s.userId)===(null===(r=null===(i=e.user)||void 0===i?void 0:i.store)||void 0===r?void 0:r.userId)&&we(t.data,e.data)}teardownNested(t){var e;null===(e=t.user)||void 0===e||e.unsubscribe()}async anyChildChanged(t,e,n){var s;const i=null===(s=n.user)||void 0===s?void 0:s.store;return!0===await(null==i?void 0:i.changedBetween(t,e))}async loadNested(t,e){if(null===e.data)return Ht({snapshot:null});const n=await e.user.store.getDeep(t);if(!1===n.ok)return n;const s=n.value.snapshot;return Ht({snapshot:this.realtimeClient.createParticipantSnapshotPreloaded(e.data,s)})}participantEdited(t,e){this.mutate(t,(n=>{if(null===n.value.data)return n;return Ht({lastChanged:t,user:n.value.user,data:{id:n.value.data.id,access:be(n.value.data.access,e.diff.access),notify:be(n.value.data.notify,e.diff.notify),joinedAt:n.value.data.joinedAt}})}))}participantDeleted(t,e){this.mutate(t,(e=>null===e.value.data?e:(this.teardownNested(e.value),Ht({lastChanged:t,user:null,data:null}))))}async getFromCache(){const t=await this.mostRecentState.resultPromise;if(!t.ok)return Yt("NOT_IN_CACHE");if(null===t.value.data){return qt({status:404,errorCode:"PARTICIPANT_NOT_FOUND",reasons:["No participant with that ID exists"]})}return Ht({status:200,data:t.value.data})}}class Be extends Te{constructor(t,e,n,s){super(n,s),this.conversationId=t,this.realtimeClient=e,this.unsubscribeDebounceMs=1e3,this.pendingLoadMore=void 0}async fetchInitial(t){const e=await Re({realtimeClient:this.realtimeClient,conversationId:this.conversationId,count:10});return e.ok?null===e.value.participants?Ht({lastChanged:t,stores:null,inWindow:null,windowEnd:null}):Me({seq:t,participants:e.value.participants,cursor:e.value.nextCursor,conversationId:this.conversationId,realtimeClient:this.realtimeClient}):e}teardownNested(t){if(t.stores){const e=Yt("TERMINATED");Object.values(t.stores).forEach((t=>t.setError(e)))}}async anyChildChanged(t,e,n){for(const s in n.stores){const i=n.stores[s];if(!0===await(null==i?void 0:i.changedBetween(t,e)))return!0}return!1}equal(t,e){return null===t.stores&&null===e.stores||null!==t.stores&&null!==e.stores&&(!!we(Object.keys(t.stores),Object.keys(e.stores))&&we(t.windowEnd,e.windowEnd))}async loadNested(t,e){if(null===e.stores)return Ht({snapshot:null,loadedAll:!0});const n=await Promise.all(Object.values(e.stores).map((e=>e.getDeep(t)))),s=n.find((t=>!t.ok));if(s)return s;const i=n.filter((t=>null!==t.value.snapshot)).map((t=>t.value.snapshot));return i.sort(((t,e)=>e.joinedAt-t.joinedAt)),Ht({snapshot:i,loadedAll:null===e.windowEnd})}async loadMore(t){if(this.pendingLoadMore)return this.pendingLoadMore;const e=Object(W.b)();this.pendingLoadMore=e.promise,await this.En(t),e.resolve(),this.pendingLoadMore=void 0}async En(t=10){const e=await this.mostRecentState.resultPromise;if(!e.ok)return;if(null===e.value.windowEnd)return;const n=e.value.windowEnd.cursor,s=await Re({count:t,cursor:n,conversationId:this.conversationId,realtimeClient:this.realtimeClient}),i=this.getLoadMoreSeq();this.mutate(i,(t=>null===t.value.windowEnd||n!==t.value.windowEnd.cursor?t:s.ok?null===s.value.participants?(console.warn("[TalkJS] When loading more participants, the conversation no longer existed. We should have been told about this."),t):Me({seq:i,prevStores:t.value.stores,participants:s.value.participants,cursor:s.value.nextCursor,conversationId:this.conversationId,realtimeClient:this.realtimeClient}):s)),await this.emitMutex.runExclusive((()=>this.emit(i)))}participantCreated(t,e){this.mutate(t,(n=>{if(null===n.value.stores)return console.warn("[TalkJS] Received a 'participant.created' event for a nonexistent conversation."),n;if(n.value.windowEnd&&e.state.joinedAt<n.value.windowEnd.oldestParticipantTs)return n;if(Object.hasOwnProperty.call(n.value.stores,e.state.id))return n;const s=Object.assign({},n.value.stores),i=new je(this.conversationId,e.state,this.realtimeClient);s[e.state.id]=i;return Ht({lastChanged:t,stores:s,windowEnd:n.value.windowEnd})}))}participantEdited(t,e){this.mutate(t,(n=>{var s;return null===n.value.stores?(console.warn("[TalkJS] Received a 'participant.edited' event for a nonexistent conversation."),n):(null===(s=n.value.stores[e.userId])||void 0===s||s.participantEdited(t,e),n)}))}participantDeleted(t,e){this.mutate(t,(n=>{if(null===n.value.stores)return console.warn("[TalkJS] Received a 'participant.deleted' event for a conversation that we thought didn't exist."),n;const s=n.value.stores[e.userId];if(void 0===s)return n;s.participantDeleted(t,e);const i=Object.assign({},n.value.stores);return delete i[e.userId],Ht({lastChanged:t,stores:i,windowEnd:n.value.windowEnd})}))}sideCreated(t,e){const n=this.fetchInitial(t);this.mutate(t,(t=>null!==t.value.stores?(n.then((t=>{t.ok&&this.teardownNested(t.value)})),t):n))}sideDeleted(t,e){this.mutate(t,(e=>null===e.value.stores?e:(this.teardownNested(e.value),Ht({lastChanged:t,stores:null,inWindow:null,windowEnd:null}))))}async getParticipantFromCache(t){const e=await this.mostRecentState.resultPromise;if(!e.ok)return Yt("NOT_IN_CACHE");if(null===e.value.stores)return Yt("NOT_IN_CACHE");const n=e.value.stores[t];return void 0===n?Yt("NOT_IN_CACHE"):n.getFromCache()}}async function Re({cursor:t,realtimeClient:e,conversationId:n,count:s}){const i={limit:s,cursor:t},r=await e.call("GET",["me","conversations",n,"participants"],i,{bypassCache:!0});if(r.ok){const{data:t,cursor:e}=r.value.data;return Ht({participants:t,nextCursor:e})}return(r.ok||"server"!==r.where||404!==r.value.status)&&(r.ok||"server"!==r.where||403!==r.value.status||"NOT_A_PARTICIPANT"!==r.value.errorCode)?r:Ht({participants:null,nextCursor:null})}function Me({seq:t,prevStores:e,participants:n,cursor:s,conversationId:i,realtimeClient:r}){const o=e?Object.assign({},e):{};for(const t of n)if(void 0===o[t.id]){const e=new je(i,t,r);o[t.id]=e}if(null===s)return Ht({lastChanged:t,stores:o,windowEnd:null});return Ht({lastChanged:t,stores:o,windowEnd:{cursor:s,oldestParticipantTs:n[n.length-1].joinedAt}})}class $e extends Te{constructor(t,e,n,s){super(n,s),this.getConvDataStore=t,this.realtimeClient=e,this.unsubscribeDebounceMs=1e3,this.pendingLoadMore=void 0}async fetchInitial(t){const e=await Ue({realtimeClient:this.realtimeClient,count:20});return e.ok?null===e.value.conversations?Ht({lastChanged:t,stores:null,windowEnd:null}):Le({seq:t,conversations:e.value.conversations,cursor:e.value.nextCursor,getConvDataStore:this.getConvDataStore}):e}teardownNested(t){null!==t.stores&&Object.values(t.stores).forEach((t=>t.unsubscribe()))}async anyChildChanged(t,e,n){var s;for(const i in n.stores){const r=n.stores[i];if(!0===await(null===(s=null==r?void 0:r.store)||void 0===s?void 0:s.changedBetween(t,e)))return!0}return!1}equal(t,e){return null===t.stores&&null===e.stores||null!==t.stores&&null!==e.stores&&(!!we(Object.keys(t.stores),Object.keys(e.stores))&&we(t.windowEnd,e.windowEnd))}async loadNested(t,e){if(null===e.stores)return Ht({snapshot:[],loadedAll:!0});const n=await Promise.all(Object.values(e.stores).map((e=>e.store.getDeep(t)))),s=n.find((t=>!t.ok));if(s)return s;const i=n.filter((t=>null!==t.value.snapshot)).map((t=>t.value.snapshot));return i.sort(((t,e)=>{var n,s,i,r;const o=null!==(s=null===(n=t.lastMessage)||void 0===n?void 0:n.createdAt)&&void 0!==s?s:t.joinedAt;return(null!==(r=null===(i=e.lastMessage)||void 0===i?void 0:i.createdAt)&&void 0!==r?r:e.joinedAt)-o})),Ht({snapshot:i,loadedAll:null===e.windowEnd})}async loadMore(t){if(this.pendingLoadMore)return this.pendingLoadMore;const e=Object(W.b)();this.pendingLoadMore=e.promise,await this.On(t),e.resolve(),this.pendingLoadMore=void 0}async On(t=20){const e=await this.mostRecentState.resultPromise;if(!e.ok)return;if(null===e.value.windowEnd)return;const n=e.value.windowEnd.cursor,s=await Ue({count:t,cursor:n,realtimeClient:this.realtimeClient}),i=this.getLoadMoreSeq();this.mutate(i,(t=>null===t.value.windowEnd||n!==t.value.windowEnd.cursor?t:s.ok?null===s.value.conversations?(console.warn("[TalkJS] When loading more conversations, the user stopped existing, which should be impossible."),t):Le({seq:i,prevStores:t.value.stores,conversations:s.value.conversations,cursor:s.value.nextCursor,getConvDataStore:this.getConvDataStore}):s)),await this.emitMutex.runExclusive((()=>this.emit(i)))}async getConvFromCache(t){const e=await this.mostRecentState.resultPromise;if(!e.ok)return Yt("NOT_IN_CACHE");if(null===e.value.stores)return qt({status:404,errorCode:"USER_NOT_FOUND",reasons:["No user with that ID exists"]});const n=e.value.stores[t];return void 0===n?Yt("NOT_IN_CACHE"):n.store.getFromCache()}userCreated(t,e){this.mutate(t,(t=>null!==t.value.stores?t:Ht({lastChanged:t.value.lastChanged,stores:{},windowEnd:null})))}sideCreated(t,e){const n=this.getConvDataStore(e.state);this.mutate(t,(s=>Object.hasOwnProperty.call(s.value.stores,e.conversationId)?(n.unsubscribe(),s):Ht({lastChanged:t,stores:Object.assign(Object.assign({},s.value.stores),{[e.conversationId]:n}),windowEnd:s.value.windowEnd})))}sideDeleted(t,e){this.mutate(t,(n=>{var s;if(!Object.hasOwnProperty.call(n.value.stores,e.conversationId))return n;const i=Object.assign({},n.value.stores);return null===(s=i[e.conversationId])||void 0===s||s.unsubscribe(),delete i[e.conversationId],Ht({lastChanged:t,stores:i,windowEnd:n.value.windowEnd})}))}sideEdited(t,e){const n=e.diff.lastMessageAt;void 0!==n&&this.mutate(t,(s=>{var i;if(null===s.value.stores)return console.warn("[TalkJS] Received a 'side.edited' event when we thought your user didn't exist."),s;if(null===s.value.windowEnd)return s;const r=Object.hasOwnProperty.call(s.value.stores,e.conversationId);if(r&&n<s.value.windowEnd.oldestMessageTs){const n=Object.assign({},s.value.stores);return null===(i=n[e.conversationId])||void 0===i||i.unsubscribe(),delete n[e.conversationId],Ht({lastChanged:t,stores:n,windowEnd:s.value.windowEnd})}if(!r&&n>=s.value.windowEnd.oldestMessageTs){const n=this.getConvDataStore(e.conversationId);return Ht({lastChanged:t,stores:Object.assign(Object.assign({},s.value.stores),{[e.conversationId]:n}),windowEnd:s.value.windowEnd})}return s}))}}async function Ue({cursor:t,realtimeClient:e,count:n}){const s={limit:n,cursor:t},i=await e.call("GET",["me","conversations"],s,{bypassCache:!0});if(i.ok){const{data:t,cursor:e}=i.value.data;return Ht({conversations:t,nextCursor:e})}return i.ok||"server"!==i.where||404!==i.value.status||"USER_NOT_FOUND"!==i.value.errorCode?i:Ht({conversations:null,nextCursor:null})}function Le({seq:t,prevStores:e,conversations:n,cursor:s,getConvDataStore:i}){const r=e?Object.assign({},e):{};for(const t of n)void 0===r[t.id]&&(r[t.id]=i(t));if(null===s)return Ht({lastChanged:t,stores:r,windowEnd:null});return Ht({lastChanged:t,stores:r,windowEnd:{cursor:s,oldestMessageTs:Math.min(...n.map((t=>t.lastMessageAt)))}})}class Ge extends Te{get conversationId(){return"string"==typeof this.conversation?this.conversation:this.conversation.id}constructor(t,e,n,s){super(n,s),this.conversation=t,this.realtimeClient=e,this.unsubscribeDebounceMs=5e3}async fetchInitial(t){const e=this.realtimeClient.internalSubscribe(["me","conversations",this.conversationId,"messages"]);if("object"==typeof this.conversation)return Ht({lastChanged:t,snapshot:this.conversation,messageWindowStore:e});const n=await this.realtimeClient.call("GET",["me","conversations",this.conversationId],{},{bypassCache:!0});let s;if(n.ok)s=n.value.data;else if("server"===n.where&&404===n.value.status)s=null;else{if("server"!==n.where||403!==n.value.status||"NOT_A_PARTICIPANT"!==n.value.errorCode)return e.unsubscribe(),n;s=null}return Ht({lastChanged:t,snapshot:s,messageWindowStore:e})}teardownNested(t){var e;null===(e=t.messageWindowStore)||void 0===e||e.unsubscribe()}async anyChildChanged(t,e,n){return!0===await n.messageWindowStore.store.lastMessageChangedBetween(t,e)}equal(t,e){return we(t.snapshot,e.snapshot)}async loadNested(t,e){var n;if(!e.snapshot)return Ht({snapshot:null,loadedAll:!0});const s=await e.messageWindowStore.store.getDeep(t);if(!s.ok)return s;const i=s.value.snapshot,r=null!==(n=null==i?void 0:i[0])&&void 0!==n?n:null;return Ht({snapshot:Object.assign(Object.assign({},e.snapshot),{lastMessage:r})})}participantEdited(t,e){this.mutate(t,(n=>null===n.value.snapshot?(console.warn("[TalkJS] Received a 'participant.edited' event for a conversation that we thought didn't exist."),n):Ht({lastChanged:t,snapshot:Ke(n.value.snapshot,e.diff),messageWindowStore:n.value.messageWindowStore})))}conversationEdited(t,e){this.mutate(t,(n=>null===n.value.snapshot?(console.warn("[TalkJS] Received a 'conversation.edited' event for a conversation that we thought didn't exist."),n):Ht({lastChanged:t,snapshot:Ke(n.value.snapshot,e.diff),messageWindowStore:n.value.messageWindowStore})))}sideEdited(t,e){this.mutate(t,(n=>null===n.value.snapshot?(console.warn("[TalkJS] Received a 'side.edited' event for a conversation that we thought didn't exist."),n):Ht({lastChanged:t,snapshot:Ke(n.value.snapshot,e.diff),messageWindowStore:n.value.messageWindowStore})))}sideCreated(t,e){this.mutate(t,(n=>n.value.snapshot?n:Ht({lastChanged:t,snapshot:e.state,messageWindowStore:n.value.messageWindowStore})))}sideDeleted(t,e){this.mutate(t,(e=>null===e.value.snapshot?e:Ht({lastChanged:t,snapshot:null,messageWindowStore:e.value.messageWindowStore})))}async getFromCache(){const t=await this.mostRecentState.resultPromise;return t.ok&&t.value.snapshot?Ht({status:200,data:t.value.snapshot}):Yt("NOT_IN_CACHE")}}function Ke(t,e){const n=e;return{id:t.id,createdAt:t.createdAt,subject:be(t.subject,n.subject),photoUrl:be(t.photoUrl,n.photoUrl),welcomeMessages:be(t.welcomeMessages,n.welcomeMessages),custom:Ae(t.custom,n.custom),lastMessageAt:be(t.lastMessageAt,n.lastMessageAt),unreadMessageCount:be(t.unreadMessageCount,n.unreadMessageCount),isUnread:be(t.isUnread,n.isUnread),access:be(t.access,n.access),notify:be(t.notify,n.notify),readUntil:be(t.readUntil,n.readUntil),everyoneReadUntil:be(t.everyoneReadUntil,n.everyoneReadUntil),joinedAt:t.joinedAt}}class Je{get seq(){return this.seqOffset+this.seqInThisConnection}constructor(t,e,n){this.realtimeClient=n,this.convDataStores={},this.storeMap={},this.emitMutex=new Ee,this.seqOffset=0,this.seqInThisConnection=0,this.refetchOnNextNetworkLoss=!0,this.connection=new ve(t,e,{onUpstreamRestarting:()=>{this.refetchOnNextNetworkLoss=!1},onReady:()=>{this.refetchOnNextNetworkLoss=!0},onResubscribeSent:()=>{if(this.seqOffset+=this.seq,this.seqInThisConnection=0,this.refetchOnNextNetworkLoss){this.seqOffset++;const t=this.seq;this.refetchAll(t),this.emitAll(t)}},onResubscribeError:(t,e)=>{var n;null===(n=this.storeMap[ze(t)])||void 0===n||n.setError(e)},onPublish:(t,e)=>{this.seqInThisConnection=t;const n=this.seq;for(const t of e)this.handlePublish(n,t);this.emitAll(n)}})}refetchAll(t){Object.values(this.storeMap).forEach((e=>null==e?void 0:e.refetch(t)))}emitAll(t){return this.emitMutex.runExclusive((async()=>{const e=Object.values(this.storeMap).map((e=>null==e?void 0:e.emit(t)));await Promise.all(e)}))}handlePublish(t,e){var n,s,i,r,o,a,u,c,h,l,d,f,p,m,g,v,b,A,w,E,O,T,y,C,S;switch(e.type){case"user.created":return null===(n=this.storeMap[`/users/${e.userId}`])||void 0===n||n.userCreated(t,e),void(null===(s=this.storeMap["/me/conversations"])||void 0===s||s.userCreated(t,e));case"user.edited":return void(null===(i=this.storeMap[`/users/${e.userId}`])||void 0===i||i.userEdited(t,e));case"side.created":return null===(r=this.convDataStores[e.conversationId])||void 0===r||r.sideCreated(t,e),null===(o=this.storeMap[`/me/conversations/${e.conversationId}/messages`])||void 0===o||o.sideCreated(t,e),null===(a=this.storeMap[`/me/conversations/${e.conversationId}/participants`])||void 0===a||a.sideCreated(t,e),void(null===(u=this.storeMap["/me/conversations"])||void 0===u||u.sideCreated(t,e));case"side.edited":return null===(c=this.convDataStores[e.conversationId])||void 0===c||c.sideEdited(t,e),void(null===(h=this.storeMap["/me/conversations"])||void 0===h||h.sideEdited(t,e));case"side.deleted":return null===(l=this.convDataStores[e.conversationId])||void 0===l||l.sideDeleted(t,e),null===(d=this.storeMap[`/me/conversations/${e.conversationId}/messages`])||void 0===d||d.sideDeleted(t,e),null===(f=this.storeMap[`/me/conversations/${e.conversationId}/participants`])||void 0===f||f.sideDeleted(t,e),null===(p=this.storeMap[`/me/conversations/${e.conversationId}/typing`])||void 0===p||p.sideDeleted(t,e),void(null===(m=this.storeMap["/me/conversations"])||void 0===m||m.sideDeleted(t,e));case"conversation.edited":return void(null===(g=this.convDataStores[e.conversationId])||void 0===g||g.conversationEdited(t,e));case"message.created":return void(null===(v=this.storeMap[`/me/conversations/${e.conversationId}/messages`])||void 0===v||v.messageCreated(t,e));case"message.edited":return void(null===(b=this.storeMap[`/me/conversations/${e.conversationId}/messages`])||void 0===b||b.messageEdited(t,e));case"message.deleted":return void(null===(A=this.storeMap[`/me/conversations/${e.conversationId}/messages`])||void 0===A||A.messageDeleted(t,e));case"typing.available":return void(null===(w=this.storeMap[`/me/conversations/${e.conversationId}/typing`])||void 0===w||w.typingAvailable(t,e));case"typing.changed":return void(null===(E=this.storeMap[`/me/conversations/${e.conversationId}/typing`])||void 0===E||E.typingChanged(t,e));case"conversation.cleared":return void(null===(O=this.storeMap[`/me/conversations/${e.conversationId}/messages`])||void 0===O||O.conversationCleared(t,e));case"participant.edited":return null===(T=this.convDataStores[e.conversationId])||void 0===T||T.participantEdited(t,e),void(null===(y=this.storeMap[`/me/conversations/${e.conversationId}/participants`])||void 0===y||y.participantEdited(t,e));case"participant.created":return void(null===(C=this.storeMap[`/me/conversations/${e.conversationId}/participants`])||void 0===C||C.participantCreated(t,e));case"participant.deleted":return void(null===(S=this.storeMap[`/me/conversations/${e.conversationId}/participants`])||void 0===S||S.participantDeleted(t,e))}}async call(t,e,n,s){if(!s.bypassCache&&"GET"===t){const t=ze(e);if(t in this.storeMap){const e=t,n=this.storeMap[e];if(n&&"getFromCache"in n){const t=await n.getFromCache();if("NOT_IN_CACHE"!==t.value)return t}}else if(Jt(e,["me","conversations","*","messages","*"])){const t=this.storeMap[`/me/conversations/${e[2]}/messages`];if(t){const n=await t.getMessageFromCache(e[4]);if("NOT_IN_CACHE"!==n.value)return n}}else if(Jt(e,["me","conversations","*","participants","*"])){const t=this.storeMap[`/me/conversations/${e[2]}/participants`];if(t){const n=await t.getParticipantFromCache(e[4]);if("NOT_IN_CACHE"!==n.value)return n}}else if(Jt(e,["me","conversations","*"])){const t=this.storeMap["/me/conversations"];if(t){const n=await t.getConvFromCache(e[2]);if("NOT_IN_CACHE"!==n.value)return n}}}return this.connection.call(t,e,n)}subscribe(t,e){const n=this.getOrCreateStore(t),s=Object(W.b)(),i=Object(W.b)();s.promise.catch((()=>{})),i.promise.catch((()=>{}));const r={state:{type:"pending",latestSnapshot:void 0},connected:s.promise,terminated:i.promise,loadMore:async t=>{"loadMore"in n&&await n.loadMore(t)},unsubscribe:()=>{}},o=n.listen((n=>{if(n.ok){const t=!("loadedAll"in n.value)||n.value.loadedAll,i={type:"active",latestSnapshot:n.value.snapshot,loadedAll:t};r.state=i,null==e||e(n.value.snapshot,t),s.resolve(i)}else if("pending"===r.state.type||"active"===r.state.type){if("server"===n.where){const e={type:"error",error:new Error(Kt(`Subscribe to ${t.join("/")}`,n.value))};return r.state=e,i.resolve(e),void s.reject("Subscription encountered an error during initial connection")}if("SESSION_DESTROYED"===n.value){const t={type:"error",error:new Error("Session was destroyed causing all subscriptions to be terminated")};return r.state=t,i.resolve(t),void s.reject("Subscription encountered an error during initial connection")}if("UNSUBSCRIBED"===n.value)return;if("TERMINATED"===n.value)return;n.value}}));return r.unsubscribe=()=>{if("pending"===r.state.type||"active"===r.state.type){o();const t={type:"unsubscribed"};r.state=t,i.resolve(t),s.reject("Subscription was unsubscribed before connecting")}},r}getOrCreateStore(t){const e=ze(t);if(e in this.storeMap)return this.storeMap[e];this.connection.subscribe(t).then((t=>{t.ok||n.setError(t)}));const n=this.instantiateStore(t,(()=>{delete this.storeMap[e],this.connection.unsubscribe(t)}));return this.storeMap[e]=n,n}destroy(){this.storeMap={},this.convDataStores={},this.connection.destroy()}isConnected(){return this.connection.isConnected()}instantiateStore(t,e){if(Jt(t,["users","*"]))return new Ce(t[1],this.realtimeClient,this.emitMutex,e);if(Jt(t,["me","conversations","*"]))return new Fe(this.subscribeConvData(t[2]),this.realtimeClient,this.emitMutex,e);if(Jt(t,["me","conversations","*","messages"]))return new _e(t[2],this.realtimeClient,this.emitMutex,e);if(Jt(t,["me","conversations","*","participants"]))return new Be(t[2],this.realtimeClient,this.emitMutex,e);if(Jt(t,["me","conversations","*","typing"]))return new Pe(t[2],this.realtimeClient,this.emitMutex,e);if(Jt(t,["me","conversations"]))return new $e((t=>this.subscribeConvData(t)),this.realtimeClient,this.emitMutex,e);throw"Unreachable"}subscribeConvData(t){const e="string"==typeof t?t:t.id;if(Object.hasOwnProperty.call(this.convDataStores,e)){const t=this.convDataStores[e];return{store:t,unsubscribe:t.registerInternalSubscription()}}const n=new Ge(t,this.realtimeClient,this.emitMutex,(()=>{delete this.convDataStores[e]}));return this.convDataStores[e]=n,{store:n,unsubscribe:n.registerInternalSubscription()}}}function ze(t){return`/${t.join("/")}`}class He{constructor(t,e,n){this.userId=e,this.alive=!0,this.connection=new Je(t,n,this),n.onTokenRefreshFailed((()=>{this.destroy()}))}async call(t,e,n,s={}){return this.alive?this.connection.call(t,e,n,s):Yt("SESSION_DESTROYED")}subscribe(t,e){return this.connection.subscribe(t,e)}internalSubscribe(t){const e=this.connection.getOrCreateStore(t);return{store:e,unsubscribe:e.registerInternalSubscription()}}destroy(){this.alive=!1,this.connection.destroy()}isConnected(){return this.connection.isConnected()}async listMessages(t,e){const n=await this.call("GET",["me","conversations",t,"messages"],e);if(!n.ok)return Ye(n,"Listing messages in "+t);const s=n.value.data.data,i=await Promise.all(s.map((e=>this.createMessageSnapshot(e,t)))),r=i.find((t=>!t.ok));if(void 0!==r&&!r.ok)return r;return Ht(i.map((({value:t})=>t)))}createConversationSnapshotPreloaded(t,e){return{id:t.id,subject:t.subject,photoUrl:t.photoUrl,welcomeMessages:t.welcomeMessages,custom:t.custom,createdAt:t.createdAt,joinedAt:t.joinedAt,lastMessageAt:t.lastMessageAt,unreadMessageCount:t.unreadMessageCount,isUnread:t.isUnread,access:t.access,notify:t.notify,lastMessage:e,readUntil:t.readUntil,everyoneReadUntil:t.everyoneReadUntil}}createUserSnapshot(t){return{id:t.id,name:t.name,custom:t.custom,locale:t.locale,photoUrl:t.photoUrl,role:t.role,welcomeMessage:t.welcomeMessage}}createParticipantSnapshotPreloaded(t,e){return{user:e,access:t.access,notify:t.notify,joinedAt:t.joinedAt}}async createMessageSnapshot(t,e){const n=null===t.senderId?Promise.resolve(Ht(null)):this.getUser(t.senderId),s=null===t.referencedMessageId?Promise.resolve(Ht(null)):this.getReferencedMessage(e,t.referencedMessageId),i=await n;if(!i.ok)return i;const r=await s;if(!r.ok)return r;return Ht(this.createMessageSnapshotPreloaded(t,i.value,r.value))}async getReferencedMessage(t,e){const n=await this.call("GET",["me","conversations",t,"messages",e],{});if(!n.ok&&"server"===n.where&&404===n.value.status)return Ht(null);if(!n.ok&&"server"===n.where&&403===n.value.status&&"NOT_A_PARTICIPANT"===n.value.errorCode)return Ht(null);if(!n.ok)return Ye(n,`Fetching referenced message ${e} in conversation ${t}`);const s=n.value.data,i=await this.getUser(s.senderId);if(!i.ok)return i;const r=i.value;return Ht(this.createReferencedMessageSnapshotPreloaded(s,r))}async getUser(t){const e=await this.call("GET",["users",t],{includePrivateFields:!1});if(!e.ok&&"server"===e.where&&404===e.value.status)return Ht(null);if(!e.ok)return Ye(e,"Get user "+t);return Ht(this.createUserSnapshot(e.value.data))}createMessageSnapshotPreloaded(t,e,n){return{id:t.id,type:t.type,sender:e,referencedMessage:n,custom:t.custom,createdAt:t.createdAt,editedAt:t.editedAt,origin:t.origin,content:t.content,plaintext:Object(Se.a)(t.content,{})}}createReferencedMessageSnapshotPreloaded(t,e){return{id:t.id,type:t.type,sender:e,referencedMessageId:t.referencedMessageId,custom:t.custom,createdAt:t.createdAt,editedAt:t.editedAt,origin:t.origin,content:t.content,plaintext:Object(Se.a)(t.content,{})}}}function Ye(t,e){return"server"===t.where?qt(Object.assign(Object.assign({},t.value),{operation:e})):t}function qe(t,e){var n;if(e.ok)return e.value;throw"SESSION_DESTROYED"===e.value?new Error(`${t} failed because the session was destroyed`):new Error(Kt(null!==(n=e.value.operation)&&void 0!==n?n:t,e.value))}class We{get brandedId(){return this.id}constructor(t,e){this.id=t,this.Tn=e}async get(){const t=await this.Tn.getUser(this.brandedId);return qe("Get user "+this.id,t)}async set(t){null===t.role&&(t.role="default");const e="string"==typeof t.email?[t.email]:t.email,n="string"==typeof t.phone?[t.phone]:t.phone,s=await this.Tn.call("PUT",["users",this.brandedId],Object.assign(Object.assign({},t),{email:e,phone:n}));Gt("Set user "+this.id,s)}async createIfNotExists(t){void 0===t.role&&(t.role="default");const e="string"==typeof t.email?[t.email]:t.email,n="string"==typeof t.phone?[t.phone]:t.phone,s=await this.Tn.call("POST",["users",this.brandedId],Object.assign(Object.assign({},t),{email:e,phone:n}));(s.ok||"server"!==s.where||409!=s.value.status)&&Gt(`Create user ${this.id} if not exists`,s)}subscribe(t){return this.Tn.subscribe(["users",this.brandedId],t)}}class Ve{get brandedUserId(){return this.userId}get brandedConversationId(){return this.conversationId}constructor(t,e,n){this.userId=t,this.conversationId=e,this.Tn=n}async get(){const t=await this.Tn.call("GET",["me","conversations",this.brandedConversationId,"participants",this.brandedUserId],{}),e=await this.Tn.call("GET",["users",this.brandedUserId],{includePrivateFields:!1}),[n,s]=await Promise.all([t,e]);if(!n.ok&&"server"===n.where&&404===n.value.status)return null;if(!s.ok&&"server"===s.where&&404===s.value.status)return null;const i=Gt(`Get participant ${this.userId} in conversation ${this.conversationId}`,n),r=Gt(`Get user ${this.userId}`,s),o=this.Tn.createUserSnapshot(r);return this.Tn.createParticipantSnapshotPreloaded(i,o)}async set(t={}){const e=await this.Tn.call("PUT",["conversations",this.brandedConversationId,"participants",this.brandedUserId],t);Gt(`Set participant ${this.userId} in conversation ${this.conversationId}`,e)}async edit(t={}){const e=await this.Tn.call("PATCH",["conversations",this.brandedConversationId,"participants",this.brandedUserId],t);Gt(`Edit participant ${this.userId} in conversation ${this.conversationId}`,e)}async createIfNotExists(t={}){const e=await this.Tn.call("POST",["conversations",this.brandedConversationId,"participants",this.brandedUserId],t);(e.ok||"server"!==e.where||409!==e.value.status)&&Gt(`Add participant ${this.userId} to conversation ${this.conversationId}`,e)}async delete(){const t=await this.Tn.call("DELETE",["conversations",this.brandedConversationId,"participants",this.brandedUserId],{});(t.ok||"server"!==t.where||404!==t.value.status)&&Gt(`Remove participant ${this.userId} from conversation ${this.conversationId}`,t)}}var Ze=n(26);class Xe{get brandedId(){return this.id}get brandedConversationId(){return this.conversationId}constructor(t,e,n){this.id=t,this.conversationId=e,this.Tn=n}async get(){const t=await this.Tn.call("GET",["me","conversations",this.brandedConversationId,"messages",this.brandedId],{});if(!t.ok&&"server"===t.where&&404===t.value.status)return null;if(!t.ok&&"server"===t.where&&403===t.value.status&&"NOT_A_PARTICIPANT"===t.value.errorCode)return null;const e=Gt("Get message "+this.id,t),n=await this.Tn.createMessageSnapshot(e,this.brandedConversationId);return qe("Get message "+this.id,n)}async edit(t){const e={content:Qe(t),custom:"string"==typeof t?void 0:t.custom},n=await this.Tn.call("PATCH",["conversations",this.brandedConversationId,"messages",this.brandedId],e);Gt(`Edit message ${this.id} in conversation ${this.conversationId}`,n)}async delete(){const t=await this.Tn.call("DELETE",["conversations",this.brandedConversationId,"messages",this.brandedId],{});(t.ok||"server"!==t.where||404!==t.value.status)&&Gt(`Delete message ${this.id} in conversation ${this.conversationId}`,t)}}function Qe(t){if("string"==typeof t){const e=t;return[{type:"text",children:Object(Ze.a)(e)}]}if("text"in t&&t.text){const e=t.text;return[{type:"text",children:Object(Ze.a)(e)}]}if("content"in t&&t.content)return t.content}class tn{get brandedId(){return this.id}get brandedUserId(){return this.Tn.userId}constructor(t,e){this.id=t,this.Tn=e,this.uselessObjForTypeCheck={subject:null,photoUrl:null,welcomeMessages:null,custom:null,access:null,notify:null}}participant(t){return new Ve("string"==typeof t?t:t.id,this.id,this.Tn)}message(t){return new Xe(t,this.brandedId,this.Tn)}async get(){const t=this.Tn.listMessages(this.brandedId,{limit:1}),e=await this.Tn.call("GET",["me","conversations",this.brandedId],{});if(!e.ok&&"server"===e.where&&404===e.value.status)return null;const n=Gt("Get conversation "+this.id,e),s=qe("Get last message in conversation "+this.id,await t),i=0===s.length?null:s[0];return this.Tn.createConversationSnapshotPreloaded(n,i)}async set(t){const e=this.Tn.call("PUT",["conversations",this.brandedId],t),n=this.Tn.call("PUT",["conversations",this.brandedId,"participants",this.brandedUserId],t),s=await e;!s.ok&&"server"===s.where&&403===s.value.status&&"UNAUTHORIZED_TO_EDIT"===s.value.errorCode&&function(t){if(void 0!==t.subject)return!1;if(void 0!==t.photoUrl)return!1;if(void 0!==t.welcomeMessages)return!1;if(null===t.custom)return!1;if(void 0!==t.custom&&Object.values(t.custom).some((t=>void 0!==t)))return!1;return!0}(t)||Gt("Set conversation "+this.id,s);const i=await n;!i.ok&&"server"===i.where&&403===i.value.status&&"UNAUTHORIZED_TO_EDIT_PARTICIPANT"===i.value.errorCode&&function(t){return void 0===t.access&&void 0===t.notify}(t)||Gt("Set your participation in conversation "+this.id,i)}async createIfNotExists(t={}){const e=this.Tn.call("POST",["conversations",this.brandedId],t),n=this.Tn.call("POST",["conversations",this.brandedId,"participants",this.brandedUserId],t),s=await e;(s.ok||"server"!==s.where||409!==s.value.status)&&Gt("Create conversation "+this.id,await e);const i=await n;(i.ok||"server"!==i.where||409!==i.value.status)&&Gt("Join conversation "+this.id,await n)}async markAsRead(){const t=await this.Tn.call("POST",["me","conversations",this.brandedId,"read"],{});Gt(`Mark ${this.id} as read`,t)}async markAsUnread(){const t=await this.Tn.call("POST",["me","conversations",this.brandedId,"unread"],{});Gt(`Mark ${this.id} as unread`,t)}async send(t){const e={content:en(t),referencedMessageId:nn(t),custom:"string"==typeof t?void 0:t.custom,idempotencyKey:Object(et.a)((new Date).getTime())},n=await this.Tn.call("POST",["conversations",this.brandedId,"messages"],e),s=Gt("Send message to conversation "+this.id,n);return new Xe(s.id,this.brandedId,this.Tn)}subscribeMessages(t){return this.Tn.subscribe(["me","conversations",this.brandedId,"messages"],t)}subscribeParticipants(t){return this.Tn.subscribe(["me","conversations",this.brandedId,"participants"],t)}subscribe(t){return this.Tn.subscribe(["me","conversations",this.brandedId],t)}subscribeTyping(t){return this.Tn.subscribe(["me","conversations",this.brandedId,"typing"],t)}async markAsTyping(){const t=await this.Tn.call("POST",["me","conversations",this.brandedId,"typing"],{});Gt(`Set user as typing in  ${this.id}`,t)}}function en(t){if("string"==typeof t){const e=t;return[{type:"text",children:Object(Ze.a)(e)}]}if("text"in t){const e=t.text;return[{type:"text",children:Object(Ze.a)(e)}]}return t.content}function nn(t){if("string"==typeof t)return;const e=t.referencedMessage;return void 0!==e?"string"==typeof e?e:e.id:void 0}class sn{get canRefreshToken(){return this.usingBokens||!!this.tokenFetcher}constructor(t,e,n,s,i,r){if(this.appId=e,this.userId=n,this.tokenFetcher=i,this.usingBokens=!1,this.requestInProgress=!1,this.eventEmitter=new z.a({tokenChanged(t){},tokenRefreshFailed(t){},tokenAccepted(t){}}),this.sessionExpiryWarningTimeoutId=void 0,r&&(s||i))throw new Error("[TalkJS] If providing a signature for authentication, you must not provide a token or tokenFetcher.");s?this.fetchToken((()=>s)):(i||(this.usingBokens=!0,this.tokenFetcher=()=>this.sendBokenRequest(t,r)),this.refreshToken())}getToken(){return this.token}refreshToken(){if(!this.requestInProgress){if(!this.tokenFetcher)throw this.emitTokenRefreshFailed("no `tokenFetcher` provided"),new Error("[TalkJS] Cannot refresh token, no `tokenFetcher` provided.");this.fetchToken(this.tokenFetcher)}}onTokenChanged(t){return this.eventEmitter.on("tokenChanged",t),()=>{this.eventEmitter.off("tokenChanged",t)}}emitTokenChanged(t){this.eventEmitter.emit("tokenChanged",t)}onTokenRefreshFailed(t){return this.eventEmitter.on("tokenRefreshFailed",t),()=>{this.eventEmitter.off("tokenRefreshFailed",t)}}emitTokenRefreshFailed(t){this.eventEmitter.emit("tokenRefreshFailed",t),console.error(`[TalkJS] Could not authenticate, cannot recover automatically: ${t}`)}onTokenAccepted(t){return this.eventEmitter.on("tokenAccepted",t),()=>{this.eventEmitter.off("tokenAccepted",t)}}emitTokenAccepted(t){this.eventEmitter.emit("tokenAccepted",t)}clearScheduledRefresh(){this.sessionExpiryWarningTimeoutId&&clearTimeout(this.sessionExpiryWarningTimeoutId)}scheduleRefresh(t){if(this.clearScheduledRefresh(),null===t)return;const e=void 0!==this.tokenFetcher;t<120&&!e?console.warn(`[TalkJS] TalkJS will stop working in ${t} seconds due to auth token expiry. Token expires in ${t} seconds, and cannot be refreshed because no \`tokenFetcher\` was provided when creating the session. Non-refreshable tokens are recommended to expire at least 24 hours in the future.`):t<120&&e?console.warn(`[TalkJS] TalkJS auth token will expire and need to be refreshed in ${t} seconds. Refreshable JWTs are recommended to expire at least 30 minutes in the future, to improve performance and reduce unnecessary refreshes.`):t<3300&&!e&&console.warn(`[TalkJS debug] TalkJS will stop working in ${Math.round(t/60)} minutes due to auth token expiry. Non-refreshable tokens are recommended to expire at least 24 hours in the future. Alternatively, provide a \`tokenFetcher\` when creating the session, so that tokens can be refreshed when they expire.`);if(void 0!==this.tokenFetcher){const e=t>600?t-300:t/2,n=Math.min(1728e6,1e3*e);this.sessionExpiryWarningTimeoutId=setTimeout((()=>{this.refreshToken()}),n)}else t<2e6&&(this.sessionExpiryWarningTimeoutId=setTimeout((()=>{this.emitTokenRefreshFailed("Token has expired and no `tokenFetcher` was provided when creating the session, so it cannot be refreshed.")}),1e3*t))}async fetchToken(t){if(this.requestInProgress)return;this.requestInProgress=!0;const e=async()=>{const e=await t();return this.checkJwt(e),e};try{const t=void 0!==this.token;this.token=e(),await this.token.then((e=>{t&&this.emitTokenChanged(e)})).catch((t=>{this.emitTokenRefreshFailed(t)}))}catch(t){this.emitTokenRefreshFailed(t)}finally{this.requestInProgress=!1}}checkJwt(t){!function(t){if("string"==typeof t||t instanceof String)return;if(void 0===t)throw"Token was undefined";throw"Token must be a string, got: "+t}(t);const e=[];let n,s,i;if("string"==typeof t?n=t:e.push(`Token type is ${typeof t} instead of a string.`),n)try{const t=function(t){const e=t.split(".");if(3!==e.length)throw"Token does not contain exactly two `.`. Check that you generated your JWT correctly. It should be `<header>.<payload>.<signature>`.";return{header:rn(e[0]),payload:rn(e[1])}}(n);s=t.header,i=t.payload}catch(t){e.push(t)}if(s){const t=this.checkJwtHeader(s);e.push(...t)}if(i){const t=this.checkJwtPayload(i);e.push(...t)}if(e.length)if(this.usingBokens)Q.log(`JWT Errors detected by AuthProvider when using bokens: ${e.join("\n")}`);else{console.warn("[TalkJS] Authentication token appears to be generated incorrectly. Will still attempt to authenticate, but TalkJS may not work as expected. See below for a description of any problems and how to fix them.");const n=e.length>1;e.forEach(((t,e)=>{const s=n?`Reason ${e+1}:`:"Reason:";console.warn(`[TalkJS] ${s} ${t}`)})),console.warn(`[TalkJS]: Authentication token: "${t}"`)}}checkJwtHeader(t){const e=[],n=t.alg;return void 0===n?e.push('Token header must contain `"alg": "HS256"`, but no `alg` was specified.'):"string"!=typeof n?e.push(`Token header must contain \`"alg": "HS256"\`, but \`alg\` was ${typeof n} instead of a string. Make sure you wrap the value in "".`):"HS256"!==n&&e.push(`Token header must contain \`"alg": "HS256"\`, but \`alg\` was set to "${n}" instead. HS256 is the only supported algorithm.`),e}checkJwtPayload(t){const e=[],n=t.iss;void 0===n?e.push(`Token payload must contain an \`iss\` claim set to your app ID (${this.appId}), but \`iss\` was missing.`):"string"!=typeof n?e.push(`Token payload must contain an \`iss\` claim set to your app ID (${this.appId}), but \`iss\` was ${typeof n} instead of a string. Make sure you wrap the value in "".`):n!==this.appId&&e.push(`Token payload must contain an \`iss\` claim set to your app ID (${this.appId}), but \`iss\` was set to "${n}" instead.`);const s=t.sub;void 0===s?e.push(`Token payload must contain a \`sub\` claim set to your user ID (${this.userId}), but \`sub\` was missing.`):"string"!=typeof s?e.push(`Token payload must contain a \`sub\` claim set to your user ID (${this.userId}), but \`sub\` was ${typeof s} instead of a string. Make sure you wrap the value in "".`):s!==this.userId&&e.push(`Token payload must contain a \`sub\` claim set to your userId ID (${this.userId}), but \`sub\` was set to "${s}" instead.`);const i=t.tokenType;void 0===i?e.push('Token payload must contain a `"tokenType": "user"` claim, but no `tokenType` was specified.'):"string"!=typeof i?e.push(`Token payload must contain a \`"tokenType": "user"\` claim, but \`tokenType\` was ${typeof i} instead of a string. Make sure you wrap the value in "".`):"user"!==i&&e.push(`Token payload must contain a \`"tokenType": "user"\` claim, but \`tokenType\` was set to "${i}" instead.`);const r=t.exp;void 0===r||("number"!=typeof r?e.push(`Token payload contains an \`exp\` claim, but \`exp\` was ${typeof i} instead of a number. If set, \`exp\` should be the expiry date as a number of seconds since 1970-01-01. Don't wrap the value in "".`):r<1e9?e.push(`Token payload contains an \`exp\` claim, but \`exp\` is very small (${r}, representing ${new Date(1e3*r).toLocaleDateString()}). If set, \`exp\` should be the expiry date as a number of seconds since 1970-01-01.`):r>1e11?e.push(`Token payload contains an \`exp\` claim, but \`exp\` is very small (${r}, representing ${new Date(1e3*r).toLocaleDateString()}). If set, \`exp\` should be the expiry date as a number of seconds since 1970-01-01. Double-check that you are using seconds and not milliseconds or nanoseconds.`):r<(new Date).getTime()/1e3&&e.push(`Token payload contains an \`exp\` claim, but \`exp\` (${r}, representing ${new Date(1e3*r).toLocaleDateString()}) appears to be in the past, meaning the token will be rejected. This error can also happen if your device's clock is set incorrectly, in which case the token will still work.`));const o=t.nbf;return void 0===o||("number"!=typeof o?e.push(`Token payload contains a \`nbf\` (not-before) claim, but \`nbf\` was ${typeof i} instead of a number. If set, \`nbf\` should be the date when the JWT becomes valid, as a number of seconds since 1970-01-01.`):o>1e11&&e.push(`Token payload contains a \`nbf\` (not-before) claim, but \`nbf\` is very large (${o}, representing ${new Date(1e3*o).toLocaleDateString()}). If set, \`nbf\` should be the date when the JWT becomes valid, as a number of seconds since 1970-01-01. Double-check that you are using seconds and not milliseconds or nanoseconds.`)),e}async sendBokenRequest(t,e){let n=0;const s=t.getBokensUrl(this.appId,this.userId,e),i=await tt({method:"GET",url:s,attempts:1e4,shouldRetry:t=>{if(t instanceof Error)return!0;if(401===t.status)throw"Check that you provided a valid signature.";if(404===t.status)throw"Check that you specified the correct App ID.";if(429===t.status||502===t.status)return!0;if(t.status>=400&&t.status<500)throw`Unexpected HTTP ${t.status} response when fetching auth token. Check that you configured the session correctly.`;if(n++,n>=5)throw`Unexpected HTTP ${t.status} response when fetching auth token, retrying did not help.`;return!0}});return(await i.json()).boken}}function rn(t){try{const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(e).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join(""));return JSON.parse(n)}catch(e){throw`Could not base64-decode and JSON-parse token section: ${t}. Check that you base-64 encoded the section correctly.`}}const on=new Lt("wss://realtime.talkjs.com/v1","https://app.talkjs.com/api/v0","https://api.talkjs.com/v1");class an{constructor(t){this.target=t}deref(){return this.target}}const un=new class{constructor(){this.registry={}}getOrCreate(t){var e;const n=this.key(t),s=null===(e=this.registry[n])||void 0===e?void 0:e.deref();if(s)return s;const i=new cn(t),r=globalThis.WeakRef?new WeakRef(i):new an(i);return this.registry[n]=r,i}deregister(t,e){const n=this.key({appId:t,userId:e});delete this.registry[n]}key({appId:t,userId:e}){return`${t}:${e}`}};class cn{constructor(t){!function(t){function e(t,e){if(!t)throw new Error("[TalkJS] TalkSession: "+e)}e(t&&"object"==typeof t,"Expected an object argument in TalkSession#constructor."),e(t.appId&&"string"==typeof t.appId,"The `appId` property of TalkSession#constructor is required and it must be a non-empty string."),e("string"==typeof t.userId,"The `userId` property of TalkSession#constructor is required and it must be a string."),void 0!==t.token&&e(t.token&&"string"==typeof t.token,"The `token` property of TalkSession#constructor must be a non-empty string.");void 0!==t.tokenFetcher&&e("function"==typeof t.tokenFetcher,"The `tokenFetcher` property of TalkSession#constructor must be a function.")}(t);const{appId:e,userId:n,token:s,tokenFetcher:i,signature:r}=t;this.Ot=e,this.yn=t.apiUrls?new Lt(t.apiUrls.realtimeWsApiUrl,t.apiUrls.internalHttpApiUrl,t.apiUrls.restApiHttpUrl):on,this.Vt=new sn(this.yn,e,n,s,i,r);const o=Math.random().toString().split(".")[1];this.Tn=new He(this.yn.getRealtimeWsUrl(e,n,"1.3.0",o,t.clientBuild),n,this.Vt),this.currentUser=new We(this.Tn.userId,this.Tn),this.Cn=Object(W.b)(),this.Cn.promise.then((t=>{console.error(`[TalkSession] ${t}`)})),async function(t,e,n){return tt({method:"GET",url:`${e}/${t}/app`,authProvider:n}).then((t=>200===t.status||404!==t.status&&(console.warn(`[TalkJS] Received unexpected ${t.status} status code when validating app ID. Assuming that the app ID is valid.`),!0))).catch((t=>{if("string"!=typeof t&&"status"in t){const e=t;return 200===e.status||404!==e.status&&(console.warn(`[TalkJS] Received unexpected ${e.status} status code when validating app ID. Assuming that the app ID is valid.`),!0)}return console.warn("[TalkJS] Encountered network issues when validating app ID. Assuming that the app ID is valid."),!0}))}(this.Ot,this.yn.internalHttpApiUrl,this.Vt).then((t=>{t||this.terminate(new Error(`The app ID ${this.Ot} does not exist. Make sure you are using the correct app ID as found on the TalkJS dashboard. App IDs are case-sensitive.`))})),this.Vt.onTokenRefreshFailed((t=>{this.terminate(new Error(`Could not authenticate, cannot recover automatically: ${t}`))}))}onError(t){const e=Object(W.b)();return Promise.race([e.promise,this.Cn.promise]).then((e=>{"UNSUBSCRIBED"!==e&&t(e)})),{unsubscribe:()=>e.resolve("UNSUBSCRIBED")}}user(t){return new We(t,this.Tn)}conversation(t){return new tn(t,this.Tn)}subscribeConversations(t){return this.Tn.subscribe(["me","conversations"],t)}terminate(t){un.deregister(this.Ot,this.currentUser.id),this.Cn.resolve(t),this.Tn.destroy()}Sn(){return this.Tn.isConnected()}uploadFile(t,e){return hn(`${this.yn.restApiHttpUrl}/${this.Ot}/files`,this.Vt,t,e)}uploadImage(t,e){return hn(`${this.yn.restApiHttpUrl}/${this.Ot}/files`,this.Vt,t,Object.assign({subtype:"image"},e))}uploadVideo(t,e){return hn(`${this.yn.restApiHttpUrl}/${this.Ot}/files`,this.Vt,t,Object.assign({subtype:"video"},e))}uploadAudio(t,e){return hn(`${this.yn.restApiHttpUrl}/${this.Ot}/files`,this.Vt,t,Object.assign({subtype:"audio"},e))}uploadVoice(t,e){return hn(`${this.yn.restApiHttpUrl}/${this.Ot}/files`,this.Vt,t,Object.assign({subtype:"voice"},e))}}async function hn(t,e,n,{subtype:s,filename:i,width:r,height:o,duration:a}){const u=new FormData;return u.set("file",n,i),void 0!==s&&u.set("subtype",s),void 0!==r&&u.set("width",r.toString()),void 0!==o&&u.set("height",o.toString()),void 0!==a&&u.set("duration",a.toString()),tt({method:"POST",url:t,data:u,authProvider:e}).then((t=>t.json())).then((t=>t.attachmentToken)).catch((async t=>{if(t instanceof Response){const e=await t.json(),n=`Unexpected response when uploading file, status code ${t.status} ${e.errorCode}, ${e.reasons}`;throw new Error(n)}throw t}))}const ln=new Lt(`${i.c}//${i.f}/v1`,`${i.b}//${i.a}/api/v0`,`${i.b}//${i.g}/v1`);class dn{user(t){return this.Zt.user(t)}conversation(t){return this.Zt.conversation(t)}subscribeConversations(t){return this.Zt.subscribeConversations(t)}constructor({appId:t,me:e,userId:n,token:s,tokenFetcher:i,signature:r}){if(this.M={message:()=>this.Je.$()},this.U=new z.a({message(t){},desktopNotificationClicked(t){},browserPermissionNeeded(t){},browserPermissionDenied(t){}},this.M),this.In=[],this.isAlive=!0,this.bt=Object(b.n)(),this.B=t=>{if(this.U.handles("desktopNotificationClicked"))return void setTimeout((()=>{this.U.emit("desktopNotificationClicked",{conversation:t})}),0);const e=this.getInboxes();if(1===e.length){e[0].select(t.id)}},this.kn=at[dn._n],!this.kn)throw new Error("[TalkJS] Unexpected error at TalkJS startup.");if(e&&n)throw new Error("[TalkJS] You cannot provide both 'me' and 'userId' in the Session#constructor. Please provide only one of them.");if(e&&!(e instanceof A))throw new Error("[TalkJS] The `me` property in the Session#constructor has to be of type Talk.User. For example:\n\nvar user = new Talk.User(data);\nvar session = new Talk.Session({\n    me: user,\n    appId: ...\n})");if(e&&(this.me=o(e,["object"],"Session: required field 'me' is not given or not a Talk.User object")),n&&(o(n,["string"],"Session: required field 'userId' is not given or not a string"),this.me=new A(n)),!e&&!n)throw new Error("[TalkJS] One of the Session#constructor parameters 'me' or 'userId' is required. \n        \nFor example:\n\nvar user = new Talk.User(data);\nvar session = new Talk.Session({\n    me: user,\n    appId: ...\n})\n\nOr:\n\nvar session = new Talk.Session({\n    userId: \"123\",\n    appId: ...\n})");var a;this.appId=o(t,["string"],"Session: required field 'appId' is missing, is not a string or is an empty string.",[h]),o(t,["string"],'Session: You need to replace "YOUR_APP_ID" with the app id found on the dashboard.\n\nFor more information check our documentation https://talkjs.com/docs/Reference/Concepts/Sessions/#appId',[t=>"YOUR_APP_ID"!==t]),o(s,["string","undefined"],"Session: optional field 'token' is not a string.",[h]),o(i,["function","undefined"],"Session: optional field 'tokenFetcher' is not a function."),this.signature=o(r,["string","undefined"],"Session: optional field 'signature' is not a string.",[h]),this.R=new b.a(this.appId+"."+this.me.id),Q.setData({appId:this.appId,meId:this.me.internalId,sessionId:this.bt}),this.Zt=(a={apiUrls:ln,appId:this.appId,userId:this.me.id,token:s,tokenFetcher:i,signature:r,clientBuild:"jssdk-release-fe737e0",forceCreateNew:!0}).forceCreateNew?new cn(a):un.getOrCreate(a),this.Zt.Vt.onTokenRefreshFailed((t=>{Q.log(`Session expired, reason: ${t}, initial token: ${!!s}, token fetcher: ${!!i}, signature: ${!!r}`)})),this.F=async function(t,e,n,s,i){const r=await tt({method:"GET",url:st(e,"app",0),attempts:5,authProvider:t}),o=(await r.json()).appMetadata.defaultLocale;return new nt(t,n,e,o,s,i)}(this.Zt.Vt,this.appId,this.me,this.bt,(()=>this.Oe())),this.currentUser=this.Zt.currentUser,this.Je=new q(this,this.F,(t=>this.U.emit("message",t)),this.B,this.me.id,this.R),this.unreads=this.Je,U(this.appId,this.me.id)&&this.Je.$(),this.Dn(),this.Nn(),this.Fn=Rt.a.decide(Ut,"en",this.me.locale),this.currentUser.subscribe((async t=>{if(t){const e=await this.F;t.locale===this.me.locale&&null!==t.locale||(this.Fn=Rt.a.decide(Ut,e.appLocale,t.locale))}}))}hasValidCredentials(){return this.N(),this.F.then((()=>!0),(()=>!1))}Dn(){const t=b.h(`talkjs-popup-${this.me.internalId}-${this.appId}`),e=b.h(`talkjs-popup-v2-${this.me.id}-${this.appId}`);if(t||e){if(e){const{conversationId:t,options:n}=JSON.parse(e);this.createPopup(t,n).mount({show:!0})}if(t){this.createPopup(t).mount({show:!0})}}}Nn(){const t=t=>{for(let t of this.In)t.onWindowVisibleChanged()};window.addEventListener("focus",(()=>t())),window.addEventListener("blur",(()=>t()))}getOrStartConversation(t,{participants:e,topicId:n,subject:s,custom:i,welcomeMessages:r,photoUrl:a}={}){if(this.N(),t instanceof A){const e=t,o=[this.me,e];return this.getOrStartConversation(C(this.me,e,n),{participants:o,topicId:n,subject:s,welcomeMessages:r,custom:i,photoUrl:a})}const u=t;o(u,["string"],"conversationId cannot be empty",[h]);let c=(e=e||[]).map((t=>new m(t)));return c=this.xn(c,this.me),new T({conversationId:u,participants:c,topicId:n,subject:s,welcomeMessages:r,custom:i,photoUrl:a})}xn(t,e){let n;return t.filter((t=>t.user.id===this.me.id))[0]?t:(n=new m(this.me),[n,...t])}getOrCreateConversation(t){return this.N(),new y(t,this)}createInbox(t={}){o(t,["object"],"Expected 1st parameter to createInbox, if present, to be an object. More info on https://talkjs.com/docs/Reference/JavaScript_Chat_SDK/Session.html#Session.createInbox"),o(t.selected,["null","undefined","string","object"],"Expected the createInbox `selected` option, if present, to be a conversation ID, a ConversationBuilder or null. More info on https://talkjs.com/docs/Reference/JavaScript_Chat_SDK/Session.html#Session.createInbox",[w]),this.N(),t.feedFilter&&wt("feedFilter",t.feedFilter),t.messageFilter&&Ot("messageFilter",t.messageFilter);const{selected:e}=t,n=new xt(this,{selectedConversation:e},t);return this.rememberUIBox(n),n}createChatbox(t,e={}){let n,s;w(t)?(n=t,s=e):(n=void 0,s=t),o(n,["null","undefined","string","object"],"Expected 1st parameter to createChatbox to be a conversation ID, a ConversationBuilder, null, or undefined. More info on https://talkjs.com/docs/Reference/JavaScript_Chat_SDK/Session.html#Session.createChatbox",[w]),o(s,["object"],"Expected 2nd parameter to createChatbox, if present, to be an object. More info on https://talkjs.com/docs/Reference/JavaScript_Chat_SDK/Session.html#Session.createChatbox"),this.N();const i=new Bt(this,{selectedConversation:n},s);return this.rememberUIBox(i),i}createPopup(t,e={}){let n,s;w(t)?(n=t,s=e):(n=void 0,s=null!=t?t:e),o(n,["null","undefined","string","object"],"Expected 1st parameter to createPopup to be a conversation ID, a ConversationBuilder, null, or undefined. More info on https://talkjs.com/docs/Reference/JavaScript_Chat_SDK/Session.html#Session.createPopup",[w]),o(s,["object"],"Expected 2nd parameter to createPopup, if present, to be an object. More info on https://talkjs.com/docs/Reference/JavaScript_Chat_SDK/Session.html#Session.createPopup"),this.N();const i={keepOpen:!this.xe(4),launcher:this.xe(5)?"always":"close-only"};s=Object.assign(Object.assign({},i),s);const r=new Pt(this,n,s);return this.rememberUIBox(r),r}rememberUIBox(t){this.In.push(t)}syncThemeForLocalDev(t){this.N(),b.j(this.appId)?console.warn("[TalkJS]: syncThemeForLocalDev does not work in live mode, please copy your theme to the TalkJS dashboard!"):this.legacyThemePath=t}forgetUIBox(t){const e=this.In.indexOf(t);e>=0&&this.In.splice(e,1)}setDesktopNotificationEnabled(t,{alertOnFailure:e}={}){this.N(),t=o(t,["boolean"],"Session.setDesktopNotificationEnabled: isEnabled should be a boolean value.");const n=t=>{this.Pn(),this.In.forEach((e=>e.ze(t)))};return this.Ye(t,{alertOnFailure:e}).then((()=>n(t))).catch((t=>{throw n(!1),t}))}Ye(t,{alertOnFailure:e,appName:n}){return t&&this.Je.$(),void 0===e&&(e=!this.U.handles("browserPermissionDenied")),L(t,{appId:this.appId,userId:this.me.id,locale:this.Fn,emitBrowserPermissionNeeded:()=>this.be("notifications"),emitBrowserPermissionDenied:()=>this.Ae("notifications"),alertOnFailure:e,appName:n})}Pn(){this.In.filter((t=>t.isZombie())).forEach((t=>t.destroy()))}registerDevice({platform:t,pushRegistrationId:e}){return this.N(),t=o(t,["string"],'Session.registerDevice: Platform should be a string containing "ios" or "android" values.',[d]),e=o(e,["string"],"Session.registerDevice: Push registration id should be a not empty string.",[h]),this.clearPushRegistrations().then((()=>this.setPushRegistration({provider:"ios"===t?"apns":"fcm",pushRegistrationId:e})))}unregisterDevice(){return this.clearPushRegistrations()}setPushRegistration(t){this.N();let{provider:e,pushRegistrationId:n}=t;e=o(e,["string"],'Session.setPushRegistration: Provider should be a string containing "fcm" or "apns" values.',[f]),n=o(n,["string"],"Session.setPushRegistration: Push registration id should be a not empty string.",[h]);const s=`${e}:${n}`;return this.currentUser.set({pushTokens:{[s]:!0}}).then((()=>{})).catch((t=>{throw console.error("[TalkJS]","Something went wrong: Cannot register this device.\n\nNote that you must ensure that the user exists in the TalkJS database before you call this method. The simplest way to do that is to call it after you mount a chatbox, inbox or popup."),t}))}unsetPushRegistration(t){this.N();let{provider:e,pushRegistrationId:n}=t;e=o(e,["string"],'Session.unsetPushRegistration: Provider should be a string containing "fcm" or "apns" values.',[f]),n=o(n,["string"],"Session.unsetPushRegistration: Push registration id should be a not empty string.",[h]);const s=`${e}:${n}`;return this.currentUser.set({pushTokens:{[s]:null}}).then((()=>{})).catch((t=>{throw console.error("[TalkJS]","Cannot unregister this device. Please contact us to get more information."),t}))}clearPushRegistrations(){return this.N(),this.currentUser.set({pushTokens:null}).then((()=>{})).catch((t=>{throw console.error("[TalkJS]","Cannot unregister this device. Please contact us to get more information."),t}))}async be(t){if(!await Object(H.k)(t))return"continue";let e=!1;const n={type:t,preventDefault(){e=!0}};return await this.U.emitAsync("browserPermissionNeeded",n),e?"cancel":"continue"}Ae(t){return this.U.emit("browserPermissionDenied",{type:t}),this.U.handles("browserPermissionDenied")}on(t,e){this.N(),this.U.on(t,e)}off(t,e){this.U.off(t,e)}onMessage(t){return this.U.subscribe("message",t)}onDesktopNotificationClicked(t){return this.U.subscribe("desktopNotificationClicked",t)}onBrowserPermissionNeeded(t){return X({handler:t}),this.N(),this.U.subscribe("browserPermissionNeeded",t)}onBrowserPermissionDenied(t){return X({handler:t}),this.N(),this.U.subscribe("browserPermissionDenied",t)}destroy(){this.isAlive=!1,this.R.relinquish();for(let t of this.In)t.destroy();this.Zt.Tn.destroy(),this.Je.lt(),this.U.removeAllListeners(),this.F.then((t=>t.disconnect()))}getPopups(){return this.sn(I.a.Popup)}getInboxes(){return this.sn(I.a.Inbox)}getChatboxes(){return this.sn(I.a.Chatbox)}uploadFile(t,e){return this.Zt.uploadFile(t,e)}uploadImage(t,e){return this.Zt.uploadImage(t,e)}uploadVideo(t,e){return this.Zt.uploadVideo(t,e)}uploadAudio(t,e){return this.Zt.uploadAudio(t,e)}uploadVoice(t,e){return this.Zt.uploadVoice(t,e)}sn(t){return this.Pn(),this.In.filter((e=>e.boxType===t))}N(){if(!this.isAlive)throw new Error("[TalkJS] The Talk.Session instance related to this operation has been destroyed, and it cannot be used anymore. Please create a new Session.")}jn(t){return this.F.then((e=>e.post("/_t",t))).then((t=>t.text()))}xe(t){return-1!==this.kn.indexOf(t)}async Oe(){const t=this.Zt.Sn();if(t){return{connected:t,token:await this.Zt.Vt.getToken()}}return{connected:t}}}const fn=window;if(fn.Talk||(fn.Talk={}),dn._n=fn.Talk.v||0,fn.Talk.User=A,fn.Talk.Session=dn,fn.Talk.Error=r,fn.Talk.TalkError=r,fn.Talk.oneOnOneId=function(t,e){return t instanceof A&&(t=t.id),e instanceof A&&(e=e.id),Object(g.a)(JSON.stringify([t,e].sort()))},fn.Talk.getAppMetadata=function(t){return tt({method:"GET",url:st(t,""),attempts:5}).then((t=>t.json())).then((e=>{if(e.custom)return{id:t,custom:e.custom};throw new Error("Unexpected error")}))},fn.onTalkLoaded&&fn.onTalkLoaded(),fn.onTalkUiLoaded&&fn.onTalkUiLoaded(),fn.Talk.ready){const t=Promise.resolve(),e=fn.Talk.ready;e.c.forEach((([e,n,s])=>{t.then(e).then(n).catch(s)})),e.Bn=[],e.then=t.then.bind(t),e.catch=t.catch.bind(t)}},43:function(t,e,n){"use strict";function s(t,e){if(!t()){if(!e){e=t.toString().replace(/^function\s*\(\)\s*\{\s*return\s*(.*);\s*\}\s*$/,"`$1`")+" was not true"}i(e)}}!function(t){function e(t){null==t&&i(`Expected val to be defined, is ${t}`)}function n(t,e){if(!function(t,e){switch(e){case"undefined":return void 0===t;case String:return"string"==typeof t||t instanceof String;case Boolean:return"boolean"==typeof t||t instanceof Boolean;case Number:return"number"==typeof t||t instanceof Number;default:return t instanceof e}}(t,e)){i("Expected "+e.name+", got "+String(t))}}t.defined=e,t.has=function(t,n){e(t),e(t[n])},t.is=n,t.equals=function(t,e){if(t!==e){i("Expected "+String(e)+", got "+String(t))}},t.oneOf=function(t,e){if(!e.includes(t)){i(`Expected ${t} to be one of ${JSON.stringify(e)}`)}},t.isArray=function(t,e){n(t,Array),t&&t.length>0&&n(t[0],e)},t.optional=function(t,e){void 0!==t&&n(t,e)},t.falsy=function(t){if(t){i("Expected undefined, got "+String(t))}},t.never=function(t){i("Should've been unreachable")}}(s||(s={}));e.a=s;function i(t){0}},47:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s{constructor(t,e={}){this.Rn=e,this.Et={};for(const e in t)Object.hasOwnProperty.call(t,e)&&(this.Et[e]=[])}emit(t,e){for(const n of this.Et[t])try{n(e)}catch(e){console.error(`[TalkJS] '${String(t)}' handler threw an error:`,e)}}async emitAsync(t,e){try{const n=this.Et[t].map((t=>t(e)));await Promise.all(n)}catch(e){console.error(`[TalkJS] '${String(t)}' handler threw an error:`,e)}}supports(t){return t in this.Et}on(t,e){var n,s;if(!this.supports(t))throw new Error(`Unknown event type '${String(t)}'`);null===(s=(n=this.Rn)[t])||void 0===s||s.call(n),this.Et[t].push(e)}off(t,e){if(!Object.hasOwnProperty.call(this.Et,t))throw new Error(`Unknown event type '${String(t)}'`);const n=this.Et[t].indexOf(e);-1!==n&&this.Et[t].splice(n,1)}removeAllListeners(){for(const t in this.Et)this.Et[t]=[]}handles(t){return this.Et[t].length>0}subscribe(t,e){return this.on(t,e),{unsubscribe:()=>this.off(t,e)}}}},48:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o}));var s=n(6),i=n(61);function r(t,e){return t.map((t=>function(t,e){if("text"===t.type)return o(t.children,e);if("file"===t.type&&"video"===t.subtype)return`🎥 ${Object(s.c)(t.url)}`;if("file"===t.type&&"image"===t.subtype)return`📷 ${Object(s.c)(t.url)}`;if("file"===t.type&&"audio"===t.subtype)return`🎧 ${Object(s.c)(t.url)}`;if("file"===t.type&&"voice"===t.subtype){const e=t.duration;if(void 0===e)return"🎙️";return`🎙️ (${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")})`}if("file"===t.type){t.subtype;return`📎 ${Object(s.c)(t.url)}`}if("location"===t.type)return"📍";return""}(t,e))).join("\n\n")}function o(t,e){return a(t,Object(i.a)(e))}function a(t,e){return t.flatMap((t=>{if("string"==typeof t)return t;switch(t.type){case"blockquote":case"bold":case"italic":case"strikethrough":case"link":case"actionlink":case"actionLink":case"actionbutton":case"actionButton":return a(t.children,e);case"bulletlist":case"bulletList":return"\n"+a(t.children,e);case"bulletpoint":case"bulletPoint":return"- "+a(t.children,e)+"\n";case"autolink":case"autoLink":case"codeblock":case"codeBlock":case"codespan":case"codeSpan":case"emoji":case"customemoji":case"customEmoji":return t.text;case"suppressed":return e.contactInfoHiddenText;case"mention":return`@${t.text}`}})).join("")}},51:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));var s=n(28);function i(t,e){let n=[];return Object(s.a)(t,((t,s)=>{n.push(e(t,s))})),n}function r(t){return i(t,((t,e)=>[e,t]))}},56:function(t,e,n){"use strict";function s(t,e){return t.reduce(((t,n,s)=>t.concat(e(n,s))),[])}function i(t,e){let n=[];const s=Math.min(t.length,e.length);for(let i=0;i<s;i++)n[i]=[t[i],e[i]];return n}function r(t,e){let n=[],s=[];for(var i=0;i<t.length;i++)e(t[i])?n.push(t[i]):s.push(t[i]);return[n,s]}n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return r}))},6:function(t,e,n){"use strict";n.d(e,"d",(function(){return r})),n.d(e,"b",(function(){return o})),n.d(e,"e",(function(){return a})),n.d(e,"a",(function(){return u})),n.d(e,"i",(function(){return c})),n.d(e,"h",(function(){return h})),n.d(e,"g",(function(){return l})),n.d(e,"j",(function(){return d})),n.d(e,"f",(function(){return p})),n.d(e,"k",(function(){return m})),n.d(e,"c",(function(){return g}));var s=n(101);const i=/[^a-zA-Z\u00C0-\u024F\u1E00-\u1EFF\u0400-\u044f\u0300-\u036e]+/,r=t=>t.split(i).filter((t=>t)).map((t=>t[0])).join("")||(t[Symbol.iterator]().next().value||"");function o(t,e){const n=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">\n            <rect x="0" y="0" width="100" height="100" fill="${a(t)}"/>\n            <text x="50%" y="54%" dominant-baseline="middle" font-size="34" font-family="San Francisco, Segoe UI, Helvetica Neue, Arial, Helvetica, sans-serif" fill="#fff" text-anchor="middle">${e}</text> \n        </svg>`.replace(/\s+/g," ");return"data:image/svg+xml;base64,"+s.encode(n)}function a(t){const e=function(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return Math.abs(e)}(t)%v.length;return v[e]}function u(t,e){const n=e.lastIndex;let s;const i=[];for(;null!==(s=e.exec(t));)i.push(s);return e.lastIndex=n,i}function c(t){const e=RegExp(`[^${t}]+${t}?|${t}`,"g");return t=>Array.from(t.match(e)||[])}function h(t,e,n){let s=0;const i=[];for(const r of e)r.offset<s||(r.offset>s&&i.push(t.substring(s,r.offset)),i.push(...n(r)),s=r.offset+r.matchedText.length);return s<t.length&&i.push(t.substring(s)),i}function l(t){{const e=document.createElement("a");return e.href=t,e.hostname}}function d(t){return t.replace(/^\s*\n/m,"").replace(/\n\s*$/m,"")}function f(){try{return new WeakMap}catch(t){const e={has:()=>!1,get:()=>{},set:()=>e};return e}}function p(){const t=f();return{getOrCompute(e,n){if(t.has(e))return t.get(e);const s=n();return t.set(e,s),s}}}async function m(t){if(!("permissions"in navigator))return!1;const e=t;try{return"prompt"===(await navigator.permissions.query({name:e})).state}catch(t){return!1}}function g(t){const e=t.replace(/%2F/g,"/").replace(/^.*?\/([^/]+?)(?:\?.*)?$/,"$1");return decodeURIComponent(e)}const v=["#996666","#9A6E61","#8D7662","#8E775E","#948771","#8A8360","#888D65","#6F8E63","#749378","#678975","#779E86","#639A8F","#6D92A1","#65869F","#697E9A","#736C9F","#8C6495","#956387","#B05D54","#B16D52","#AF8751","#AC8A56","#B7A458","#B5B35C","#83AA5D","#4F9D5D","#5FA777","#66B58F","#5FB3AC","#589AAF","#4E7F9E","#456CAC","#6456B7","#714AB2","#9771B5","#C154C1","#B05E81","#B04C6A","#B94E48","#AF593E","#C5994B","#B8C25D","#87AB39","#4FA83D","#40A860","#41AA78","#3AB09E","#3FC1AA","#56B4BE","#3EABBF","#4682B4","#7A58C1","#9966CC","#C54B8C","#B44668","#AE4560","#A3807B","#AB917A","#ACA586","#A8AF8E","#9EA587","#8BA690","#7DA98D","#7CB0A1","#8BA9A5","#7CA1A6","#859FAF","#8D90A1","#A397B4","#AE809E","#C08081","#BB8983","#B19461","#B5A27F","#B8B56A","#9AB973","#7AC488","#7CB7BB","#80B3C4","#788BBA","#7A89B8","#9678B6","#CB8FA9","#B57281","#C6726B","#C88A65","#C2955D","#C8B568","#B9C46A","#74C365","#6FD0C5","#6093D1","#7666C6","#D06DA1"]},60:function(t,e,n){"use strict";var s=n(56);n.d(e,"a",(function(){return s.a})),n.d(e,"b",(function(){return s.b}))},61:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n(43),i=n(31);class r{constructor({mode:t,allowedHostnames:e,allowedPhoneNrs:n,allowedMatches:r,forbiddenMatches:o,suppressLinks:a,suppressEmailAddresses:u,suppressPhoneNumbers:c,replacement:h}){s.a.oneOf(t,["all","otherOnly","off"]),this.mode=t,this.suppressLinks=!1!==a,this.suppressEmailAddresses=!1!==u,this.suppressPhoneNumbers=!1!==c,this.allowedHostnames=e||[],this.allowedPhoneNrs=(n||[]).filter((t=>t)).map((t=>t.replace(/[^0-9]/g,""))),this.allowedMatches=(r||[]).filter(i.b).map((t=>i.c(t))),this.forbiddenMatches=(o||[]).filter(i.b).map((t=>i.c(t))),Object(s.a)((()=>this.allowedMatches.every((t=>t.flags.includes("g")))),"All regexes in `suppressContactInfo.allowedMatches` must be global. Check `allowedMatches`!"),Object(s.a)((()=>this.forbiddenMatches.every((t=>t.flags.includes("g")))),"All regexes in `suppressContactInfo.forbiddenMatches` must be global. Check `forbiddenMatches`!"),h=null==h?void 0:h.trim(),this.replacement=h&&h.length>0?h:void 0}shouldSuppress({isContentBySender:t}){return"all"===this.mode||"otherOnly"===this.mode&&!t}}n(6);function o(t){var e,n,s,i,o,a,u,c,h,l,d,f;let p="";t.t&&(p=`(${t.t("CONTACT_INFORMATION_HIDDEN")})`);return{formattedLinks:null!==(e=t.formattedLinks)&&void 0!==e?e:"plaintext",markup:null!==(n=t.markup)&&void 0!==n&&n,useFallbackMentions:null!==(s=t.useFallbackMentions)&&void 0!==s&&s,sameTabLinkRules:null!==(i=t.sameTabLinkRules)&&void 0!==i?i:[],enableEmojiImageFallback:null!==(o=t.enableEmojiImageFallback)&&void 0!==o&&o,highlight:null!==(a=t.highlight)&&void 0!==a?a:[],contactInfo:null!==(u=t.contactInfo)&&void 0!==u&&u,suppression:null!==(c=t.suppression)&&void 0!==c?c:new r({mode:"off"}),contactInfoHiddenText:null!==(d=null!==(h=t.contactInfoHiddenText)&&void 0!==h?h:null===(l=t.suppression)||void 0===l?void 0:l.replacement)&&void 0!==d?d:p,customEmojiUrls:null!==(f=t.customEmojiUrls)&&void 0!==f?f:{}}}},63:function(t,e,n){"use strict";const s=(()=>{{let e;try{e=window.localStorage;var t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&e&&0!==e.length}}return!1})();var i={};s?(i.setItem=window.localStorage.setItem.bind(window.localStorage),i.getItem=window.localStorage.getItem.bind(window.localStorage),i.removeItem=window.localStorage.removeItem.bind(window.localStorage),i.isSupported=!0):(i.setItem=function(){},i.getItem=function(){return null},i.removeItem=function(){},i.isSupported=!1),i.set=(t,e)=>i.setItem(t,JSON.stringify(e)),i.get=t=>JSON.parse(i.getItem(t)||"null"),e.a=i},67:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return o}));var s=n(56);n(51);function i(t,e){let n={};return t.forEach(((t,s)=>{const[i,r]=e(t,s);n[i]=r})),n}function r(t){return i(t,(t=>t))}function o(t,e){return r(Object(s.c)(t,e))}},69:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));const s=Object.create(null);function i(t){t(s)}s.channels=Object.create(null),s.monitors=Object.create(null),window.Talk||(window.dev=s)},73:function(t,e,n){"use strict";n.d(e,"a",(function(){return P})),n.d(e,"b",(function(){return B}));var s=t=>{if("function"==typeof t)return t;return function(){return t}},i="undefined"!=typeof self?self:null,r="undefined"!=typeof window?window:null,o=i||r||o,a=0,u=1,c=2,h=3,l="closed",d="errored",f="joined",p="joining",m="leaving",g="phx_close",v="phx_error",b="phx_join",A="phx_reply",w="phx_leave",E="longpoll",O="websocket",T=4,y=class{constructor(t,e,n,s){this.channel=t,this.event=e,this.payload=n||function(){return{}},this.receivedResp=null,this.timeout=s,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}resend(t){this.timeout=t,this.reset(),this.send()}send(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload(),ref:this.ref,join_ref:this.channel.joinRef()}))}receive(t,e){return this.hasReceived(t)&&e(this.receivedResp.response),this.recHooks.push({status:t,callback:e}),this}reset(){this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1}matchReceive({status:t,response:e,Mn:n}){this.recHooks.filter((e=>e.status===t)).forEach((t=>t.callback(e)))}cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}startTimeout(){this.timeoutTimer&&this.cancelTimeout(),this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,(t=>{this.cancelRefEvent(),this.cancelTimeout(),this.receivedResp=t,this.matchReceive(t)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}trigger(t,e){this.channel.trigger(this.refEvent,{status:t,response:e})}},C=class{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=null,this.tries=0}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}},S=class{static request(t,e,n,s,i,r,a){if(o.XDomainRequest){let n=new o.XDomainRequest;return this.xdomainRequest(n,t,e,s,i,r,a)}{let u=new o.XMLHttpRequest;return this.xhrRequest(u,t,e,n,s,i,r,a)}}static xdomainRequest(t,e,n,s,i,r,o){return t.timeout=i,t.open(e,n),t.onload=()=>{let e=this.parseJSON(t.responseText);o&&o(e)},r&&(t.ontimeout=r),t.onprogress=()=>{},t.send(s),t}static xhrRequest(t,e,n,s,i,r,o,a){return t.open(e,n,!0),t.timeout=r,t.setRequestHeader("Content-Type",s),t.onerror=()=>a&&a(null),t.onreadystatechange=()=>{if(t.readyState===T&&a){let e=this.parseJSON(t.responseText);a(e)}},o&&(t.ontimeout=o),t.send(i),t}static parseJSON(t){if(!t||""===t)return null;try{return JSON.parse(t)}catch(e){return console&&console.log("failed to parse JSON response",t),null}}static serialize(t,e){let n=[];for(var s in t){if(!Object.prototype.hasOwnProperty.call(t,s))continue;let i=e?`${e}[${s}]`:s,r=t[s];"object"==typeof r?n.push(this.serialize(r,i)):n.push(encodeURIComponent(i)+"="+encodeURIComponent(r))}return n.join("&")}static appendParams(t,e){if(0===Object.keys(e).length)return t;let n=t.match(/\?/)?"&":"?";return`${t}${n}${this.serialize(e)}`}},I=class{constructor(t){this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.reqs=new Set,this.awaitingBatchAck=!1,this.currentBatch=null,this.currentBatchTimer=null,this.batchBuffer=[],this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(t),this.readyState=a,setTimeout((()=>this.poll()),0)}normalizeEndpoint(t){return t.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+O),"$1/"+E)}endpointURL(){return S.appendParams(this.pollEndpoint,{token:this.token})}closeAndRetry(t,e,n){this.close(t,e,n),this.readyState=a}ontimeout(){this.onerror("timeout"),this.closeAndRetry(1005,"timeout",!1)}isActive(){return this.readyState===u||this.readyState===a}poll(){this.ajax("GET","application/json",null,(()=>this.ontimeout()),(t=>{if(t){var{status:e,token:n,messages:s}=t;this.token=n}else e=0;switch(e){case 200:s.forEach((t=>{setTimeout((()=>this.onmessage({data:t})),0)})),this.poll();break;case 204:this.poll();break;case 410:this.readyState=u,this.onopen({}),this.poll();break;case 403:this.onerror(403),this.close(1008,"forbidden",!1);break;case 0:case 500:this.onerror(500),this.closeAndRetry(1011,"internal server error",500);break;default:throw new Error(`unhandled poll status ${e}`)}}))}send(t){"string"!=typeof t&&(t=(t=>{let e="",n=new Uint8Array(t),s=n.byteLength;for(let t=0;t<s;t++)e+=String.fromCharCode(n[t]);return btoa(e)})(t)),this.currentBatch?this.currentBatch.push(t):this.awaitingBatchAck?this.batchBuffer.push(t):(this.currentBatch=[t],this.currentBatchTimer=setTimeout((()=>{this.batchSend(this.currentBatch),this.currentBatch=null}),0))}batchSend(t){this.awaitingBatchAck=!0,this.ajax("POST","application/x-ndjson",t.join("\n"),(()=>this.onerror("timeout")),(t=>{this.awaitingBatchAck=!1,t&&200===t.status?this.batchBuffer.length>0&&(this.batchSend(this.batchBuffer),this.batchBuffer=[]):(this.onerror(t&&t.status),this.closeAndRetry(1011,"internal server error",!1))}))}close(t,e,n){for(let t of this.reqs)t.abort();this.readyState=h;let s=Object.assign({code:1e3,reason:void 0,wasClean:!0},{code:t,reason:e,wasClean:n});this.batchBuffer=[],clearTimeout(this.currentBatchTimer),this.currentBatchTimer=null,"undefined"!=typeof CloseEvent?this.onclose(new CloseEvent("close",s)):this.onclose(s)}ajax(t,e,n,s,i){let r;r=S.request(t,this.endpointURL(),e,n,this.timeout,(()=>{this.reqs.delete(r),s()}),(t=>{this.reqs.delete(r),this.isActive()&&i(t)})),this.reqs.add(r)}},k={HEADER_LENGTH:1,META_LENGTH:4,KINDS:{push:0,reply:1,broadcast:2},encode(t,e){if(t.payload.constructor===ArrayBuffer)return e(this.binaryEncode(t));{let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return e(JSON.stringify(n))}},decode(t,e){if(t.constructor===ArrayBuffer)return e(this.binaryDecode(t));{let[n,s,i,r,o]=JSON.parse(t);return e({join_ref:n,ref:s,topic:i,event:r,payload:o})}},binaryEncode(t){let{join_ref:e,ref:n,event:s,topic:i,payload:r}=t,o=this.META_LENGTH+e.length+n.length+i.length+s.length,a=new ArrayBuffer(this.HEADER_LENGTH+o),u=new DataView(a),c=0;u.setUint8(c++,this.KINDS.push),u.setUint8(c++,e.length),u.setUint8(c++,n.length),u.setUint8(c++,i.length),u.setUint8(c++,s.length),Array.from(e,(t=>u.setUint8(c++,t.charCodeAt(0)))),Array.from(n,(t=>u.setUint8(c++,t.charCodeAt(0)))),Array.from(i,(t=>u.setUint8(c++,t.charCodeAt(0)))),Array.from(s,(t=>u.setUint8(c++,t.charCodeAt(0))));var h=new Uint8Array(a.byteLength+r.byteLength);return h.set(new Uint8Array(a),0),h.set(new Uint8Array(r),a.byteLength),h.buffer},binaryDecode(t){let e=new DataView(t),n=e.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.push:return this.decodePush(t,e,s);case this.KINDS.reply:return this.decodeReply(t,e,s);case this.KINDS.broadcast:return this.decodeBroadcast(t,e,s)}},decodePush(t,e,n){let s=e.getUint8(1),i=e.getUint8(2),r=e.getUint8(3),o=this.HEADER_LENGTH+this.META_LENGTH-1,a=n.decode(t.slice(o,o+s));o+=s;let u=n.decode(t.slice(o,o+i));o+=i;let c=n.decode(t.slice(o,o+r));return o+=r,{join_ref:a,ref:null,topic:u,event:c,payload:t.slice(o,t.byteLength)}},decodeReply(t,e,n){let s=e.getUint8(1),i=e.getUint8(2),r=e.getUint8(3),o=e.getUint8(4),a=this.HEADER_LENGTH+this.META_LENGTH,u=n.decode(t.slice(a,a+s));a+=s;let c=n.decode(t.slice(a,a+i));a+=i;let h=n.decode(t.slice(a,a+r));a+=r;let l=n.decode(t.slice(a,a+o));a+=o;let d=t.slice(a,t.byteLength);return{join_ref:u,ref:c,topic:h,event:A,payload:{status:l,response:d}}},decodeBroadcast(t,e,n){let s=e.getUint8(1),i=e.getUint8(2),r=this.HEADER_LENGTH+2,o=n.decode(t.slice(r,r+s));r+=s;let a=n.decode(t.slice(r,r+i));return r+=i,{join_ref:null,ref:null,topic:o,event:a,payload:t.slice(r,t.byteLength)}}},_=n(47),D=n(24),N=n(69),F=n(12);const x=window.WebSocket;class P{constructor(t,e){this.$n=e,this.tokenParams={},this.eventEmitter=new _.a({connectionStatusChanged(t){}}),this.Un=[t,"api","v0",e.appId,"socket"].join("/"),this.Ln={}}onConnectionStatusChanged(t){return this.eventEmitter.on("connectionStatusChanged",t),()=>{this.eventEmitter.off("connectionStatusChanged",t)}}connect(t={}){this.tokenParams=Object.assign(Object.assign({},this.tokenParams),t);try{const t=new class{constructor(t,e={}){this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=e.timeout||1e4,this.transport=e.transport||o.WebSocket||I,this.primaryPassedHealthCheck=!1,this.longPollFallbackMs=e.longPollFallbackMs,this.fallbackTimer=null,this.sessionStore=e.sessionStorage||o&&o.sessionStorage,this.establishedConnections=0,this.defaultEncoder=k.encode.bind(k),this.defaultDecoder=k.decode.bind(k),this.closeWasClean=!1,this.binaryType=e.binaryType||"arraybuffer",this.connectClock=1,this.transport!==I?(this.encode=e.encode||this.defaultEncoder,this.decode=e.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder);let n=null;r&&r.addEventListener&&(r.addEventListener("pagehide",(t=>{this.conn&&(this.disconnect(),n=this.connectClock)})),r.addEventListener("pageshow",(t=>{n===this.connectClock&&(n=null,this.connect())}))),this.heartbeatIntervalMs=e.heartbeatIntervalMs||3e4,this.rejoinAfterMs=t=>e.rejoinAfterMs?e.rejoinAfterMs(t):[1e3,2e3,5e3][t-1]||1e4,this.reconnectAfterMs=t=>e.reconnectAfterMs?e.reconnectAfterMs(t):[10,50,100,150,200,250,500,1e3,2e3][t-1]||5e3,this.logger=e.logger||null,!this.logger&&e.debug&&(this.logger=(t,e,n)=>{console.log(`${t}: ${e}`,n)}),this.longpollerTimeout=e.longpollerTimeout||2e4,this.params=s(e.params||{}),this.endPoint=`${t}/${O}`,this.vsn=e.vsn||"2.0.0",this.heartbeatTimeoutTimer=null,this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new C((()=>{this.teardown((()=>this.connect()))}),this.reconnectAfterMs)}getLongPollTransport(){return I}replaceTransport(t){this.connectClock++,this.closeWasClean=!0,clearTimeout(this.fallbackTimer),this.reconnectTimer.reset(),this.conn&&(this.conn.close(),this.conn=null),this.transport=t}protocol(){return location.protocol.match(/^https/)?"wss":"ws"}endPointURL(){let t=S.appendParams(S.appendParams(this.endPoint,this.params()),{vsn:this.vsn});return"/"!==t.charAt(0)?t:"/"===t.charAt(1)?`${this.protocol()}:${t}`:`${this.protocol()}://${location.host}${t}`}disconnect(t,e,n){this.connectClock++,this.closeWasClean=!0,clearTimeout(this.fallbackTimer),this.reconnectTimer.reset(),this.teardown(t,e,n)}connect(t){t&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=s(t)),this.conn||(this.longPollFallbackMs&&this.transport!==I?this.connectWithFallback(I,this.longPollFallbackMs):this.transportConnect())}log(t,e,n){this.logger&&this.logger(t,e,n)}hasLogger(){return null!==this.logger}onOpen(t){let e=this.makeRef();return this.stateChangeCallbacks.open.push([e,t]),e}onClose(t){let e=this.makeRef();return this.stateChangeCallbacks.close.push([e,t]),e}onError(t){let e=this.makeRef();return this.stateChangeCallbacks.error.push([e,t]),e}onMessage(t){let e=this.makeRef();return this.stateChangeCallbacks.message.push([e,t]),e}ping(t){if(!this.isConnected())return!1;let e=this.makeRef(),n=Date.now();this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:e});let s=this.onMessage((i=>{i.ref===e&&(this.off([s]),t(Date.now()-n))}));return!0}transportConnect(){this.connectClock++,this.closeWasClean=!1,this.conn=new this.transport(this.endPointURL()),this.conn.binaryType=this.binaryType,this.conn.timeout=this.longpollerTimeout,this.conn.onopen=()=>this.onConnOpen(),this.conn.onerror=t=>this.onConnError(t),this.conn.onmessage=t=>this.onConnMessage(t),this.conn.onclose=t=>this.onConnClose(t)}getSession(t){return this.sessionStore&&this.sessionStore.getItem(t)}storeSession(t,e){this.sessionStore&&this.sessionStore.setItem(t,e)}connectWithFallback(t,e=2500){clearTimeout(this.fallbackTimer);let n,s=!1,i=!0,r=e=>{this.log("transport",`falling back to ${t.name}...`,e),this.off([void 0,n]),i=!1,this.replaceTransport(t),this.transportConnect()};if(this.getSession(`phx:fallback:${t.name}`))return r("memorized");this.fallbackTimer=setTimeout(r,e),n=this.onError((t=>{this.log("transport","error",t),i&&!s&&(clearTimeout(this.fallbackTimer),r(t))})),this.onOpen((()=>{if(s=!0,!i)return this.primaryPassedHealthCheck||this.storeSession(`phx:fallback:${t.name}`,"true"),this.log("transport",`established ${t.name} fallback`);clearTimeout(this.fallbackTimer),this.fallbackTimer=setTimeout(r,e),this.ping((t=>{this.log("transport","connected to primary after",t),this.primaryPassedHealthCheck=!0,clearTimeout(this.fallbackTimer)}))})),this.transportConnect()}clearHeartbeats(){clearTimeout(this.heartbeatTimer),clearTimeout(this.heartbeatTimeoutTimer)}onConnOpen(){this.hasLogger()&&this.log("transport",`${this.transport.name} connected to ${this.endPointURL()}`),this.closeWasClean=!1,this.establishedConnections++,this.flushSendBuffer(),this.reconnectTimer.reset(),this.resetHeartbeat(),this.stateChangeCallbacks.open.forEach((([,t])=>t()))}heartbeatTimeout(){this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null,this.hasLogger()&&this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.triggerChanError(),this.closeWasClean=!1,this.teardown((()=>this.reconnectTimer.scheduleTimeout()),1e3,"heartbeat timeout"))}resetHeartbeat(){this.conn&&this.conn.skipHeartbeat||(this.pendingHeartbeatRef=null,this.clearHeartbeats(),this.heartbeatTimer=setTimeout((()=>this.sendHeartbeat()),this.heartbeatIntervalMs))}teardown(t,e,n){if(!this.conn)return t&&t();this.waitForBufferDone((()=>{this.conn&&(e?this.conn.close(e,n||""):this.conn.close()),this.waitForSocketClosed((()=>{this.conn&&(this.conn.onopen=function(){},this.conn.onerror=function(){},this.conn.onmessage=function(){},this.conn.onclose=function(){},this.conn=null),t&&t()}))}))}waitForBufferDone(t,e=1){5!==e&&this.conn&&this.conn.bufferedAmount?setTimeout((()=>{this.waitForBufferDone(t,e+1)}),150*e):t()}waitForSocketClosed(t,e=1){5!==e&&this.conn&&this.conn.readyState!==h?setTimeout((()=>{this.waitForSocketClosed(t,e+1)}),150*e):t()}onConnClose(t){let e=t&&t.code;this.hasLogger()&&this.log("transport","close",t),this.triggerChanError(),this.clearHeartbeats(),this.closeWasClean||1e3===e||this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((([,e])=>e(t)))}onConnError(t){this.hasLogger()&&this.log("transport",t);let e=this.transport,n=this.establishedConnections;this.stateChangeCallbacks.error.forEach((([,s])=>{s(t,e,n)})),(e===this.transport||n>0)&&this.triggerChanError()}triggerChanError(){this.channels.forEach((t=>{t.isErrored()||t.isLeaving()||t.isClosed()||t.trigger(v)}))}connectionState(){switch(this.conn&&this.conn.readyState){case a:return"connecting";case u:return"open";case c:return"closing";default:return"closed"}}isConnected(){return"open"===this.connectionState()}remove(t){this.off(t.stateChangeRefs),this.channels=this.channels.filter((e=>e!==t))}off(t){for(let e in this.stateChangeCallbacks)this.stateChangeCallbacks[e]=this.stateChangeCallbacks[e].filter((([e])=>-1===t.indexOf(e)))}channel(t,e={}){let n=new class{constructor(t,e,n){this.state=l,this.topic=t,this.params=s(e||{}),this.socket=n,this.bindings=[],this.bindingRef=0,this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new y(this,b,this.params,this.timeout),this.pushBuffer=[],this.stateChangeRefs=[],this.rejoinTimer=new C((()=>{this.socket.isConnected()&&this.rejoin()}),this.socket.rejoinAfterMs),this.stateChangeRefs.push(this.socket.onError((()=>this.rejoinTimer.reset()))),this.stateChangeRefs.push(this.socket.onOpen((()=>{this.rejoinTimer.reset(),this.isErrored()&&this.rejoin()}))),this.joinPush.receive("ok",(()=>{this.state=f,this.rejoinTimer.reset(),this.pushBuffer.forEach((t=>t.send())),this.pushBuffer=[]})),this.joinPush.receive("error",(()=>{this.state=d,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()})),this.onClose((()=>{this.rejoinTimer.reset(),this.socket.hasLogger()&&this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=l,this.socket.remove(this)})),this.onError((t=>{this.socket.hasLogger()&&this.socket.log("channel",`error ${this.topic}`,t),this.isJoining()&&this.joinPush.reset(),this.state=d,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()})),this.joinPush.receive("timeout",(()=>{this.socket.hasLogger()&&this.socket.log("channel",`timeout ${this.topic} (${this.joinRef()})`,this.joinPush.timeout),new y(this,w,s({}),this.timeout).send(),this.state=d,this.joinPush.reset(),this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()})),this.on(A,((t,e)=>{this.trigger(this.replyEventName(e),t)}))}join(t=this.timeout){if(this.joinedOnce)throw new Error("tried to join multiple times. 'join' can only be called a single time per channel instance");return this.timeout=t,this.joinedOnce=!0,this.rejoin(),this.joinPush}onClose(t){this.on(g,t)}onError(t){return this.on(v,(e=>t(e)))}on(t,e){let n=this.bindingRef++;return this.bindings.push({event:t,ref:n,callback:e}),n}off(t,e){this.bindings=this.bindings.filter((n=>!(n.event===t&&(void 0===e||e===n.ref))))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(t,e,n=this.timeout){if(e=e||{},!this.joinedOnce)throw new Error(`tried to push '${t}' to '${this.topic}' before joining. Use channel.join() before pushing events`);let s=new y(this,t,(function(){return e}),n);return this.canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}leave(t=this.timeout){this.rejoinTimer.reset(),this.joinPush.cancelTimeout(),this.state=m;let e=()=>{this.socket.hasLogger()&&this.socket.log("channel",`leave ${this.topic}`),this.trigger(g,"leave")},n=new y(this,w,s({}),t);return n.receive("ok",(()=>e())).receive("timeout",(()=>e())),n.send(),this.canPush()||n.trigger("ok",{}),n}onMessage(t,e,n){return e}isMember(t,e,n,s){return!(this.topic!==t||s&&s!==this.joinRef()&&(this.socket.hasLogger()&&this.socket.log("channel","dropping outdated message",{topic:t,event:e,payload:n,joinRef:s}),1))}joinRef(){return this.joinPush.ref}rejoin(t=this.timeout){this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=p,this.joinPush.resend(t))}trigger(t,e,n,s){let i=this.onMessage(t,e,n,s);if(e&&!i)throw new Error("channel onMessage callbacks must return the payload, modified or unmodified");let r=this.bindings.filter((e=>e.event===t));for(let t=0;t<r.length;t++)r[t].callback(i,n,s||this.joinRef())}replyEventName(t){return`chan_reply_${t}`}isClosed(){return this.state===l}isErrored(){return this.state===d}isJoined(){return this.state===f}isJoining(){return this.state===p}isLeaving(){return this.state===m}}(t,e,this);return this.channels.push(n),n}push(t){if(this.hasLogger()){let{topic:e,event:n,payload:s,ref:i,join_ref:r}=t;this.log("push",`${e} ${n} (${r}, ${i})`,s)}this.isConnected()?this.encode(t,(t=>this.conn.send(t))):this.sendBuffer.push((()=>this.encode(t,(t=>this.conn.send(t)))))}makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}sendHeartbeat(){this.pendingHeartbeatRef&&!this.isConnected()||(this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatTimeoutTimer=setTimeout((()=>this.heartbeatTimeout()),this.heartbeatIntervalMs))}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((t=>t())),this.sendBuffer=[])}onConnMessage(t){this.decode(t.data,(t=>{let{topic:e,event:n,payload:s,ref:i,join_ref:r}=t;i&&i===this.pendingHeartbeatRef&&(this.clearHeartbeats(),this.pendingHeartbeatRef=null,this.heartbeatTimer=setTimeout((()=>this.sendHeartbeat()),this.heartbeatIntervalMs)),this.hasLogger()&&this.log("receive",`${s.status||""} ${e} ${n} ${i&&"("+i+")"||""}`,s);for(let t=0;t<this.channels.length;t++){const o=this.channels[t];o.isMember(e,n,s,r)&&o.trigger(n,s,i,r)}for(let e=0;e<this.stateChangeCallbacks.message.length;e++){let[,n]=this.stateChangeCallbacks.message[e];n(t)}}))}leaveOpenTopic(t){let e=this.channels.find((e=>e.topic===t&&(e.isJoined()||e.isJoining())));e&&(this.hasLogger()&&this.log("transport",`leaving duplicate topic "${t}"`),e.leave())}}(this.Un,{params:()=>Object.assign(Object.assign({"talkjs-client-build":"release-fe737e0"},this.$n),this.tokenParams),transport:x});this.Gn=t,this.tokenParams.authToken&&(t.reconnectTimer.reset(),t.reconnectTimer={reset:()=>{},scheduleTimeout:()=>{}}),t.onOpen((()=>{this.Gn===t&&this.eventEmitter.emit("connectionStatusChanged",!0)})),t.onClose((()=>{this.Gn===t&&this.eventEmitter.emit("connectionStatusChanged",!1)})),t.connect()}catch(t){throw t}}leaveChannel(t){let e;e="string"==typeof t?this.Kn(t):t.name;this.Ln[e].leave(),delete this.Ln[e]}disconnect(){this.Gn&&(this.Jn(),this.zn(this.Gn))}async setAuth(t){var e;return this.tokenParams.authToken===t&&(null===(e=this.Gn)||void 0===e?void 0:e.isConnected())?"Already connected(ing) and auth tokens are same, noop":(this.tokenParams.authToken=t,this.Gn?this.Gn.isConnected()?this.blueGreenReconnect().then((()=>"Socket already connected, token is different, did blue green, success")).catch((t=>`Socket already connected, token is different, did blue green, failure: ${JSON.stringify(t)}`)):this.hardReconnect(this.Gn).then((()=>"Socket disconnected, token is different, did hard reconnect, success")).catch((t=>`Socket disconnected, token is different, did hard reconnect, failure: ${JSON.stringify(t)}`)):"Socket doesn't exist, before first connection, updated token but did not reconnect")}hardReconnect(t){return new Promise(((e,n)=>{t.onOpen(e),t.onError((()=>n("Websocket failed to connect"))),t.disconnect((()=>t.connect()),1e3)}))}async blueGreenReconnect(){var t;const e=this.Gn;this.connect({});const n=Object.values(this.Ln).map((t=>t.connect(this.Gn,e))),s=Object(F.b)();null===(t=this.Gn)||void 0===t||t.onError((()=>{s.resolve()})),await Promise.race([Promise.all(n),s.promise]),this.zn(e)}isConnected(){var t,e;return"open"===(null===(t=this.Gn)||void 0===t?void 0:t.connectionState())||"connecting"===(null===(e=this.Gn)||void 0===e?void 0:e.connectionState())}Jn(){for(const t of Object.values(this.Ln))t.leave();this.Ln={}}zn(t){t&&t.disconnect(void 0,1e3)}getOrJoin(t,e={},n,s){if(!this.Gn)throw new Error("[TalkJS] Socket not connected");const i=this.Kn(t);let r=this.Ln[i];return r||(r=new j(this.Gn,i,{initialData:e,onRejoin:n,onJoin:s}),this.Ln[i]=r),Object(N.a)((e=>{e.channels[t]=r})),r}Kn(t){return`${t}:${this.$n.appId}`}}class j{constructor(t,e,n){this.name=e,this.startupOptions=n,this.currentInstanceId=void 0,this.leave=t=>this.phoenixChannel.leave(t),this.on=(t,e)=>this.phoenixChannel.on(t,e),this.off=(t,e)=>this.phoenixChannel.off(t,e),this.push=(t,e,n)=>this.phoenixChannel.push(t,e,n),this.joinRef=()=>this.phoenixChannel.joinRef(),this.connect(t)}connect(t,e){var n;const s=Object(F.b)(),i=this.phoenixChannel,r=null!==(n=null==i?void 0:i.bindings)&&void 0!==n?n:[];this.phoenixChannel=t.channel(this.name,this.startupOptions.initialData),this.phoenixChannel.bindings.push(...r);const o=()=>{if(e&&e.isConnected()){B(i.leave(),this.name).then(s.resolve).catch(s.resolve)}else s.resolve()};return this.phoenixChannel.join().receive("ok",(t=>{var n,s;o();const i=this.currentInstanceId;if(this.currentInstanceId=(t||{}).backend_instance_id||"not_implemented",void 0===i)return;const r=i!==this.currentInstanceId||!!(null==e?void 0:e.isConnected());null===(s=(n=this.startupOptions).onRejoin)||void 0===s||s.call(n,this,r)})).receive("error",(t=>{o()})).receive("timeout",(()=>{o()})),this.startupOptions.onJoin&&!i&&this.startupOptions.onJoin(this),s.promise}}function B(t,e){return new Promise(((n,s)=>{t.receive("ok",(t=>n(t))).receive("error",(t=>t&&t.api_error?s(new D.a(t.api_error)):s(t))).receive("timeout",(()=>{const t=`[TalkJS] Network issues for ${e}.`;console.warn(t),s(t)}))}))}},74:function(t,e,n){"use strict";function s(t){const e="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";let n=0;const s=[],i=t===n;n=t;const r=new Array(8);for(let n=7;n>=0;n--)r[n]=e.charAt(t%64),t=Math.floor(t/64);if(0!==t)throw new Error("We should have converted the entire timestamp.");let o=r.join("");if(i){let t;for(t=11;t>=0&&63===s[t];t--)s[t]=0;s[t]++}else for(let t=0;t<12;t++)s[t]=Math.floor(64*Math.random());for(let t=0;t<12;t++)o+=e.charAt(s[t]);if(20!=o.length)throw new Error("Length should be 20.");return o}n.d(e,"a",(function(){return s}))},75:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return h}));var s=n(12);function i(t,e,n){if(!(e instanceof Array))throw console.error("`params` must be array"),new Error("`params` must be array");a({type:"response",params:e,method:t,___talkjs:!0},n)}let r=0;function o(t,e,n){return new Promise((async(i,o)=>{let h=!0;const l="respond_"+r++,d={[l]:t=>{m(),i(t)},[`error_${l}`]:t=>{m(),o(function(t){if(t&&t.__fakeError){const{message:e,stack:n}=t.__fakeError;t=new Error(e),n&&(t.stack=n)}return t}(t))}},f=await n(),p=t=>{c(u(t,{port:f}),{port:f,handlers:d})},m=()=>{h=!1,f.removeEventListener("message",p)};f.addEventListener("message",p);let g=200;for(;h;)a({type:"request",method:t,params:e,responseMethod:l,___talkjs:!0},f),await Object(s.c)(g),g=Math.min(5e3,1.2*g)}))}function a(t,e){e.postMessage(t)}function u(t,{port:e}){if(!t.data||t.data&&"object"!=typeof t.data)return null;if(!t.data.___talkjs)return null;const n=t.data;return n.method&&n.params?n:null}async function c(t,{port:e,handlers:n}){if(null===t)return;let s,r=n[t.method];if(r){try{s=Promise.resolve(r.apply(n,t.params))}catch(t){s=Promise.reject(t)}if("request"!==t.type)return s.catch((t=>{throw t}));{const n=t.responseMethod;s.then((t=>i(n,[t],e)),(t=>i(`error_${n}`,[l(t)],e)))}}}function h(t,e){const n=new Set;return i=>{const r=u(i,{port:t});if(null===r)return;if("response"===r.type)return void c(r,{port:t,handlers:e});const o=r.responseMethod;if(n.has(o))return;n.add(o);const a=()=>Object(s.c)(15e3).then((()=>n.delete(o)));c(r,{port:t,handlers:e}).then(a).catch(a)}}function l(t){return t&&t.message&&t.stack?{__fakeError:{message:t.message,stack:t.stack}}:t}},8:function(t,e,n){"use strict";n.d(e,"d",(function(){return s.a})),n.d(e,"g",(function(){return i})),n.d(e,"i",(function(){return r})),n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return u})),n.d(e,"a",(function(){return c})),n.d(e,"e",(function(){return h})),n.d(e,"j",(function(){return d})),n.d(e,"h",(function(){return f})),n.d(e,"f",(function(){return p}));n(51),n(67);var s=n(28);function i(t,e){return f(t,(([t,n])=>[t,e(n,t)]))}function r(t,...e){let n={};return Object(s.a)(t,((t,s)=>{-1===e.indexOf(s)&&(n[s]=t)})),n}function o(t,e){let n={};return Object(s.a)(t,((t,s)=>{e(t,s)&&(n[s]=t)})),n}function a(t,e){for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=[n,t[n]];if(e(t[n],n))return s}}function u(t,e){const n=a(t,e);return n&&n[1]}function c(t){return Object.keys(t).length}function h(t){for(let e in t)if(t.hasOwnProperty(e))return!1;return!0}function l(t,e,n){const[s,...i]=e;if(!s)return n(t);const r=t[s]||(i[0]?{}:void 0);return Object.assign(Object.assign({},t),{[s]:l(r,i,n)})}function d(t,e,n){return l(t,e,(()=>n))}function f(t,e){let n={},i=0;return Object(s.a)(t,((t,s)=>{const[r,o]=e([s,t],i++);n[r]=o})),n}function p(t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===Object.prototype}},9:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s{constructor(t,e){const n=e?Object.assign(Object.assign({},e.values),t.values):t.values;this.values=n,this.meta=t.meta,this.t=(t,e)=>e?function(t,e){for(let n in e)t=t.replace("$"+n,e[n]);return t}(n[t],e):n[t]}static decide(t,e="en",n){const s=r(t,n);if(s)return s;const o=r(t,e);if(o)return i(o,n);return i(t.en,n)}}function i(t,e){return e?Object.assign(Object.assign({},t),{meta:Object.assign(Object.assign({},t.meta),{requestedCode:e})}):t}function r(t,e){if(!e)return;const n=t[e=e.replace(/_/g,"-").toLowerCase()];if(n)return n;return t[e.substring(0,2)]}}});